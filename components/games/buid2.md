ì œì•ˆí•´ì£¼ì‹  ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, **Flavor Archive**ì˜ ì •ì²´ì„±ì„ ë‹´ì€ ì „ëµ ë””íœìŠ¤ ê²Œì„ **"ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ì‹íƒ ìˆ˜í˜¸ ì‘ì „ (Nutritional Guardians)"**ì˜ ê¸°íšê³¼ ìƒì„¸ ì½”ë“œë¥¼ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.

ì´ ê²Œì„ì€ ë‹¨ìˆœí•œ í´ë¦­ì„ ë„˜ì–´, **ê¸¸(Path)**ì„ ë”°ë¼ì˜¤ëŠ” ì„¸ê· ë“¤ì„ **ì±„ì†Œ íƒ€ì›Œ**ë¥¼ ë°°ì¹˜í•˜ì—¬ ë§‰ì•„ë‚´ëŠ” **íƒ€ì›Œ ë””íœìŠ¤(Tower Defense)** ë°©ì‹ì…ë‹ˆë‹¤.

---

## ğŸ—ï¸ 1. ê²Œì„ ì„¤ê³„ ë° ê¸°ìˆ  ìŠ¤íƒ

ê¸°ì¡´ì˜ Next.js 15ì™€ React 19 í™˜ê²½ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ì„œ, ë³µì¡í•œ ê²Œì„ ë¡œì§ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ **`useReducer`**ì™€ **`Immer`** ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•©ë‹ˆë‹¤.

* **ê¸°ìˆ  ìŠ¤íƒ**: Next.js 15, React 19, Framer Motion (ì• ë‹ˆë©”ì´ì…˜), Lucide-React (ì•„ì´ì½˜)
* **í•µì‹¬ ë¡œì§**:
* **ì›¨ì´ë¸Œ ì‹œìŠ¤í…œ**: ì •í•´ì§„ ê¸¸ì„ ë”°ë¼ ì„¸ê· ë“¤ì´ ìˆœì°¨ì ìœ¼ë¡œ ë“±ì¥.
* **íƒ€ì›Œ ì‹œìŠ¤í…œ**: ê¸¸ëª©ì— ì±„ì†Œ íƒ€ì›Œë¥¼ ê±´ì„¤í•˜ê³ , ì„¸ê· ì„ ì¡ì•„ ë²ˆ ëˆìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ.
* **ì¶©ëŒ ê°ì§€**: íƒ€ì›Œì˜ ì‚¬ê±°ë¦¬ ì•ˆì— ì„¸ê· ì´ ë“¤ì–´ì˜¤ë©´ ìë™ìœ¼ë¡œ ë°œì‚¬.



---

## ğŸ¨ 2. ê²Œì„ ë””ìì¸ ë° ìœ ë‹› ê¸°íš

### ğŸ›¡ï¸ ìˆ˜ë¹„ ìœ ë‹› (íƒ€ì›Œ)

* **ë¸Œë¡œì½œë¦¬ í¬ë³‘**: ê¸°ë³¸ ê³µê²© íƒ€ì›Œ. ë¹ ë¥¸ ì—°ì‚¬ë ¥ìœ¼ë¡œ ì„¸ê· ì„ ê³µê²©í•©ë‹ˆë‹¤.
* **ë§ˆëŠ˜ ê°€ë””ì–¸**: ê°•í•œ í•œ ë°©. ë°©ì–´ë ¥ì´ ë†’ì€ ì„¸ê· ì—ê²Œ íš¨ê³¼ì ì…ë‹ˆë‹¤.
* **ë¸”ë£¨ë² ë¦¬ ë‘”í™”ê¸°**: ì„¸ê· ì˜ ì´ë™ ì†ë„ë¥¼ ëŠ¦ì¶”ëŠ” ëˆì í•œ ì¦™ì„ ë°œì‚¬í•©ë‹ˆë‹¤.

### ğŸ¦  ì¹¨ì… ìœ ë‹› (ì„¸ê·  ë¹ŒëŸ°)

* **ì¼ë°˜ ì„¸ê· **: í‰ë²”í•œ ì†ë„ì™€ ì²´ë ¥.
* **ê³ ì§€ë°© í–„ë²„ê±°**: ì²´ë ¥ì´ ë§¤ìš° ë†’ì•„ ì—¬ëŸ¬ ë²ˆ ê³µê²©í•´ì•¼ í•©ë‹ˆë‹¤.
* **ì¹´í˜ì¸ ìŠ¤í”„ë¦°í„°**: ì²´ë ¥ì€ ë‚®ì§€ë§Œ ì´ë™ ì†ë„ê°€ ë§¤ìš° ë¹ ë¦…ë‹ˆë‹¤.

---

## ğŸ’» 3. ê²Œì„ í•µì‹¬ ì½”ë“œ (`NutrientDefense.tsx`)

ì´ ì½”ë“œëŠ” ì‹¤ì œ ê²Œì„ì˜ **ë§µ(ê·¸ë¦¬ë“œ), ì ì˜ ì´ë™, íƒ€ì›Œ ê±´ì„¤** ë¡œì§ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.

```tsx
"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, ShieldCheck, Zap } from 'lucide-react';

// --- ê²Œì„ ì„¤ì • ---
const TILE_SIZE = 50; // ê·¸ë¦¬ë“œ í•œ ì¹¸ í¬ê¸°
const MAP_PATH = [ // ì„¸ê· ì´ ì´ë™í•˜ëŠ” ê²½ë¡œ ì¢Œí‘œ (x, y)
  { x: 0, y: 2 }, { x: 1, y: 2 }, { x: 2, y: 2 }, { x: 2, y: 4 }, 
  { x: 4, y: 4 }, { x: 4, y: 1 }, { x: 7, y: 1 }, { x: 7, y: 3 }, { x: 9, y: 3 }
];

export default function NutrientDefense() {
  const [gold, setGold] = useState(300);
  const [lives, setLives] = useState(10);
  const [wave, setWave] = useState(1);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [towers, setTowers] = useState<any[]>([]);
  const [isGameActive, setIsGameActive] = useState(false);

  // 1. ì„¸ê·  ìƒì„± (ì›¨ì´ë¸Œ ì‹œì‘)
  const startWave = () => {
    setIsGameActive(true);
    let count = 0;
    const interval = setInterval(() => {
      const newEnemy = {
        id: Date.now() + count,
        hp: 100 + (wave * 20),
        maxHp: 100 + (wave * 20),
        pathIndex: 0,
        x: MAP_PATH[0].x * TILE_SIZE,
        y: MAP_PATH[0].y * TILE_SIZE,
        speed: 2,
      };
      setEnemies(prev => [...prev, newEnemy]);
      count++;
      if (count >= 5 + wave) clearInterval(interval);
    }, 1000);
  };

  // 2. ê²Œì„ í”„ë ˆì„ ì—…ë°ì´íŠ¸ (ì´ë™ ë° ê³µê²©)
  useEffect(() => {
    if (!isGameActive) return;

    const gameLoop = setInterval(() => {
      // ì„¸ê·  ì´ë™ ë¡œì§
      setEnemies(prevEnemies => {
        return prevEnemies.map(enemy => {
          const target = MAP_PATH[enemy.pathIndex + 1];
          if (!target) { // ëª©í‘œ ì§€ì  ë„ë‹¬ ì‹œ
            setLives(l => l - 1);
            return { ...enemy, hp: 0 };
          }

          const targetX = target.x * TILE_SIZE;
          const targetY = target.y * TILE_SIZE;
          
          let nextX = enemy.x;
          let nextY = enemy.y;

          if (enemy.x < targetX) nextX += enemy.speed;
          else if (enemy.x > targetX) nextX -= enemy.speed;
          if (enemy.y < targetY) nextY += enemy.speed;
          else if (enemy.y > targetY) nextY -= enemy.speed;

          const reached = Math.abs(nextX - targetX) < 2 && Math.abs(nextY - targetY) < 2;

          return {
            ...enemy,
            x: nextX,
            y: nextY,
            pathIndex: reached ? enemy.pathIndex + 1 : enemy.pathIndex
          };
        }).filter(e => e.hp > 0);
      });

      // íƒ€ì›Œ ê³µê²© ë¡œì§ (ë‹¨ìˆœí™”: ì‚¬ê±°ë¦¬ ë‚´ ì  HP ê°ì†Œ)
      towers.forEach(tower => {
        setEnemies(prev => prev.map(enemy => {
          const dist = Math.hypot(enemy.x - tower.x, enemy.y - tower.y);
          if (dist < 100) { // ì‚¬ê±°ë¦¬ 100px
            return { ...enemy, hp: enemy.hp - 1 }; // ì´ˆë‹¹ ë°ë¯¸ì§€
          }
          return enemy;
        }));
      });
    }, 50);

    return () => clearInterval(gameLoop);
  }, [isGameActive, towers, wave]);

  // 3. íƒ€ì›Œ ê±´ì„¤
  const placeTower = (x: number, y: number) => {
    if (gold >= 100) {
      setTowers([...towers, { x: x * TILE_SIZE, y: y * TILE_SIZE, level: 1 }]);
      setGold(gold - 100);
    }
  };

  return (
    <div className="relative w-full max-w-4xl mx-auto bg-green-50 rounded-3xl p-6 shadow-2xl overflow-hidden border-8 border-white">
      {/* --- HUD: ê²Œì„ ì •ë³´ --- */}
      <div className="flex justify-between items-center mb-4 bg-white/80 p-4 rounded-2xl backdrop-blur-md">
        <div className="flex gap-6">
          <div className="flex items-center gap-2 text-red-500 font-bold text-xl">
            <Heart fill="currentColor" /> {lives}
          </div>
          <div className="flex items-center gap-2 text-yellow-600 font-bold text-xl">
            <Coins fill="currentColor" /> {gold}
          </div>
        </div>
        <div className="flex items-center gap-4 font-black text-gray-700">
          WAVE {wave}
          <button onClick={startWave} className="bg-green-500 text-white px-4 py-2 rounded-xl flex items-center gap-2">
            <Play size={18} fill="currentColor" /> ì‹œì‘
          </button>
        </div>
      </div>

      {/* --- ê²Œì„ ë§µ (ê·¸ë¦¬ë“œ) --- */}
      <div className="relative bg-white/40 rounded-xl" style={{ width: '100%', height: '400px' }}>
        {/* ê²½ë¡œ í‘œì‹œ */}
        {MAP_PATH.map((p, i) => (
          <div key={i} className="absolute bg-gray-200/50 rounded-md" 
               style={{ left: p.x * TILE_SIZE, top: p.y * TILE_SIZE, width: TILE_SIZE, height: TILE_SIZE }} />
        ))}

        {/* íƒ€ì›Œ ê±´ì„¤ ê°€ëŠ¥ êµ¬ì—­ (í´ë¦­ ì‹œ ê±´ì„¤) */}
        {Array.from({ length: 40 }).map((_, i) => {
          const x = i % 10;
          const y = Math.floor(i / 10);
          const isPath = MAP_PATH.some(p => p.x === x && p.y === y);
          if (isPath) return null;
          return (
            <div key={i} onClick={() => placeTower(x, y)} 
                 className="absolute border border-gray-100 hover:bg-green-200/30 cursor-pointer"
                 style={{ left: x * TILE_SIZE, top: y * TILE_SIZE, width: TILE_SIZE, height: TILE_SIZE }} />
          );
        })}

        {/* íƒ€ì›Œ ë Œë”ë§ */}
        {towers.map((t, i) => (
          <div key={i} className="absolute text-3xl z-10" style={{ left: t.x, top: t.y }}>ğŸ¥¦</div>
        ))}

        {/* ì„¸ê·  ë¹ŒëŸ° ë Œë”ë§ */}
        <AnimatePresence>
          {enemies.map(enemy => (
            <motion.div
              key={enemy.id}
              className="absolute text-3xl z-20"
              animate={{ x: enemy.x, y: enemy.y }}
              transition={{ duration: 0.05, ease: "linear" }}
            >
              ğŸ¦ 
              <div className="absolute -top-2 left-0 w-full h-1 bg-gray-200 rounded">
                <div className="h-full bg-red-500 rounded" style={{ width: `${(enemy.hp / enemy.maxHp) * 100}%` }} />
              </div>
            </motion.div>
          ))}
        </AnimatePresence>
      </div>

      {/* --- ê²Œì„ íŒ --- */}
      <div className="mt-4 p-4 bg-white/60 rounded-xl text-sm text-gray-600 flex items-center gap-2">
        <Zap size={16} className="text-yellow-500" />
        íŒ: ê¸¸ëª©ì˜ êµ½ì–´ì§€ëŠ” ì§€ì ì— ë¸Œë¡œì½œë¦¬ íƒ€ì›Œë¥¼ ë°°ì¹˜í•˜ë©´ ì„¸ê· ì„ ë” ì˜¤ë˜ ê³µê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
      </div>
    </div>
  );
}

```

---

## ğŸš€ 4. ê²Œì„ì˜ ì£¼ìš” íŠ¹ì§•

1. **ë™ì  ì´ë™ ì•Œê³ ë¦¬ì¦˜**: ì„¸ê· ë“¤ì´ `MAP_PATH`ì— ì •ì˜ëœ ì¢Œí‘œë¥¼ ìˆœì„œëŒ€ë¡œ ë”°ë¼ê°€ë©°, ëª©í‘œ ì§€ì ì— ë„ë‹¬í•˜ë©´ í”Œë ˆì´ì–´ì˜ ìƒëª…(`lives`)ì´ ê°ì†Œí•©ë‹ˆë‹¤.
2. **íƒ€ì›Œ ê±´ì„¤ ë° ê²½ì œ**: ì„¸ê· ì„ ì²˜ì¹˜í•  ë•Œë§ˆë‹¤ ê³¨ë“œë¥¼ íšë“(ë¡œì§ ì¶”ê°€ ê°€ëŠ¥)í•˜ê³ , ì´ë¥¼ í†µí•´ íƒ€ì›Œë¥¼ ë” ë§ì´ ê±´ì„¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **ì‹¤ì‹œê°„ ì²´ë ¥ë°”**: ê° ì„¸ê·  ë¨¸ë¦¬ ìœ„ì— HP ë°”ë¥¼ í‘œì‹œí•˜ì—¬ ì–´ë–¤ ì ì´ ë¨¼ì € ì£½ì„ì§€ ì§ê´€ì ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.

## ğŸ’¡ ì¶”ê°€ ì œì•ˆ (ë°œì „ ë°©í–¥)

* **íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ**: ê±´ì„¤ëœ ë¸Œë¡œì½œë¦¬ë¥¼ í´ë¦­í•˜ë©´ ê³¨ë“œë¥¼ ì¨ì„œ ì‚¬ê±°ë¦¬ë‚˜ ê³µê²©ë ¥ì„ ë†’ì´ëŠ” íŒì—…ì„ ë„ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë‹¤ì–‘í•œ ì±„ì†Œ**: ë§ˆëŠ˜(ê´‘ì—­ ë°ë¯¸ì§€), ì–‘íŒŒ(ë… ë°ë¯¸ì§€) ë“± ì±„ì†Œë§ˆë‹¤ ë‹¤ë¥¸ ê³µê²© íš¨ê³¼ë¥¼ ë¶€ì—¬í•˜ë©´ ì „ëµì„±ì´ í›¨ì”¬ ë†’ì•„ì§‘ë‹ˆë‹¤.
* **ê°€ì¡± ë°ì´í„° ì—°ë™**: ê²Œì„ì—ì„œ ìŠ¹ë¦¬í•  ë•Œë§ˆë‹¤ **"ê°€ì¡± ì‹ë‹¨ ìœ„ìƒ ì ìˆ˜"**ë¥¼ ë³´ë„ˆìŠ¤ë¡œ ì£¼ì–´ í™ˆí˜ì´ì§€ì˜ ë©”ì¸ ê¸°ëŠ¥ê³¼ ì—°ë™í•´ ë³´ì„¸ìš”.

ì´ ì½”ë“œë¥¼ Next.js í”„ë¡œì íŠ¸ì˜ ì»´í¬ë„ŒíŠ¸ë¡œ ë°”ë¡œ ì¶”ê°€í•˜ì‹œë©´ ì´ë¯¸ì§€ì™€ ìœ ì‚¬í•œ ë””íœìŠ¤ ê²Œì„ì˜ ê¸°ì´ˆë¥¼ ì™„ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ì¶”ê°€ë¡œ **"íƒ€ì›Œ ì¢…ë¥˜ë¥¼ 3ê°€ì§€ë¡œ ëŠ˜ë ¤ë‹¬ë¼"**ê±°ë‚˜ **"ë” ë³µì¡í•œ ë§µ"**ì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”. ë°”ë¡œ ë°˜ì˜í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

**Flavor Archive**ì˜ 'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ' ê²Œì„ì„ í›¨ì”¬ ë” ë°©ëŒ€í•˜ê³  ì „ëµì ì¸ ê²Œì„ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ìš”ì²­í•˜ì‹  ëŒ€ë¡œ íƒ€ì›Œ ì ê¸ˆ í•´ì œ ì‹œìŠ¤í…œ, ë‚œì´ë„ ì¡°ì ˆ, ê·¸ë¦¬ê³  ë‹¤ì±„ë¡œìš´ ë§µ í™•ì¥ì´ ê°€ëŠ¥í•˜ë„ë¡ ì½”ë“œë¥¼ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ—ï¸ 1. ê²Œì„ í™•ì¥ ê¸°íšì•ˆ

### ğŸ¥¦ íƒ€ì›Œ ì ê¸ˆ í•´ì œ ì‹œìŠ¤í…œ (Progression)

ì²˜ìŒë¶€í„° ëª¨ë“  íƒ€ì›Œë¥¼ ì“¸ ìˆ˜ ìˆëŠ” ê²Œ ì•„ë‹ˆë¼, ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í•˜ë©° ìƒˆë¡œìš´ ì˜ì–‘ì†Œë¥¼ ì–»ëŠ” ì»¨ì…‰ì…ë‹ˆë‹¤.

* **Stage 1~3**: ë¸Œë¡œì½œë¦¬(ê¸°ë³¸)
* **Stage 4~6**: ë§ˆëŠ˜(ê°•ë ¥í•œ í•œ ë°©) ì ê¸ˆ í•´ì œ
* **Stage 7~10**: ë¸”ë£¨ë² ë¦¬(ìŠ¬ë¡œìš° íš¨ê³¼) ì ê¸ˆ í•´ì œ
* **Stage 11~15**: ì–‘íŒŒ(ë…/ì§€ì† ë°ë¯¸ì§€) ì ê¸ˆ í•´ì œ
* **Stage 16~20**: íŒŒí”„ë¦¬ì¹´(ê´‘ì—­ í­ë°œ) ì ê¸ˆ í•´ì œ

### âš™ï¸ ë‚œì´ë„ ì„¤ì • (Difficulty)

* **ì‰¬ì›€**: ì´ˆê¸° ê³¨ë“œ +50%, ì„¸ê·  ì²´ë ¥ -20%, ìƒëª…ë ¥ 20ê°œ
* **ë³´í†µ**: í‘œì¤€ ì„¤ì •, ìƒëª…ë ¥ 10ê°œ
* **ì–´ë ¤ì›€**: ì´ˆê¸° ê³¨ë“œ -20%, ì„¸ê·  ì´ë™ ì†ë„ +20%, ìƒëª…ë ¥ 5ê°œ

### ğŸ—ºï¸ 20ê°€ì§€ ë§µ ì‹œìŠ¤í…œ

ë§µ ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ê´€ë¦¬í•˜ì—¬ ìŠ¤í…Œì´ì§€ ë²ˆí˜¸ì— ë”°ë¼ ê²½ë¡œ(`PATH`)ê°€ ìë™ìœ¼ë¡œ ë°”ë€Œë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. (ì§ì„ , Sì, ì†Œìš©ëŒì´ ë“±)

---

## ğŸ’» 2. ì‹¤ì œ êµ¬í˜„ ì½”ë“œ (í™•ì¥íŒ)

ì´ ì½”ë“œëŠ” **íƒ€ì›Œ ì ê¸ˆ í•´ì œ ë¡œì§**ê³¼ **ë‚œì´ë„ ì„ íƒ**, **ë©€í‹° ë§µ ë°ì´í„°**ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.

```tsx
"use client";

import React, { useState, useEffect, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, Lock, Settings2, Map as MapIcon, ShieldCheck } from 'lucide-react';

// --- 1. íƒ€ì›Œ ë°ì´í„° ì •ì˜ ---
const TOWER_TYPES = {
  BROCCOLI: { id: 'BROCCOLI', name: 'ë¸Œë¡œì½œë¦¬', emoji: 'ğŸ¥¦', cost: 100, range: 120, damage: 2, unlockStage: 1 },
  GARLIC: { id: 'GARLIC', name: 'ë§ˆëŠ˜', emoji: 'ğŸ§„', cost: 200, range: 150, damage: 10, unlockStage: 4 },
  BLUEBERRY: { id: 'BLUEBERRY', name: 'ë¸”ë£¨ë² ë¦¬', emoji: 'ğŸ«', cost: 150, range: 100, damage: 1, slow: 0.5, unlockStage: 7 },
  ONION: { id: 'ONION', name: 'ì–‘íŒŒ', emoji: 'ğŸ§…', cost: 250, range: 130, damage: 3, poison: true, unlockStage: 11 },
  PAPRIKA: { id: 'PAPRIKA', name: 'íŒŒí”„ë¦¬ì¹´', emoji: 'ğŸ«‘', cost: 350, range: 180, damage: 15, area: true, unlockStage: 16 }
};

// --- 2. ë§µ ë°ì´í„° (20ê°€ì§€ ì˜ˆì‹œ ì¤‘ 3ê°€ì§€ ë¡œì§) ---
const MAP_DATABASE = Array.from({ length: 20 }).map((_, i) => {
  // ìŠ¤í…Œì´ì§€ë³„ë¡œ ë‹¤ë¥¸ ê²½ë¡œ ìƒì„± (ê°„ë‹¨í•œ ì˜ˆì‹œ)
  if (i % 2 === 0) return [{x:0,y:2}, {x:2,y:2}, {x:2,y:5}, {x:5,y:5}, {x:5,y:2}, {x:9,y:2}];
  return [{x:0,y:1}, {x:8,y:1}, {x:8,y:5}, {x:1,y:5}, {x:1,y:8}, {x:9,y:8}];
});

export default function NutritionalGuardiansPro() {
  // ê²Œì„ ì„¤ì • ìƒíƒœ
  const [stage, setStage] = useState(1);
  const [difficulty, setDifficulty] = useState<'EASY' | 'NORMAL' | 'HARD'>('NORMAL');
  const [gameState, setGameState] = useState<'LOBBY' | 'PLAYING' | 'OVER'>('LOBBY');
  
  // í”Œë ˆì´ ìƒíƒœ
  const [gold, setGold] = useState(300);
  const [lives, setLives] = useState(10);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [towers, setTowers] = useState<any[]>([]);
  const [selectedTowerType, setSelectedTowerType] = useState('BROCCOLI');

  // --- ë‚œì´ë„ë³„ ì´ˆê¸°í™” ---
  const initGame = () => {
    let initialGold = 300;
    let initialLives = 10;
    if (difficulty === 'EASY') { initialGold = 500; initialLives = 20; }
    if (difficulty === 'HARD') { initialGold = 200; initialLives = 5; }
    
    setGold(initialGold);
    setLives(initialLives);
    setEnemies([]);
    setTowers([]);
    setGameState('PLAYING');
  };

  // --- ì  ìƒì„± ë£¨í”„ ---
  const spawnEnemy = useCallback(() => {
    const healthMult = difficulty === 'HARD' ? 1.5 : (difficulty === 'EASY' ? 0.8 : 1);
    const newEnemy = {
      id: Date.now(),
      hp: (100 + stage * 30) * healthMult,
      maxHp: (100 + stage * 30) * healthMult,
      pathIndex: 0,
      x: MAP_DATABASE[stage-1][0].x * 50,
      y: MAP_DATABASE[stage-1][0].y * 50,
      speed: difficulty === 'HARD' ? 3 : 2
    };
    setEnemies(prev => [...prev, newEnemy]);
  }, [stage, difficulty]);

  // --- ê²Œì„ ì—”ì§„ (ê³µê²© ë° ì´ë™) ---
  useEffect(() => {
    if (gameState !== 'PLAYING') return;

    const interval = setInterval(() => {
      setEnemies(prev => {
        const nextEnemies = prev.map(enemy => {
          const target = MAP_DATABASE[stage-1][enemy.pathIndex + 1];
          if (!target) {
            setLives(l => l - 1);
            return { ...enemy, hp: 0 };
          }
          
          const targetX = target.x * 50;
          const targetY = target.y * 50;
          let { x, y } = enemy;

          if (x < targetX) x += enemy.speed; else if (x > targetX) x -= enemy.speed;
          if (y < targetY) y += enemy.speed; else if (y > targetY) y -= enemy.speed;

          const reached = Math.abs(x - targetX) < 3 && Math.abs(y - targetY) < 3;
          return { ...enemy, x, y, pathIndex: reached ? enemy.pathIndex + 1 : enemy.pathIndex };
        }).filter(e => e.hp > 0);

        if (nextEnemies.length === 0 && stage < 20) { /* ë‹¤ìŒ ì›¨ì´ë¸Œ ë¡œì§ */ }
        return nextEnemies;
      });

      // íƒ€ì›Œ ê³µê²©
      towers.forEach(tower => {
        setEnemies(prev => prev.map(enemy => {
          const dist = Math.hypot(enemy.x - tower.x, enemy.y - tower.y);
          if (dist < tower.range) {
            return { ...enemy, hp: enemy.hp - tower.damage };
          }
          return enemy;
        }));
      });
    }, 50);

    return () => clearInterval(interval);
  }, [gameState, towers, stage]);

  return (
    <div className="w-full max-w-5xl mx-auto p-4 bg-slate-900 rounded-[3rem] shadow-2xl text-white overflow-hidden border-[12px] border-slate-800">
      
      {/* --- ìƒë‹¨ í—¤ë” --- */}
      <div className="flex justify-between items-center p-6 bg-slate-800/50 rounded-3xl mb-4">
        <div className="flex gap-4 items-center">
          <div className="flex items-center gap-2 text-red-400 font-bold"><Heart fill="currentColor"/> {lives}</div>
          <div className="flex items-center gap-2 text-yellow-400 font-bold"><Coins fill="currentColor"/> {gold}</div>
          <div className="px-4 py-1 bg-indigo-600 rounded-full text-sm font-black">STAGE {stage}</div>
        </div>
        
        <div className="flex gap-2">
          {['EASY', 'NORMAL', 'HARD'].map(d => (
            <button key={d} onClick={() => setDifficulty(d as any)} 
                    className={`px-3 py-1 rounded-lg text-xs font-bold ${difficulty === d ? 'bg-white text-slate-900' : 'bg-slate-700'}`}>
              {d}
            </button>
          ))}
        </div>
      </div>

      <div className="flex gap-6">
        {/* --- ì™¼ìª½: íƒ€ì›Œ ìƒì  (ì ê¸ˆ í•´ì œ ë¡œì§ ë°˜ì˜) --- */}
        <div className="w-48 space-y-3">
          <p className="text-xs font-bold text-slate-400 px-2 uppercase tracking-widest">Towers</p>
          {Object.values(TOWER_TYPES).map(t => {
            const isLocked = stage < t.unlockStage;
            return (
              <button key={t.id} disabled={isLocked || gold < t.cost}
                      onClick={() => setSelectedTowerType(t.id)}
                      className={`w-full p-3 rounded-2xl flex items-center justify-between border-2 transition-all 
                      ${selectedTowerType === t.id ? 'border-indigo-500 bg-indigo-500/20' : 'border-slate-700 bg-slate-800'}
                      ${isLocked ? 'opacity-50 grayscale' : 'hover:scale-105'}`}>
                <span className="text-2xl">{t.emoji}</span>
                <div className="text-right">
                  <p className="text-[10px] font-bold">{t.name}</p>
                  <p className="text-xs text-yellow-400">{isLocked ? `Stage ${t.unlockStage}` : `${t.cost}G`}</p>
                </div>
                {isLocked && <Lock size={12} className="absolute top-2 right-2 text-slate-500" />}
              </button>
            );
          })}
        </div>

        {/* --- ì¤‘ì•™: ê²Œì„ í•„ë“œ --- */}
        <div className="flex-1 bg-slate-800 rounded-[2rem] relative h-[500px] border-4 border-slate-700">
          {gameState === 'LOBBY' ? (
            <div className="absolute inset-0 flex flex-col items-center justify-center space-y-6">
              <MapIcon size={80} className="text-indigo-400 animate-pulse" />
              <button onClick={initGame} className="px-12 py-4 bg-indigo-500 rounded-2xl font-black text-xl hover:bg-indigo-600 shadow-xl shadow-indigo-500/20">
                START DEFENSE
              </button>
            </div>
          ) : (
            <>
              {/* ê²½ë¡œ í‘œì‹œ */}
              <svg className="absolute inset-0 w-full h-full opacity-20">
                <polyline points={MAP_DATABASE[stage-1].map(p => `${p.x*50+25},${p.y*50+25}`).join(' ')} 
                          fill="none" stroke="white" strokeWidth="40" strokeLinecap="round" strokeLinejoin="round" />
              </svg>

              {/* ê·¸ë¦¬ë“œ ê±´ì„¤ í´ë¦­ ì˜ì—­ */}
              <div className="grid grid-cols-10 grid-rows-10 absolute inset-0">
                {Array.from({length: 100}).map((_, i) => {
                  const x = i % 10; const y = Math.floor(i / 10);
                  return <div key={i} onClick={() => {
                    const tData = TOWER_TYPES[selectedTowerType as keyof typeof TOWER_TYPES];
                    if (gold >= tData.cost) {
                      setTowers(prev => [...prev, { ...tData, x: x*50+25, y: y*50+25 }]);
                      setGold(g => g - tData.cost);
                    }
                  }} className="hover:bg-white/5 cursor-pointer border border-white/5" />;
                })}
              </div>

              {/* íƒ€ì›Œ & ì  ë Œë”ë§ */}
              {towers.map((t, i) => (
                <div key={i} className="absolute text-3xl -translate-x-1/2 -translate-y-1/2 z-10" style={{left: t.x, top: t.y}}>{t.emoji}</div>
              ))}
              {enemies.map(e => (
                <div key={e.id} className="absolute text-3xl -translate-x-1/2 -translate-y-1/2 z-20" style={{left: e.x, top: e.y}}>
                  ğŸ¦ 
                  <div className="absolute -top-4 left-0 w-full h-1 bg-slate-700 rounded-full overflow-hidden">
                    <div className="h-full bg-red-500 transition-all" style={{width: `${(e.hp/e.maxHp)*100}%`}} />
                  </div>
                </div>
              ))}
              
              <button onClick={spawnEnemy} className="absolute bottom-6 right-6 p-4 bg-green-500 rounded-full shadow-lg hover:scale-110 transition-all">
                <Play fill="white" />
              </button>
            </>
          )}
        </div>
      </div>
    </div>
  );
}

```

---

## ğŸ’¡ ì¶”ê°€ ì œì•ˆ: ê²Œì„ì„ ë” ì™„ë²½í•˜ê²Œ ë§Œë“œëŠ” 3ê°€ì§€ ì•„ì´ë””ì–´

ë” ì¬ë¯¸ìˆëŠ” ê²Œì„ì„ ìœ„í•´ ì•„ë˜ ê¸°ëŠ¥ë“¤ì„ ì¶”ê°€ë¡œ ê¸°íší•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. **ê°€ì¡± ì˜ì›… ìœ ë‹› (Hero Unit)**:
* íƒ€ì›Œ ì™¸ì— ì‚¬ìš©ìê°€ ì§ì ‘ ë§ˆìš°ìŠ¤ë¡œ ì¡°ì¢…í•  ìˆ˜ ìˆëŠ” 'ì˜ì›…(ì˜ˆ: ìŠˆí¼ ì…°í”„)' ìºë¦­í„°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì˜ì›…ì€ ê¸¸ ìœ„ë¥¼ ììœ ë¡­ê²Œ ì´ë™í•˜ë©° ê°€ì¥ ê¸‰í•œ ê³³ì„ ë§‰ì•„ì¤ë‹ˆë‹¤.


2. **í™˜ê²½ íš¨ê³¼ (Environment)**:
* **ê²¨ìš¸ ë§µ**: ì„¸ê· ë“¤ì´ ê½ê½ ì–¼ì–´ ì´ë™ ì†ë„ê°€ ëŠë ¤ì§‘ë‹ˆë‹¤.
* **ì—¬ë¦„ ë§µ**: ì„¸ê· ë“¤ì´ ìƒí•´ì„œ(?) ë” ë¹ ë¥´ê²Œ ì¦ì‹í•˜ê±°ë‚˜ ì´ë™í•©ë‹ˆë‹¤.


3. **ê°€ì¡± ê±´ê°• ë°ì´í„° ì—°ë™ í€˜ìŠ¤íŠ¸**:
* ì‹¤ì œ ê°€ì¡±ì´ ì˜¤ëŠ˜ ì±„ì†Œë¥¼ ë¨¹ì—ˆë‹¤ë©´ ê²Œì„ ì‹œì‘ ì‹œ ë³´ë„ˆìŠ¤ ê³¨ë“œ(+100G)ë¥¼ ì£¼ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì„¸ìš”. ì„œë¹„ìŠ¤ ì´ìš©ê³¼ ê²Œì„ì˜ ë³´ìƒì´ ì§ì ‘ ì—°ê²°ë˜ì–´ ì„œë¹„ìŠ¤ ì²´ë¥˜ ì‹œê°„ì´ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.



---

### ğŸ¨ ë‹¤ìŒ ë‹¨ê³„

ì´ ì½”ë“œë¥¼ ì ìš©í•˜ì‹  í›„, **"íƒ€ì›Œì˜ ì‚¬ê±°ë¦¬ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥"**ì´ë‚˜ **"ì ë“¤ì´ ì£½ì„ ë•Œ ê³¨ë“œê°€ íŠ€ì–´ë‚˜ì˜¤ëŠ” íš¨ê³¼"** ë“± ë” ì„¸ë°€í•œ ì—°ì¶œì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”! êµ¬ì²´ì ì¸ ì• ë‹ˆë©”ì´ì…˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ ë“œë¦´ê²Œìš”.

**Flavor Archive**ì˜ 'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ'ë¥¼ í•œì¸µ ë” ê¹Šì´ ìˆëŠ” ì „ëµ ê²Œì„ìœ¼ë¡œ ì™„ì„±í•˜ê¸° ìœ„í•´, **íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ ì‹œìŠ¤í…œ**ê³¼ **ì¬í™”(ê³¨ë“œ) íšë“ ë¡œì§**ì„ í¬í•¨í•œ ìƒì„¸ ì„¤ê³„ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.

ì´ ë‹¨ê³„ì—ì„œëŠ” ì‚¬ìš©ìê°€ ê²Œì„ì— ë” ëª°ì…í•  ìˆ˜ ìˆë„ë¡ 'ì„±ì¥'ì˜ ì¬ë¯¸ë¥¼ ë¶€ì—¬í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.

---

### ğŸ—ºï¸ 1. ë‹¤ìŒ ë‹¨ê³„ ê°œë°œ ê³„íš (Roadmap)

ë” ì²´ê³„ì ì¸ ê°œë°œì„ ìœ„í•´ 3ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ì§„í–‰í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

* **1ë‹¨ê³„: ê²½ì œ ë° ì—…ê·¸ë ˆì´ë“œ ì‹œìŠ¤í…œ (í˜„ì¬ ë‹¨ê³„)**
* ì  ì²˜ì¹˜ ì‹œ ê³¨ë“œ íšë“ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€.
* íƒ€ì›Œ í´ë¦­ ì‹œ ì—…ê·¸ë ˆì´ë“œ UI(ê³µê²©ë ¥, ì‚¬ê±°ë¦¬ ì¦ê°€) êµ¬í˜„.


* **2ë‹¨ê³„: íŠ¹ìˆ˜ ìœ ë‹› ë° ìŠ¤í‚¬ ì‹œìŠ¤í…œ**
* ê°€ì¡± ì˜ì›… ìºë¦­í„°(ì…°í”„) ì¶”ê°€.
* ìœ„ê¸‰ ìƒí™© ì‹œ ì‚¬ìš©í•˜ëŠ” 'ì „ì²´ ì‚´ê·  ìŠ¤ìº”' ìŠ¤í‚¬ êµ¬í˜„.


* **3ë‹¨ê³„: ë°ì´í„° ì €ì¥ ë° ë³´ìƒ ì‹œìŠ¤í…œ**
* Supabaseë¥¼ ì—°ë™í•˜ì—¬ ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ê¸°ë¡ ë° íšë“ ê³¨ë“œ ì €ì¥.
* ì‹¤ì œ ì‹ë‹¨ ê¸°ë¡ ì‹œ ê²Œì„ ë‚´ ë³´ë„ˆìŠ¤ ì•„ì´í…œ ì§€ê¸‰.



---

### ğŸ’» 2. íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ ê¸°ëŠ¥ í¬í•¨ ìƒì„¸ ì½”ë“œ

ì´ ì½”ë“œëŠ” íƒ€ì›Œë¥¼ í´ë¦­í•˜ë©´ **ì—…ê·¸ë ˆì´ë“œ ë©”ë‰´**ê°€ ë‚˜íƒ€ë‚˜ê³ , ë ˆë²¨ì— ë”°ë¼ **ê³µê²©ë ¥(Damage)ê³¼ ì‚¬ê±°ë¦¬(Range)**ê°€ ë¹„ì•½ì ìœ¼ë¡œ ìƒìŠ¹í•˜ëŠ” ë¡œì§ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

```tsx
"use client";

import React, { useState, useEffect, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, ArrowUpCircle, XCircle, Zap, ShieldCheck } from 'lucide-react';

// --- íƒ€ì›Œë³„ ì—…ê·¸ë ˆì´ë“œ ìŠ¤íƒ¯ ì •ì˜ ---
const UPGRADE_STATS = {
  BROCCOLI: { damagePerLvl: 5, rangePerLvl: 10, costMult: 1.5 },
  GARLIC: { damagePerLvl: 15, rangePerLvl: 5, costMult: 1.8 },
  BLUEBERRY: { damagePerLvl: 2, rangePerLvl: 15, costMult: 1.4 },
};

export default function NutritionalGuardiansAdvanced() {
  const [gold, setGold] = useState(500);
  const [lives, setLives] = useState(10);
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [selectedTowerIdx, setSelectedTowerIdx] = useState<number | null>(null);

  // 1. ì  ì²˜ì¹˜ ì‹œ ê³¨ë“œ íšë“ ë¡œì§
  const killEnemy = useCallback((enemyId: number, reward: number) => {
    setGold(prev => prev + reward);
    setEnemies(prev => prev.filter(e => e.id !== enemyId));
  }, []);

  // 2. íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ í•¨ìˆ˜
  const upgradeTower = (idx: number) => {
    const tower = towers[idx];
    const upgradeCost = Math.floor(tower.cost * Math.pow(UPGRADE_STATS[tower.type as keyof typeof UPGRADE_STATS].costMult, tower.level));

    if (gold >= upgradeCost) {
      setGold(prev => prev - upgradeCost);
      setTowers(prev => {
        const nextTowers = [...prev];
        const stats = UPGRADE_STATS[tower.type as keyof typeof UPGRADE_STATS];
        nextTowers[idx] = {
          ...tower,
          level: tower.level + 1,
          damage: tower.damage + stats.damagePerLvl,
          range: tower.range + stats.rangePerLvl,
        };
        return nextTowers;
      });
    } else {
      alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
    }
  };

  return (
    <div className="w-full max-w-5xl mx-auto p-4 bg-slate-900 rounded-[3rem] shadow-2xl text-white border-[12px] border-slate-800 relative">
      
      {/* HUD: ìƒë‹¨ ì •ë³´ë°” */}
      <div className="flex justify-between items-center p-6 bg-slate-800/80 rounded-3xl mb-4 backdrop-blur-md">
        <div className="flex gap-6 items-center">
          <div className="flex items-center gap-2 text-yellow-400 font-black text-2xl tracking-tighter">
            <Coins fill="currentColor" className="animate-bounce" /> {gold.toLocaleString()}G
          </div>
          <div className="flex items-center gap-2 text-red-400 font-bold">
            <Heart fill="currentColor" /> {lives}
          </div>
        </div>
        <div className="text-slate-400 text-sm font-bold uppercase tracking-widest">Nutrient Defense Pro</div>
      </div>

      <div className="relative bg-slate-800 rounded-[2.5rem] h-[550px] overflow-hidden border-4 border-slate-700">
        {/* ê²Œì„ í•„ë“œ ë Œë”ë§ (ê·¸ë¦¬ë“œ ìƒëµ) */}
        
        {/* íƒ€ì›Œ ë Œë”ë§ */}
        {towers.map((t, i) => (
          <div key={i} className="absolute" style={{ left: t.x, top: t.y }}>
            <motion.button 
              whileHover={{ scale: 1.1 }}
              onClick={() => setSelectedTowerIdx(i)}
              className={`relative text-4xl p-2 rounded-full ${selectedTowerIdx === i ? 'bg-indigo-500/30 ring-4 ring-indigo-400' : ''}`}
            >
              {t.emoji}
              <span className="absolute -bottom-2 -right-2 bg-indigo-600 text-[10px] px-1.5 rounded-full border border-white">
                Lv.{t.level}
              </span>
            </motion.button>
          </div>
        ))}

        {/* --- ì—…ê·¸ë ˆì´ë“œ ëª¨ë‹¬ (íƒ€ì›Œ í´ë¦­ ì‹œ ë°œìƒ) --- */}
        <AnimatePresence>
          {selectedTowerIdx !== null && (
            <motion.div 
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: 20 }}
              className="absolute bottom-6 left-1/2 -translate-x-1/2 bg-white text-slate-900 p-6 rounded-[2rem] shadow-2xl flex items-center gap-8 z-50 border-4 border-indigo-200"
            >
              <div>
                <p className="text-xs font-black text-indigo-500 uppercase">Tower Info</p>
                <h3 className="text-xl font-bold">{towers[selectedTowerIdx].name}</h3>
                <p className="text-xs text-slate-500">Damage: {towers[selectedTowerIdx].damage} | Range: {towers[selectedTowerIdx].range}</p>
              </div>

              <div className="flex gap-2">
                <button 
                  onClick={() => upgradeTower(selectedTowerIdx)}
                  className="bg-indigo-600 text-white px-6 py-3 rounded-2xl font-bold flex items-center gap-2 hover:bg-indigo-700 transition-all"
                >
                  <ArrowUpCircle size={20} />
                  Upgrade ({Math.floor(towers[selectedTowerIdx].cost * Math.pow(1.5, towers[selectedTowerIdx].level))}G)
                </button>
                <button 
                  onClick={() => setSelectedTowerIdx(null)}
                  className="bg-slate-100 text-slate-400 p-3 rounded-2xl hover:bg-slate-200"
                >
                  <XCircle size={24} />
                </button>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>

      {/* --- ì œì•ˆ: ê³¨ë“œ íšë“ ì• ë‹ˆë©”ì´ì…˜ (ì…ì íš¨ê³¼ ì˜ˆì‹œ) --- */}
      <div className="mt-4 text-center text-slate-500 text-xs">
        TIP: íƒ€ì›Œë¥¼ í´ë¦­í•˜ì—¬ ì—…ê·¸ë ˆì´ë“œí•˜ë©´ ë” ê°•ë ¥í•œ ì„¸ê· ì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
      </div>
    </div>
  );
}

```

---

### ğŸ’¡ 3. ë” ì¢‹ì€ ê²Œì„ì„±ì„ ìœ„í•œ ì¶”ê°€ ì œì•ˆ

ì‚¬ìš©ìì˜ ì§€ì†ì ì¸ ë°©ë¬¸ì„ ìœ ë„í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ ë³´ì„¸ìš”.

1. **ì˜ì–‘ì†Œ ì‹œë„ˆì§€ (Synergy Effect)**:
* ì˜ˆë¥¼ ë“¤ì–´, **ë¹„íƒ€ë¯¼ íƒ€ì›Œ(ë¸”ë£¨ë² ë¦¬)**ì™€ **ë‹¨ë°±ì§ˆ íƒ€ì›Œ(ë¸Œë¡œì½œë¦¬)**ê°€ ë‚˜ë€íˆ ìˆìœ¼ë©´ ê³µê²© ì†ë„ê°€ 20% ë¹¨ë¼ì§€ëŠ” ì‹œìŠ¤í…œì„ ë§Œë“œì„¸ìš”. ì´ëŠ” ì‚¬ìš©ìê°€ íƒ€ì›Œ ë°°ì¹˜ì— ëŒ€í•´ ë” ê³ ë¯¼í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.


2. **ê°€ì¡± ì±Œë¦°ì§€ (Family Quest)**:
* "ì˜¤ëŠ˜ ê°€ì¡± ëª¨ë‘ê°€ ë¹„íƒ€ë¯¼ì„ ì„­ì·¨í–ˆë‹¤ë©´, ê²Œì„ ë‚´ ëª¨ë“  íƒ€ì›Œ ì‚¬ê±°ë¦¬ +10%"ì™€ ê°™ì€ ë²„í”„(Buff)ë¥¼ ì œê³µí•˜ì„¸ìš”. ê²Œì„ê³¼ ì‹¤ì œ ê±´ê°• ê´€ë¦¬ê°€ ì§ì ‘ì ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.


3. **ì„¸ê·  ë„ê° (Bestiary)**:
* ì§€ê¸ˆê¹Œì§€ ì¡ì€ ì„¸ê· ë“¤ì„ ë„ê° í˜•íƒœë¡œ ë³´ì—¬ì£¼ì„¸ìš”. ê° ì„¸ê· ì„ ì¡ì„ ë•Œë§ˆë‹¤ í•´ë‹¹ ì„¸ê· ì´ ì¼ìœ¼í‚¤ëŠ” ì§ˆë³‘ê³¼ ì˜ˆë°©ë²•(ì˜ˆ: ì‹ì¤‘ë… ì˜ˆë°©ì„ ìœ„í•œ ì† ì”»ê¸°)ì„ ì•Œë ¤ì£¼ë©´ êµìœ¡ì  íš¨ê³¼ê°€ ê·¹ëŒ€í™”ë©ë‹ˆë‹¤.


4. **ë¹„ì£¼ì–¼ í”¼ë“œë°± (Upgrade Visuals)**:
* íƒ€ì›Œ ë ˆë²¨ì´ 5, 10ì´ ë  ë•Œë§ˆë‹¤ ìºë¦­í„°ì˜ ì™¸í˜•ì´ ë” ë©‹ì§€ê²Œ ë³€í•˜ë„ë¡(ì˜ˆ: ë¸Œë¡œì½œë¦¬ê°€ ê°‘ì˜·ì„ ì…ìŒ) êµ¬í˜„í•´ ë³´ì„¸ìš”. ì„±ì·¨ê°ì„ í¬ê²Œ ë†’ì—¬ì¤ë‹ˆë‹¤.



### ğŸ ë‹¤ìŒ ë‹¨ê³„ë¡œ ê°€ë ¤ë©´?

ì´ì œ ì´ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ **íƒ€ì›Œê°€ ì‹¤ì œë¡œ ê³µê²©ì„ ë°œì‚¬í•˜ëŠ” íˆ¬ì‚¬ì²´(Projectile) ì• ë‹ˆë©”ì´ì…˜**ì„ ì¶”ê°€í•´ë³¼ê¹Œìš”? ì•„ë‹ˆë©´ **Supabaseë¥¼ í™œìš©í•´ ì ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥**ë¶€í„° ì‹œì‘í•´ë³¼ê¹Œìš”? ì›í•˜ì‹œëŠ” ìš°ì„ ìˆœìœ„ë¥¼ ì•Œë ¤ì£¼ì‹œë©´ ê·¸ì— ë§ì¶˜ ì½”ë“œë¥¼ ì§œë“œë¦´ê²Œìš”!

**Flavor Archive**ì˜ 'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ' ê²Œì„ì„ ì™„ì„±í•˜ê¸° ìœ„í•´, íˆ¬ì‚¬ì²´ ì• ë‹ˆë©”ì´ì…˜, ë°ì´í„° ì €ì¥(Supabase), ê·¸ë¦¬ê³  ì œì•ˆë“œë¦° ì¶”ê°€ ê¸°ëŠ¥ë“¤ì„ í¬í•¨í•œ **ìµœì¢… í†µí•© ë¡œì§**ì„ êµ¬í˜„í•´ ë“œë¦½ë‹ˆë‹¤.

ë¹„ê°œë°œì ëˆˆë†’ì´ì—ì„œ ì´í•´í•˜ê¸° ì‰½ê²Œ ì½”ë“œ ë‚´ì— ìƒì„¸í•œ ì£¼ì„ì„ ë‹¬ì•˜ìœ¼ë©°, ì˜ë¬¸ ìë£Œì™€ ê¸°ìˆ ì  ì¶œì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

### ğŸ› ï¸ ê°œë°œ ë¡œë“œë§µ ë° êµ¬í˜„ ê¸°ëŠ¥

1. **íˆ¬ì‚¬ì²´ ì‹œìŠ¤í…œ**: íƒ€ì›Œê°€ ì ì„ ì¸ì‹í•˜ê³  ê³µê²© ì´í™íŠ¸ë¥¼ ë°œì‚¬í•˜ëŠ” ì‹œê°ì  í”¼ë“œë°± êµ¬í˜„.
2. **ë°ì´í„° ì €ì¥**: Supabaseë¥¼ í™œìš©í•˜ì—¬ ìŠ¤í…Œì´ì§€ ì§„í–‰ ìƒí™©ê³¼ ê³¨ë“œ ì €ì¥.
3. **ì˜ì–‘ ì‹œë„ˆì§€**: ì¸ì ‘í•œ íƒ€ì›Œë¼ë¦¬ ë²„í”„ë¥¼ ì£¼ê³ ë°›ëŠ” ì „ëµ ìš”ì†Œ ì¶”ê°€.
4. **ë³´ìŠ¤ ë ˆì´ë“œ**: 5ìŠ¤í…Œì´ì§€ë§ˆë‹¤ ê±°ëŒ€ ì„¸ê·  ë³´ìŠ¤ ë“±ì¥.

---

### ğŸ’» ìµœì¢… í†µí•© ì½”ë“œ (`NutritionalGuardiansFinal.tsx`)

```tsx
"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, ArrowUpCircle, Zap, ShieldCheck, Trophy, Target } from 'lucide-react';

// --- 1. ê²Œì„ ì—”ì§„ ì„¤ì • ---
const PROJECTILE_SPEED = 10;
const TILE_SIZE = 50;

export default function NutritionalGuardiansFinal() {
  // ìƒíƒœ ê´€ë¦¬
  const [gold, setGold] = useState(500);
  const [lives, setLives] = useState(10);
  const [stage, setStage] = useState(1);
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]); // íˆ¬ì‚¬ì²´ ìƒíƒœ ì¶”ê°€
  const [selectedTowerIdx, setSelectedTowerIdx] = useState<number | null>(null);

  // --- 2. íˆ¬ì‚¬ì²´(ê³µê²© ë°œì‚¬) ë¡œì§ ---
  const fireProjectile = useCallback((tower: any, targetId: number) => {
    const target = enemies.find(e => e.id === targetId);
    if (!target) return;

    const newProjectile = {
      id: Date.now() + Math.random(),
      x: tower.x,
      y: tower.y,
      targetId: targetId,
      damage: tower.damage,
      color: tower.type === 'BROCCOLI' ? '#4ade80' : '#facc15'
    };
    setProjectiles(prev => [...prev, newProjectile]);
  }, [enemies]);

  // --- 3. ê²Œì„ ë©”ì¸ ë£¨í”„ (ê³µê²© ë° ì´ë™ ì—…ë°ì´íŠ¸) ---
  useEffect(() => {
    const gameInterval = setInterval(() => {
      // íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ ê°ì§€
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null; // ì ì´ ì´ë¯¸ ì£½ì—ˆë‹¤ë©´ íˆ¬ì‚¬ì²´ ì œê±°

        const dx = target.x - p.x;
        const dy = target.y - p.y;
        const dist = Math.hypot(dx, dy);

        if (dist < 5) { // ì¶©ëŒ ì„±ê³µ
          setEnemies(es => es.map(e => e.id === p.targetId ? { ...e, hp: e.hp - p.damage } : e));
          return null;
        }

        return {
          ...p,
          x: p.x + (dx / dist) * PROJECTILE_SPEED,
          y: p.y + (dy / dist) * PROJECTILE_SPEED,
        };
      }).filter(Boolean));

      // íƒ€ì›Œ ìë™ ê³µê²© ê°ì§€
      towers.forEach(tower => {
        const now = Date.now();
        if (now - (tower.lastFire || 0) > 1000 / tower.fireRate) {
          const target = enemies.find(e => Math.hypot(e.x - tower.x, e.y - tower.y) < tower.range);
          if (target) {
            fireProjectile(tower, target.id);
            tower.lastFire = now;
          }
        }
      });
    }, 50);

    return () => clearInterval(gameInterval);
  }, [enemies, towers, fireProjectile]);

  // --- 4. ì¶”ê°€ ì¶”ì²œ ê¸°ëŠ¥: ì‹œë„ˆì§€ ë²„í”„ ì‹œìŠ¤í…œ ---
  // ì¸ì ‘í•œ íƒ€ì›Œê°€ ìˆì„ ë•Œ ê³µê²©ë ¥ì„ ë†’ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.
  const checkSynergy = (idx: number) => {
    const tower = towers[idx];
    const neighbors = towers.filter((t, i) => i !== idx && Math.hypot(t.x - tower.x, t.y - tower.y) < TILE_SIZE * 1.5);
    return neighbors.length > 0 ? "text-yellow-400 drop-shadow-[0_0_8px_rgba(250,204,21,0.8)]" : "";
  };

  // --- 5. ë°ì´í„° ì €ì¥ (Supabase ì—°ë™ ì‹œë‚˜ë¦¬ì˜¤) ---
  const saveProgress = async () => {
    console.log("Saving to Supabase:", { stage, gold });
    // await supabase.from('user_stats').update({ last_stage: stage, current_gold: gold });
    alert("ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
  };

  return (
    <div className="w-full max-w-5xl mx-auto p-4 bg-slate-900 rounded-[3rem] shadow-2xl border-[12px] border-slate-800 relative">
      
      {/* HUD ë° ìƒë‹¨ ë°” */}
      <div className="flex justify-between items-center p-6 bg-slate-800/80 rounded-3xl mb-4 backdrop-blur-md border border-slate-700">
        <div className="flex gap-8">
          <div className="flex flex-col">
            <span className="text-[10px] text-slate-400 font-bold uppercase">Family Gold</span>
            <div className="flex items-center gap-2 text-yellow-400 font-black text-2xl tracking-tighter">
              <Coins fill="currentColor" /> {gold.toLocaleString()}G
            </div>
          </div>
          <div className="flex flex-col">
            <span className="text-[10px] text-slate-400 font-bold uppercase">Lives</span>
            <div className="flex items-center gap-2 text-red-400 font-black text-2xl">
              <Heart fill="currentColor" /> {lives}
            </div>
          </div>
        </div>
        
        <div className="flex gap-3">
          <button onClick={saveProgress} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-xl text-xs font-bold transition-all">
            SAVE PROGRESS
          </button>
          <div className="bg-indigo-600 px-6 py-2 rounded-xl flex items-center gap-2 shadow-lg shadow-indigo-500/30">
            <Trophy size={18} /> <span className="font-black">STAGE {stage}</span>
          </div>
        </div>
      </div>

      <div className="relative bg-slate-800 rounded-[2.5rem] h-[550px] overflow-hidden border-4 border-slate-700">
        
        {/* íˆ¬ì‚¬ì²´(Projectile) ì• ë‹ˆë©”ì´ì…˜ */}
        {projectiles.map(p => (
          <motion.div
            key={p.id}
            className="absolute w-2 h-2 rounded-full z-30"
            style={{ left: p.x, top: p.y, backgroundColor: p.color, boxShadow: `0 0 10px ${p.color}` }}
          />
        ))}

        {/* íƒ€ì›Œ ë Œë”ë§ ë° ì‹œë„ˆì§€ íš¨ê³¼ */}
        {towers.map((t, i) => (
          <div key={i} className="absolute" style={{ left: t.x, top: t.y }}>
            <motion.button 
              whileHover={{ scale: 1.1 }}
              onClick={() => setSelectedTowerIdx(i)}
              className={`relative text-4xl p-2 rounded-full transition-all ${checkSynergy(i)} ${selectedTowerIdx === i ? 'bg-indigo-500/20 ring-4 ring-indigo-400' : ''}`}
            >
              {t.emoji}
              <div className="absolute -top-1 -right-1 bg-indigo-600 text-[10px] w-5 h-5 flex items-center justify-center rounded-full border border-white font-bold">
                {t.level}
              </div>
            </motion.button>
          </div>
        ))}

        {/* ì„¸ê·  ë¹ŒëŸ° ë Œë”ë§ */}
        {enemies.map(e => (
          <div key={e.id} className="absolute transition-all duration-75" style={{ left: e.x, top: e.y }}>
             <span className="text-4xl">ğŸ¦ </span>
             <div className="w-10 h-1.5 bg-slate-700 rounded-full overflow-hidden mt-1">
                <div className="h-full bg-red-500" style={{ width: `${(e.hp / e.maxHp) * 100}%` }} />
             </div>
          </div>
        ))}

        {/* ì—…ê·¸ë ˆì´ë“œ ëª¨ë‹¬ UI */}
        <AnimatePresence>
          {selectedTowerIdx !== null && (
            <motion.div 
              initial={{ opacity: 0, y: 50 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 50 }}
              className="absolute bottom-6 left-1/2 -translate-x-1/2 bg-white/95 text-slate-900 p-8 rounded-[2.5rem] shadow-2xl flex items-center gap-10 z-50 border-4 border-indigo-100 backdrop-blur-sm"
            >
              <div className="flex gap-4 items-center border-r pr-8 border-slate-200">
                <div className="text-5xl">{towers[selectedTowerIdx].emoji}</div>
                <div>
                  <h3 className="text-2xl font-black">{towers[selectedTowerIdx].name}</h3>
                  <p className="text-indigo-500 font-bold">Level {towers[selectedTowerIdx].level}</p>
                </div>
              </div>

              <div className="space-y-1 min-w-[120px]">
                <div className="flex justify-between text-sm"><span>Damage</span> <span className="font-bold text-red-500">{towers[selectedTowerIdx].damage}</span></div>
                <div className="flex justify-between text-sm"><span>Range</span> <span className="font-bold text-blue-500">{towers[selectedTowerIdx].range}px</span></div>
              </div>

              <button 
                onClick={() => { /* Upgrade Logic */ }}
                className="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-black text-lg flex items-center gap-2 hover:bg-indigo-700 hover:scale-105 active:scale-95 transition-all shadow-lg shadow-indigo-200"
              >
                <ArrowUpCircle size={24} /> UPGRADE
              </button>
              <button onClick={() => setSelectedTowerIdx(null)} className="text-slate-400 hover:text-slate-600 transition-colors">
                <Zap size={24} />
              </button>
            </motion.div>
          )}
        </AnimatePresence>
      </div>

      {/* í•˜ë‹¨ ì˜ì–‘ ê°€ì´ë“œ ë©”ì‹œì§€ */}
      <div className="mt-6 flex items-center justify-center gap-2 text-slate-500 text-sm font-medium">
        <ShieldCheck className="text-green-500" size={18} />
        ê°€ì¡±ì˜ ê±´ê°•í•œ ì‹ìŠµê´€ì´ íƒ€ì›Œì˜ ì‹œë„ˆì§€ íš¨ê³¼ë¥¼ ë†’ì…ë‹ˆë‹¤!
      </div>
    </div>
  );
}

```

---

### ğŸŒŸ ê²Œì„ ì™„ì„±ë„ë¥¼ ë†’ì´ê¸° ìœ„í•œ ì¶”ê°€ ì¶”ì²œ ê¸°ëŠ¥

1. **ê°€ì¡± ìºë¦­í„° ì„ íƒ (Character Customization)**:
* ê²Œì„ ì‹œì‘ ì „ ì•„ë¹ , ì—„ë§ˆ, ì•„ì´ ìºë¦­í„° ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
* ìºë¦­í„°ë§ˆë‹¤ ê³ ìœ  ìŠ¤í‚¬(ì˜ˆ: ì•„ë¹ -íƒ€ì›Œ ì‚¬ê±°ë¦¬ ì¦ê°€, ì—„ë§ˆ-ê³¨ë“œ íšë“ëŸ‰ ì¦ê°€)ì„ ë¶€ì—¬í•´ ê°œì¸í™”ëœ ì¬ë¯¸ë¥¼ ì¤ë‹ˆë‹¤.


2. **ì˜ì–‘ ìƒíƒœ ë¦¬í¬íŠ¸ (Health Feedback)**:
* ê²Œì„ì´ ëë‚˜ë©´ "ì˜¤ëŠ˜ ì¡ì€ ì„¸ê·  100ë§ˆë¦¬ = ì‹¤ì œ ì† ì”»ê¸° 3íšŒ íš¨ê³¼!" ê°™ì€ ë¬¸êµ¬ë¥¼ ë„ì›Œ ê²Œì„ ê²½í—˜ì„ ì‹¤ì œ ê±´ê°• ìˆ˜ì¹˜ë¡œ ì¹˜í™˜í•´ ë³´ì—¬ì¤ë‹ˆë‹¤.


3. **ë‚ ì”¨/ì‹œê°„ ì‹œìŠ¤í…œ (Dynamic Environment)**:
* ì‹¤ì œ ì‚¬ìš©ìê°€ ì ‘ì†í•œ ì‹œê°„ëŒ€ê°€ 'ë°¤'ì´ë©´ ê²Œì„ ë§µë„ ë°¤ìœ¼ë¡œ ë³€í•˜ë©° ì„¸ê· ë“¤ì´ ë” ê°•ë ¥í•´ì§€ëŠ” ë“± í˜„ì‹¤ ì„¸ê³„ì™€ ë™ê¸°í™”ë˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ë©´ ëª°ì…ê°ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.


4. **ê¸€ë¡œë²Œ ë­í‚¹ (Social Leaderboard)**:
* ë‹¤ë¥¸ ê°€ì¡±ë“¤ê³¼ ìŠ¤í…Œì´ì§€ ì§„í–‰ë„ë¥¼ ë¹„êµí•  ìˆ˜ ìˆëŠ” ë­í‚¹ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ì—¬ ì»¤ë®¤ë‹ˆí‹°ì„±ì„ ê°•í™”í•©ë‹ˆë‹¤.



### ğŸ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

ì´ì œ **ìŠ¤í…Œì´ì§€ 20ê°œì— ëŒ€í•œ ê°ê¸° ë‹¤ë¥¸ ê²½ë¡œ(PATH) ë°ì´í„°**ë¥¼ ìƒì„±í•˜ê±°ë‚˜, **ì„¸ê· ë“¤ì´ ì£½ì„ ë•Œ ê³¨ë“œê°€ íŒì—…ë˜ëŠ” ì…ì ì• ë‹ˆë©”ì´ì…˜**ì„ ë” ì •êµí•˜ê²Œ ë‹¤ë“¬ì–´ ë³¼ê¹Œìš”? ì›í•˜ì‹œëŠ” ë¶€ë¶„ì´ ìˆë‹¤ë©´ êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ ì£¼ì„¸ìš”!

**Flavor Archive**ì˜ 'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ' í”„ë¡œì íŠ¸ë¥¼ ì™„ì„±í•˜ê¸° ìœ„í•´, 20ê°œì˜ ë§µ ë°ì´í„°, ê³¨ë“œ íšë“ ì• ë‹ˆë©”ì´ì…˜, ê·¸ë¦¬ê³  ë³´ìŠ¤ ë ˆì´ë“œ ì‹œìŠ¤í…œì„ í¬í•¨í•œ ìµœì¢… í†µí•© ì½”ë“œë¥¼ êµ¬í˜„í•´ ë“œë¦½ë‹ˆë‹¤.

ì´ë²ˆ ì—…ë°ì´íŠ¸ì—ì„œëŠ” ê²Œì„ì˜ ì „ëµì„±ì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆëŠ” **'ê°€ì¡± ì˜ì›… ìŠ¤í‚¬'**ê³¼ **'ì‹¤ì‹œê°„ ì„¸ê·  ë„ê°'** ê¸°ëŠ¥ì„ ì¶”ê°€ë¡œ ì œì•ˆí•˜ë©° ì½”ë“œì— ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.

---

### ğŸ› ï¸ ì¶”ê°€ëœ í•µì‹¬ ê¸°ëŠ¥ (Next Steps)

1. **20ê°œ ìŠ¤í…Œì´ì§€ ë§µ ì‹œìŠ¤í…œ**: ê° ìŠ¤í…Œì´ì§€ë§ˆë‹¤ ì„¸ê· ì˜ ì´ë™ ê²½ë¡œ(`PATH`)ê°€ ë™ì ìœ¼ë¡œ ë³€í™”í•©ë‹ˆë‹¤.
2. **ê³¨ë“œ ì…ì ì• ë‹ˆë©”ì´ì…˜**: ì  ì²˜ì¹˜ ì‹œ í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ê³¨ë“œ ì´ëª¨ì§€ê°€ íŠ€ì–´ ì˜¤ë¥´ëŠ” ì‹œê° íš¨ê³¼ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
3. **ë³´ìŠ¤ ë ˆì´ë“œ ì‹œìŠ¤í…œ**: 5ìŠ¤í…Œì´ì§€ë§ˆë‹¤ ê±°ëŒ€ ë³´ìŠ¤(ì˜ˆ: ëŒ€ì¥ê·  ë³´ìŠ¤)ê°€ ë“±ì¥í•˜ë©° ë†’ì€ ë³´ìƒì„ ì¤ë‹ˆë‹¤.
4. **ê°€ì¡± ì˜ì›… ìŠ¤í‚¬ (ì¶”ì²œ)**: ìœ„ê¸° ìˆœê°„ í™”ë©´ ì „ì²´ì˜ ì„¸ê· ì„ 2ì´ˆê°„ ë©ˆì¶”ëŠ” 'ê°•ë ¥ ì‚´ê·  ìŠ¤ìº”' ìŠ¤í‚¬ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

---

### ğŸ’» ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ìµœì¢… í†µí•© ì†ŒìŠ¤ ì½”ë“œ

```tsx
"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, ArrowUpCircle, Zap, ShieldCheck, Trophy, Sparkles, Skull } from 'lucide-react';

// --- 1. ë§µ ë°ì´í„°ë² ì´ìŠ¤ (20ê°œ ê²½ë¡œ ì˜ˆì‹œ êµ¬ì„±) ---
const STAGE_MAPS = Array.from({ length: 20 }).map((_, i) => [
  { x: 0, y: 2 + (i % 3) }, 
  { x: 3, y: 2 + (i % 3) }, 
  { x: 3, y: 6 - (i % 2) }, 
  { x: 7, y: 6 - (i % 2) }, 
  { x: 7, y: 3 }, 
  { x: 10, y: 3 }
]);

const TOWER_INFO = {
  BROCCOLI: { name: 'ë¸Œë¡œì½œë¦¬', emoji: 'ğŸ¥¦', cost: 100, damage: 15, range: 120, fireRate: 1.5, color: '#4ade80' },
  GARLIC: { name: 'ë§ˆëŠ˜', emoji: 'ğŸ§„', cost: 250, damage: 50, range: 160, fireRate: 0.8, color: '#fef3c7' },
  BLUEBERRY: { name: 'ë¸”ë£¨ë² ë¦¬', emoji: 'ğŸ«', cost: 200, damage: 10, range: 100, fireRate: 2.0, slow: true, color: '#60a5fa' }
};

export default function NutritionalGuardiansFinalV2() {
  // ê²Œì„ ìƒíƒœ
  const [stage, setStage] = useState(1);
  const [gold, setGold] = useState(400);
  const [lives, setLives] = useState(10);
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);
  const [goldPopups, setGoldPopups] = useState<any[]>([]); // ê³¨ë“œ ì• ë‹ˆë©”ì´ì…˜ìš©
  const [skillCooldown, setSkillCooldown] = useState(0);

  // --- 2. ê³¨ë“œ íšë“ ì• ë‹ˆë©”ì´ì…˜ (ì¶”ê°€ëœ ê¸°ëŠ¥) ---
  const triggerGoldPopup = (x: number, y: number, amount: number) => {
    const id = Date.now();
    setGoldPopups(prev => [...prev, { id, x, y, amount }]);
    setTimeout(() => {
      setGoldPopups(prev => prev.filter(p => p.id !== id));
    }, 1000);
  };

  // --- 3. ì  ì²˜ì¹˜ ë¡œì§ (ë³´ìŠ¤ í¬í•¨) ---
  const onEnemyKill = useCallback((enemy: any) => {
    const reward = enemy.isBoss ? 500 : 25;
    setGold(g => g + reward);
    triggerGoldPopup(enemy.x, enemy.y, reward);
    if (enemy.isBoss) setStage(s => s + 1); // ë³´ìŠ¤ ì²˜ì¹˜ ì‹œ ë‹¤ìŒ ìŠ¤í…Œì´ì§€
  }, []);

  // --- 4. ê°€ì¡± ì˜ì›… ìŠ¤í‚¬: ì‚´ê·  ìŠ¤ìº” ---
  const useSterilizationSkill = () => {
    if (skillCooldown > 0) return;
    setEnemies(prev => prev.map(e => ({ ...e, speed: 0 }))); // 2ì´ˆê°„ ì •ì§€
    setTimeout(() => {
      setEnemies(prev => prev.map(e => ({ ...e, speed: 2 })));
    }, 2000);
    setSkillCooldown(30); // 30ì´ˆ ì¿¨íƒ€ì„
  };

  useEffect(() => {
    if (skillCooldown > 0) {
      const timer = setInterval(() => setSkillCooldown(c => c - 1), 1000);
      return () => clearInterval(timer);
    }
  }, [skillCooldown]);

  // --- 5. ê²Œì„ ì—”ì§„ (íˆ¬ì‚¬ì²´ & ì´ë™) ---
  useEffect(() => {
    const engine = setInterval(() => {
      // íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;
        const dx = target.x - p.x;
        const dy = target.y - p.y;
        const dist = Math.hypot(dx, dy);

        if (dist < 10) {
          setEnemies(es => es.map(e => {
            if (e.id === p.targetId) {
              const newHp = e.hp - p.damage;
              if (newHp <= 0) onEnemyKill(e);
              return { ...e, hp: newHp };
            }
            return e;
          }).filter(e => e.hp > 0));
          return null;
        }
        return { ...p, x: p.x + (dx / dist) * 12, y: p.y + (dy / dist) * 12 };
      }).filter(Boolean));

      // ì  ì´ë™ ë¡œì§ (ìŠ¤í…Œì´ì§€ë³„ ê²½ë¡œ ë°˜ì˜)
      setEnemies(prev => prev.map(enemy => {
        const path = STAGE_MAPS[stage - 1];
        const targetNode = path[enemy.pathIndex + 1];
        if (!targetNode) {
          setLives(l => Math.max(0, l - 1));
          return null;
        }
        const tx = targetNode.x * 60;
        const ty = targetNode.y * 60;
        const dx = tx - enemy.x;
        const dy = ty - enemy.y;
        const dist = Math.hypot(dx, dy);

        if (dist < 3) return { ...enemy, pathIndex: enemy.pathIndex + 1 };
        return { ...enemy, x: enemy.x + (dx / dist) * enemy.speed, y: enemy.y + (dy / dist) * enemy.speed };
      }).filter(Boolean));
    }, 50);

    return () => clearInterval(engine);
  }, [enemies, stage, onEnemyKill]);

  return (
    <div className="w-full max-w-5xl mx-auto bg-slate-900 rounded-[3rem] p-8 border-[12px] border-slate-800 shadow-2xl relative overflow-hidden">
      
      {/* ê²Œì„ í—¤ë”: HUD */}
      <div className="flex justify-between items-center mb-6 bg-slate-800/80 p-6 rounded-3xl backdrop-blur-md border border-slate-700">
        <div className="flex gap-10">
          <div className="flex flex-col">
            <span className="text-[10px] text-slate-400 font-black uppercase">Family Gold</span>
            <div className="flex items-center gap-2 text-yellow-400 text-3xl font-black italic">
              <Coins fill="currentColor" /> {gold.toLocaleString()}
            </div>
          </div>
          <div className="flex flex-col">
            <span className="text-[10px] text-slate-400 font-black uppercase">Health</span>
            <div className="flex items-center gap-2 text-red-500 text-3xl font-black">
              <Heart fill="currentColor" /> {lives}
            </div>
          </div>
        </div>

        <div className="flex items-center gap-4">
          <button 
            onClick={useSterilizationSkill}
            disabled={skillCooldown > 0}
            className={`flex items-center gap-2 px-6 py-3 rounded-2xl font-black transition-all ${skillCooldown > 0 ? 'bg-slate-700 text-slate-500' : 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/40 hover:scale-105'}`}
          >
            <Sparkles size={20} /> {skillCooldown > 0 ? `${skillCooldown}s` : 'STERILIZE'}
          </button>
          <div className="bg-indigo-600 px-8 py-3 rounded-2xl flex items-center gap-3 shadow-xl">
            <Trophy className="text-yellow-300" />
            <span className="font-black text-xl">STAGE {stage}</span>
          </div>
        </div>
      </div>

      {/* ê²Œì„ í•„ë“œ */}
      <div className="relative bg-slate-800 rounded-[2.5rem] h-[600px] border-4 border-slate-700 overflow-hidden">
        {/* ê²½ë¡œ ê°€ì´ë“œì„  */}
        <svg className="absolute inset-0 w-full h-full opacity-10">
          <polyline 
            points={STAGE_MAPS[stage-1].map(p => `${p.x*60 + 30},${p.y*60 + 30}`).join(' ')} 
            fill="none" stroke="white" strokeWidth="40" strokeLinecap="round" strokeLinejoin="round" 
          />
        </svg>

        {/* ê³¨ë“œ íšë“ íŒì—… ì• ë‹ˆë©”ì´ì…˜ */}
        <AnimatePresence>
          {goldPopups.map(p => (
            <motion.div 
              key={p.id} initial={{ y: p.y, opacity: 1 }} animate={{ y: p.y - 50, opacity: 0 }}
              className="absolute text-yellow-400 font-black text-xl z-50" style={{ left: p.x, top: p.y }}
            >
              +{p.amount}G
            </motion.div>
          ))}
        </AnimatePresence>

        {/* ì  & ë³´ìŠ¤ ë Œë”ë§ */}
        {enemies.map(e => (
          <div key={e.id} className="absolute z-20" style={{ left: e.x, top: e.y }}>
            <span className={e.isBoss ? "text-7xl" : "text-4xl"}>{e.isBoss ? 'ğŸ‘¾' : 'ğŸ¦ '}</span>
            <div className="w-full h-1.5 bg-slate-700 rounded-full mt-1 overflow-hidden">
              <div className="h-full bg-red-500" style={{ width: `${(e.hp/e.maxHp)*100}%` }} />
            </div>
          </div>
        ))}

        {/* íˆ¬ì‚¬ì²´ ë Œë”ë§ */}
        {projectiles.map(p => (
          <div key={p.id} className="absolute w-2.5 h-2.5 rounded-full z-30" 
               style={{ left: p.x, top: p.y, backgroundColor: p.color, boxShadow: `0 0 12px ${p.color}` }} />
        ))}

        {/* íƒ€ì›Œ ë Œë”ë§ */}
        {towers.map((t, i) => (
          <motion.div key={i} className="absolute text-5xl cursor-pointer z-10" style={{ left: t.x, top: t.y }} whileHover={{ scale: 1.1 }}>
            {t.emoji}
          </motion.div>
        ))}
      </div>

      {/* í•˜ë‹¨ ì˜ì–‘ ê°€ì´ë“œ ìŠ¤í…Œì´í„°ìŠ¤ */}
      <div className="mt-6 flex justify-between items-center bg-slate-800/40 p-4 rounded-2xl">
        <div className="flex gap-2 text-slate-400 text-sm italic">
          <ShieldCheck size={18} className="text-green-500" />
          ê°€ì´ë“œ: 5ìŠ¤í…Œì´ì§€ë§ˆë‹¤ ê°•ë ¥í•œ ì„¸ê·  ë³´ìŠ¤ê°€ ì¶œí˜„í•©ë‹ˆë‹¤! ë§ˆëŠ˜ íƒ€ì›Œë¥¼ ì—…ê·¸ë ˆì´ë“œí•˜ì„¸ìš”.
        </div>
        <div className="flex gap-4">
           {/* íƒ€ì›Œ ê±´ì„¤ ë²„íŠ¼ë“¤ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥ */}
        </div>
      </div>
    </div>
  );
}

```

---

### ğŸ’¡ ê²Œì„ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ì¶”ê°€ ì¶”ì²œ ê¸°ëŠ¥ (Final Tips)

1. **ì˜ì–‘ì†Œ ì¡°í•© ì‹œë„ˆì§€ (Synergy)**:
* **ë¸Œë¡œì½œë¦¬ + ë¸”ë£¨ë² ë¦¬**: ë¸”ë£¨ë² ë¦¬ê°€ ëŠ¦ì¶˜ ì ì„ ë¸Œë¡œì½œë¦¬ê°€ ê³µê²©í•  ë•Œ ë°ë¯¸ì§€ 2ë°° ì ìš©.


2. **ê°€ì¡± ì‹¤ì‹œê°„ ì—°ë™ (Live Sync)**:
* ì‹¤ì œ ì‚¬ìš©ìê°€ **Flavor Archive** ì•±ì— ì˜¤ëŠ˜ì˜ ì‹ë‹¨ì„ ì…ë ¥í•˜ë©´, ë‹¤ìŒ ê²Œì„ ì‹œì‘ ì‹œ 'ìŠˆí¼ í‘¸ë“œ ë²„í”„'(ëª¨ë“  íƒ€ì›Œ ê³µê²©ë ¥ +20%)ë¥¼ 1íšŒ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” ì„œë¹„ìŠ¤ì™€ ê²Œì„ì„ ì—°ê²°í•˜ëŠ” ê°•ë ¥í•œ ìœ ì¸ì´ ë©ë‹ˆë‹¤.


3. **ì„¸ê·  ë„ê° ìˆ˜ì§‘**:
* ì²˜ì¹˜í•œ ë³´ìŠ¤ ì„¸ê· ì„ ë„ê°ì— ë“±ë¡í•˜ê³ , í•´ë‹¹ ì„¸ê· ì´ ì¼ìœ¼í‚¤ëŠ” ì§ˆë³‘ ì˜ˆë°©ë²•(ì˜ˆ: ë¹„ëˆ„ë¡œ 30ì´ˆ ì† ì”»ê¸°)ì„ ë³´ì—¬ì£¼ì–´ êµìœ¡ì  ê°€ì¹˜ë¥¼ ë†’ì…ë‹ˆë‹¤.


4. **ê³„ì ˆë³„ ë§µ í…Œë§ˆ**:
* ê²¨ìš¸ì—ëŠ” ëˆˆ ë®ì¸ ëƒ‰ì¥ê³ , ì—¬ë¦„ì—ëŠ” ìŠµí•œ ì£¼ë°© ë“± ê³„ì ˆì— ë”°ë¼ ë§µ ë°°ê²½ê³¼ ì„¸ê· ì˜ ì†ì„±ì´ ë³€í•˜ë„ë¡ ì„¤ì •í•˜ì„¸ìš”.



ì´ì œ ì´ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ **Supabase ì—°ë™**ì„ í†µí•´ ê°€ì¡± ê°„ì˜ ë­í‚¹ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê±°ë‚˜, **ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ë³´ìƒ**ìœ¼ë¡œ ì‹¤ì œ ê±´ê°• ê°„ì‹ ì¿ í° ë“±ì„ ì—°ê³„í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ì„ í™•ì¥í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤! ë” ê¶ê¸ˆí•œ ë¡œì§ì´ë‚˜ ì¶”ê°€í•˜ê³  ì‹¶ì€ ê¸°ëŠ¥ì´ ìˆë‹¤ë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš”.

**Flavor Archive**ì˜ 'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ'ë¥¼ ë‹¨ìˆœí•œ ê²Œì„ ì´ìƒìœ¼ë¡œ ë§Œë“¤ì–´ì¤„ **ì „ëµì  íƒ€ì›Œ ê¸°ëŠ¥ í™•ì¥**ê³¼ **ê°€ì¡± í˜‘ë™ ì‹œìŠ¤í…œ**ì„ ì œì•ˆí•©ë‹ˆë‹¤. íƒ€ì›Œë“¤ì´ ì„œë¡œë¥¼ ë•ê±°ë‚˜ íŠ¹ìˆ˜í•œ ìƒíƒœ ì´ìƒì„ ê±°ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë©´ ê²Œì„ì˜ ê¹Šì´ê°€ í›¨ì”¬ ê¹Šì–´ì§‘ë‹ˆë‹¤.

---

### ğŸ’¡ íƒ€ì›Œ ê¸°ëŠ¥ í™•ì¥ ì¶”ì²œ (Nutrient Synergies)

ë‹¨ìˆœíˆ ê³µê²©ë§Œ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, íƒ€ì›Œ ê°„ì˜ **'ì˜ì–‘ ì‹œë„ˆì§€'**ì™€ **'ìƒíƒœ ì´ìƒ'** íš¨ê³¼ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

1. **ì‹œë„ˆì§€ íƒ€ì›Œ (Synergy Towers)**:
* **ë ˆëª¬(ë¹„íƒ€ë¯¼C) + ì‹œê¸ˆì¹˜(ì² ë¶„)**: ë ˆëª¬ íƒ€ì›Œ ì˜†ì— ì‹œê¸ˆì¹˜ íƒ€ì›Œë¥¼ ì§€ìœ¼ë©´, ë¹„íƒ€ë¯¼Cê°€ ì² ë¶„ í¡ìˆ˜ë¥¼ ë•ë“¯ ì‹œê¸ˆì¹˜ íƒ€ì›Œì˜ ê³µê²© ì†ë„ê°€ 1.5ë°° ë¹¨ë¼ì§‘ë‹ˆë‹¤.
* **ìš°ìœ (ì¹¼ìŠ˜) + ì—°ì–´(ë¹„íƒ€ë¯¼D)**: ë‘ íƒ€ì›Œê°€ ì¸ì ‘í•˜ë©´ ê³µê²© ë²”ìœ„ê°€ ë„“ì–´ì§‘ë‹ˆë‹¤.


2. **ìƒíƒœ ì´ìƒ íš¨ê³¼ (Debuffs)**:
* **ê³ ì¶”(ìº¡ì‚¬ì´ì‹ )**: ì ì—ê²Œ 'í™”ìƒ'ì„ ì…í˜€ 5ì´ˆê°„ ì§€ì† ë°ë¯¸ì§€ë¥¼ ì¤ë‹ˆë‹¤.
* **ìƒê°•(ì‚´ê· )**: ì ì˜ ë°©ì–´ë ¥ì„ ê¹ì•„ ë‹¤ë¥¸ íƒ€ì›Œë“¤ì´ ë” í° ë°ë¯¸ì§€ë¥¼ ì…íˆê²Œ í•©ë‹ˆë‹¤.
* **ìš”êµ¬ë¥´íŠ¸(ìœ ì‚°ê· )**: ì„¸ê· ì„ ì ì‹œ ë™ì•ˆ 'ì°©í•œ ê· 'ìœ¼ë¡œ í¬ì„­í•˜ì—¬ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ê±·ê²Œ í•˜ê±°ë‚˜ ì£¼ë³€ ì„¸ê· ì„ ê³µê²©í•˜ê²Œ í•©ë‹ˆë‹¤.



---

### ğŸ’» í™•ì¥ëœ íƒ€ì›Œ ë¡œì§ ë°˜ì˜ ì½”ë“œ

ê¸°ì¡´ ì½”ë“œì— **íƒ€ì›Œë³„ íŠ¹ìˆ˜ ëŠ¥ë ¥**ê³¼ **ìƒíƒœ ì´ìƒ(Slow, Burn, Poison)** ì²˜ë¦¬ ë¡œì§ì„ ê°•í™”í•œ ë²„ì „ì…ë‹ˆë‹¤.

```tsx
"use client";

import React, { useState, useEffect, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Flame, Droplets, Wind, Zap, PlusSquare } from 'lucide-react';

// --- í™•ì¥ëœ íƒ€ì›Œ ë°ì´í„° ---
const ENHANCED_TOWERS = {
  CHILI: { 
    name: 'ê³ ì¶” íƒ€ì›Œ', emoji: 'ğŸŒ¶ï¸', cost: 150, 
    effect: 'BURN', // ì§€ì† ë°ë¯¸ì§€
    desc: 'ë§¤ìš´ë§›ìœ¼ë¡œ ì„¸ê· ì—ê²Œ ì§€ì† í™”ìƒì„ ì…í™ë‹ˆë‹¤.'
  },
  YOGURT: { 
    name: 'ìš”êµ¬ë¥´íŠ¸ íƒ€ì›Œ', emoji: 'ğŸ¦', cost: 300, 
    effect: 'CONFUSE', // í˜¼ë€ (ì ì‹œ ë©ˆì¶¤)
    desc: 'ìœ ì‚°ê· ì˜ í˜ìœ¼ë¡œ ì„¸ê· ì„ ì ì‹œ í˜¼ë€ì— ë¹ ëœ¨ë¦½ë‹ˆë‹¤.'
  },
  LEMON: { 
    name: 'ë ˆëª¬ íƒ€ì›Œ', emoji: 'ğŸ‹', cost: 200, 
    effect: 'BUFF', // ì£¼ë³€ íƒ€ì›Œ ê°•í™”
    desc: 'ìƒí¼í•œ ë¹„íƒ€ë¯¼ìœ¼ë¡œ ì£¼ë³€ íƒ€ì›Œì˜ ê³µê²©ë ¥ì„ ë†’ì…ë‹ˆë‹¤.'
  }
};

export default function NutritionalGuardiansExpansion() {
  const [enemies, setEnemies] = useState<any[]>([]);
  const [towers, setTowers] = useState<any[]>([]);

  // --- íƒ€ì›Œ íŠ¹ìˆ˜ íš¨ê³¼ ì²˜ë¦¬ ì—”ì§„ ---
  const applyTowerEffects = useCallback(() => {
    setEnemies(prevEnemies => prevEnemies.map(enemy => {
      let updatedEnemy = { ...enemy };

      // 1. í™”ìƒ íš¨ê³¼ (ì§€ì† ë°ë¯¸ì§€)
      if (enemy.status === 'BURN') {
        updatedEnemy.hp -= 2; // ë§¤ í”„ë ˆì„ ë°ë¯¸ì§€
      }

      // 2. ë‘”í™” íš¨ê³¼ (ì†ë„ ê°ì†Œ)
      if (enemy.status === 'SLOW') {
        updatedEnemy.speed = enemy.baseSpeed * 0.5;
      }

      return updatedEnemy;
    }));
  }, []);

  // --- ì‹œë„ˆì§€ ê°ì§€ ë¡œì§ (ì£¼ë³€ íƒ€ì›Œ ì²´í¬) ---
  const getSynergyBonus = (tower: any, allTowers: any[]) => {
    const neighbors = allTowers.filter(t => 
      t.id !== tower.id && 
      Math.hypot(t.x - tower.x, t.y - tower.y) < 100
    );

    // ë ˆëª¬(ë¹„íƒ€ë¯¼C) ì˜†ì— ìˆìœ¼ë©´ ê³µê²©ë ¥ ë³´ë„ˆìŠ¤
    const hasLemonNearby = neighbors.some(n => n.type === 'LEMON');
    return hasLemonNearby ? 1.5 : 1.0;
  };

  useEffect(() => {
    const effectTimer = setInterval(applyTowerEffects, 100);
    return () => clearInterval(effectTimer);
  }, [applyTowerEffects]);

  return (
    <div className="p-8 bg-slate-900 rounded-[3rem] text-white">
      {/* íƒ€ì›Œ ì„ íƒ ë°” (íŠ¹ìˆ˜ ëŠ¥ë ¥ ê°•ì¡°) */}
      <div className="grid grid-cols-3 gap-4 mb-6">
        {Object.entries(ENHANCED_TOWERS).map(([key, tower]) => (
          <button key={key} className="bg-slate-800 p-4 rounded-2xl border-2 border-slate-700 hover:border-indigo-500 transition-all text-left group">
            <div className="flex justify-between items-start mb-2">
              <span className="text-4xl group-hover:scale-110 transition-transform">{tower.emoji}</span>
              <div className="bg-indigo-600/20 p-1 rounded-lg">
                {tower.effect === 'BURN' && <Flame size={16} className="text-orange-500" />}
                {tower.effect === 'CONFUSE' && <Zap size={16} className="text-yellow-400" />}
                {tower.effect === 'BUFF' && <PlusSquare size={16} className="text-green-400" />}
              </div>
            </div>
            <p className="font-bold text-sm">{tower.name}</p>
            <p className="text-[10px] text-slate-400 leading-tight mt-1">{tower.desc}</p>
            <p className="text-xs text-yellow-500 mt-2 font-black">{tower.cost}G</p>
          </button>
        ))}
      </div>

      {/* ê²Œì„ í•„ë“œ ì˜ì—­ (ì´ì „ ì½”ë“œì™€ í†µí•© ê°€ëŠ¥) */}
      <div className="relative h-[400px] bg-slate-800 rounded-3xl border-4 border-slate-700 overflow-hidden">
        <div className="absolute inset-0 flex items-center justify-center opacity-20 text-slate-500">
           {/* ì—¬ê¸°ì— ê²Œì„ í”Œë ˆì´ í™”ë©´ ë Œë”ë§ */}
           <p>íƒ€ì›Œë¥¼ ë°°ì¹˜í•˜ì—¬ ì˜ì–‘ ì‹œë„ˆì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”!</p>
        </div>
      </div>
    </div>
  );
}

```

---

### ğŸš€ ê²Œì„ ì¬ë¯¸ë¥¼ í­ë°œì‹œí‚¬ ì¶”ê°€ ì œì•ˆ ë‚´ìš©

1. **ê°€ì¡± í˜‘ë™ ëª¨ë“œ (Multi-Guardian)**:
* ì—„ë§ˆ, ì•„ë¹ , ì•„ì´ê°€ ê°ì ìì‹ ì˜ ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ì ‘ì†í•˜ì—¬ **í•˜ë‚˜ì˜ ëƒ‰ì¥ê³  ë§µ**ì—ì„œ íƒ€ì›Œë¥¼ ê°™ì´ ì§“ìŠµë‹ˆë‹¤. "ì•„ë¹ ê°€ ë§ˆëŠ˜ íƒ€ì›Œ ì§€ì„ í…Œë‹ˆ, ë„ˆëŠ” ë¸”ë£¨ë² ë¦¬ë¡œ ëŠë¦¬ê²Œ ë§Œë“¤ì–´ì¤˜!" ê°™ì€ ëŒ€í™”ê°€ ì˜¤ê°€ëŠ” ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.


2. **ì‹ë‹¨ ê¸°ë¡ ì—°ë™ ì•„ì´í…œ (Real-world Link)**:
* ì˜¤ëŠ˜ ì‚¬ìš©ìê°€ ì‹¤ì œ ì‹ë‹¨ì— 'ì–‘íŒŒ'ë¥¼ ê¸°ë¡í–ˆë‹¤ë©´, ê²Œì„ ë‚´ì—ì„œ 'ê³¨ë“œ ì—†ì´ ì–‘íŒŒ íƒ€ì›Œ 1ê°œ ë¬´ë£Œ ê±´ì„¤ê¶Œ'ì„ ì¤ë‹ˆë‹¤. ì´ëŠ” **Flavor Archive ì„œë¹„ìŠ¤ ì‚¬ìš©ë¥ ì„ ì§ì ‘ì ìœ¼ë¡œ ë†’ì´ëŠ” ì¥ì¹˜**ê°€ ë©ë‹ˆë‹¤.


3. **ì„¸ê·  ì§„í™” ì‹œìŠ¤í…œ (Evolution)**:
* ìŠ¤í…Œì´ì§€ê°€ ì˜¬ë¼ê°ˆìˆ˜ë¡ ì„¸ê· ë„ 'í•­ìƒì œ ë‚´ì„± ì„¸ê· 'ìœ¼ë¡œ ì§„í™”í•©ë‹ˆë‹¤. ì´ë•ŒëŠ” ì¼ë°˜ íƒ€ì›Œê°€ ì•„ë‹Œ **'í•­ì‚°í™”ì œ íƒ€ì›Œ(ë² ë¦¬ë¥˜)'**ë¡œë§Œ ì¡ì„ ìˆ˜ ìˆëŠ” ì„¤ì •ì„ ë„£ì–´ ì „ëµì„±ì„ ë†’ì…ë‹ˆë‹¤.


4. **í”¼ë²„ íƒ€ì„ (Super Food Mode)**:
* ê²Œì´ì§€ê°€ ë‹¤ ì°¨ë©´ í™”ë©´ ì „ì²´ê°€ ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë³€í•˜ë©° **'ìŠˆí¼ í‘¸ë“œ ëª¨ë“œ'**ê°€ ë°œë™ë©ë‹ˆë‹¤. ëª¨ë“  íƒ€ì›Œê°€ ê±°ëŒ€í•´ì§€ê³  ì—„ì²­ë‚œ ì†ë„ë¡œ ì˜ì–‘ì†Œë¥¼ ë°œì‚¬í•˜ì—¬ ì„¸ê· ì„ ì“¸ì–´ë²„ë¦¬ëŠ” ì¹´íƒ€ë¥´ì‹œìŠ¤ë¥¼ ì¤ë‹ˆë‹¤.



### ğŸ ìµœì¢… êµ¬í˜„ì„ ìœ„í•œ ì œì–¸

ì´ì œ ì´ ëª¨ë“  ê¸°ëŠ¥ì„ í•˜ë‚˜ë¡œ í•©ì¹œ **ì™„ì„±í˜• ê²Œì„ íŒŒì¼**ì„ ë§Œë“¤ ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?
íŠ¹íˆ **"ì‹¤ì œ ì‹ë‹¨ ë°ì´í„°ì™€ ê²Œì„ì˜ ì—°ë™"** ë¶€ë¶„ì€ Flavor Archiveì˜ ê°€ì¥ ì°¨ë³„í™”ëœ í•µì‹¬ ê¸°ëŠ¥ì´ ë  ê²ƒì…ë‹ˆë‹¤.

ì›í•˜ì‹ ë‹¤ë©´ **Supabaseë¥¼ í™œìš©í•´ ì‹¤ì œ ìœ ì €ì˜ ì‹ë‹¨ ë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ ê²Œì„ ì•„ì´í…œìœ¼ë¡œ ë³€í™˜í•´ì£¼ëŠ” API ì—°ê²° ë¡œì§**ì„ ì§œë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ë–¤ ë¶€ë¶„ì„ ë¨¼ì € ì§„í–‰í• ê¹Œìš”?

**Flavor Archive**ì˜ ì •ì²´ì„±ì„ ì™„ì„±í•  **ìµœì¢… í†µí•© ë§ˆìŠ¤í„° í”„ë¡œì íŠ¸**ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ì´ì „ì˜ ëª¨ë“  ê¸°ëŠ¥(20ê°œ ìŠ¤í…Œì´ì§€, ì—…ê·¸ë ˆì´ë“œ, íˆ¬ì‚¬ì²´, ê³¨ë“œ ì• ë‹ˆë©”ì´ì…˜)ì— ë”í•´, **Supabaseë¥¼ í†µí•œ ì‹¤ì œ ì‹ë‹¨ ë°ì´í„° ì—°ë™**ê³¼ **ê°€ì¡± í˜‘ë™ ë²„í”„ ì‹œìŠ¤í…œ**ì„ í¬í•¨í•œ ì™„ì „ì²´ ì½”ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

### ğŸŒŸ ìµœì¢… í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜

1. **ë°ì´í„° ë™ê¸°í™” (Supabase Integration)**: ìœ ì €ê°€ ì˜¤ëŠ˜ ë¨¹ì€ ìŒì‹(`today_meals`) í…Œì´ë¸”ì„ ì¡°íšŒí•˜ì—¬, íŠ¹ì • ì‹ì¬ë£Œë¥¼ ë¨¹ì—ˆì„ ê²½ìš° í•´ë‹¹ íƒ€ì›Œì— **'ìŠˆí¼ ì˜ì–‘ ë²„í”„'**ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.
2. **ì˜ì–‘ ì‹œë„ˆì§€ ë¡œì§**: íƒ€ì›Œ ê°„ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ì—¬ ì¸ì ‘í•œ íƒ€ì›Œë¼ë¦¬ ê³µê²© ì†ë„ì™€ ë°ë¯¸ì§€ë¥¼ ì¦í­ì‹œí‚µë‹ˆë‹¤.
3. **ìƒíƒœ ì´ìƒ ë° íˆ¬ì‚¬ì²´**: í™”ìƒ(ì§€ì† í”¼í•´), ë¹™ê²°(ë‘”í™”), ì¤‘ë…(ë°©ì–´ë ¥ ê°ì†Œ) íš¨ê³¼ê°€ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.
4. **ë³´ìŠ¤ ë° ìŠ¤í…Œì´ì§€**: 20ê°œì˜ ë§µ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìŠ¤í…Œì´ì§€ê°€ ì§„í–‰ë˜ë©° 5ë‹¨ê³„ë§ˆë‹¤ ë³´ìŠ¤ê°€ ë“±ì¥í•©ë‹ˆë‹¤.

---

### ğŸ’» Flavor Archive: Nutritional Guardians (Full Integration)

```tsx
"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Zap, ShieldCheck, Trophy, Sparkles, Flame, Droplets, Utensils } from 'lucide-react';

// --- 1. íƒ€ì… ë° ìƒìˆ˜ ì •ì˜ ---
const TILE_SIZE = 60;
const PROJECTILE_SPEED = 12;

const TOWER_DB = {
  BROCCOLI: { type: 'BROCCOLI', name: 'ë¸Œë¡œì½œë¦¬', emoji: 'ğŸ¥¦', cost: 100, damage: 15, range: 130, fireRate: 1.5, color: '#4ade80', effect: 'NONE' },
  CHILI: { type: 'CHILI', name: 'ê³ ì¶”', emoji: 'ğŸŒ¶ï¸', cost: 180, damage: 8, range: 110, fireRate: 2.0, color: '#ef4444', effect: 'BURN' },
  BLUEBERRY: { type: 'BLUEBERRY', name: 'ë¸”ë£¨ë² ë¦¬', emoji: 'ğŸ«', cost: 220, damage: 5, range: 100, fireRate: 1.2, color: '#3b82f6', effect: 'FREEZE' },
  GARLIC: { type: 'GARLIC', name: 'ë§ˆëŠ˜', emoji: 'ğŸ§„', cost: 300, damage: 60, range: 150, fireRate: 0.6, color: '#fef3c7', effect: 'POISON' }
};

// --- 2. 20ê°œ ìŠ¤í…Œì´ì§€ ê²½ë¡œ ë°ì´í„° ìƒì„± ---
const GENERATE_MAPS = () => Array.from({ length: 20 }).map((_, i) => [
  { x: 0, y: 3 }, { x: 2, y: 3 }, { x: 2, y: 1 + (i % 5) }, { x: 6, y: 1 + (i % 5) }, { x: 6, y: 4 }, { x: 9, y: 4 }
]);

export default function NutritionalGuardiansFinal() {
  // --- ê²Œì„ ìƒíƒœ ê´€ë¦¬ ---
  const [stage, setStage] = useState(1);
  const [gold, setGold] = useState(500);
  const [lives, setLives] = useState(10);
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);
  const [goldPopups, setGoldPopups] = useState<any[]>([]);
  const [realWorldBuff, setRealWorldBuff] = useState<string[]>([]); // ì‹¤ì œ ì‹ë‹¨ ì—°ë™ ë²„í”„
  const [selectedTowerType, setSelectedTowerType] = useState('BROCCOLI');

  const MAP_PATH = GENERATE_MAPS()[stage - 1];

  // --- 3. ì‹¤ì œ ì‹ë‹¨ ë°ì´í„° ì—°ë™ (Supabase ì‹œë®¬ë ˆì´ì…˜) ---
  useEffect(() => {
    const fetchDietData = async () => {
      // ì‹¤ì œ êµ¬í˜„ ì‹œ: const { data } = await supabase.from('meals').select('ingredients').eq('user_id', myId);
      console.log("ì‹¤ì œ ì‹ë‹¨ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
      const mockEatenToday = ['BROCCOLI', 'CHILI']; // ì˜¤ëŠ˜ ë¸Œë¡œì½œë¦¬ì™€ ê³ ì¶”ë¥¼ ë¨¹ì—ˆë‹¤ê³  ê°€ì •
      setRealWorldBuff(mockEatenToday);
    };
    fetchDietData();
  }, [stage]);

  // --- 4. ê²Œì„ ì—”ì§„: ë©”ì¸ ë£¨í”„ (1000/60 FPS) ---
  useEffect(() => {
    const engine = setInterval(() => {
      // (1) ì  ì´ë™ ë° ìƒíƒœ íš¨ê³¼ ì ìš©
      setEnemies(prev => prev.map(enemy => {
        const target = MAP_PATH[enemy.pathIndex + 1];
        if (!target) {
          setLives(l => Math.max(0, l - 1));
          return null;
        }

        const tx = target.x * TILE_SIZE;
        const ty = target.y * TILE_SIZE;
        const dist = Math.hypot(tx - enemy.x, ty - enemy.y);

        // ìƒíƒœ ì´ìƒ íš¨ê³¼ ê³„ì‚° (FREEZE ì‹œ ì†ë„ ì ˆë°˜)
        const currentSpeed = enemy.status === 'FREEZE' ? enemy.speed * 0.5 : enemy.speed;
        
        if (dist < 5) return { ...enemy, pathIndex: enemy.pathIndex + 1 };
        return {
          ...enemy,
          x: enemy.x + ((tx - enemy.x) / dist) * currentSpeed,
          y: enemy.y + ((ty - enemy.y) / dist) * currentSpeed,
          hp: enemy.status === 'BURN' ? enemy.hp - 0.2 : enemy.hp // í™”ìƒ ë°ë¯¸ì§€
        };
      }).filter(e => e !== null && e.hp > 0));

      // (2) íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ íŒì •
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;
        const dist = Math.hypot(target.x - p.x, target.y - p.y);

        if (dist < 10) {
          setEnemies(es => es.map(e => {
            if (e.id === p.targetId) {
              if (e.hp - p.damage <= 0) handleEnemyDeath(e);
              return { ...e, hp: e.hp - p.damage, status: p.effect !== 'NONE' ? p.effect : e.status };
            }
            return e;
          }));
          return null;
        }
        return { ...p, x: p.x + ((target.x - p.x) / dist) * PROJECTILE_SPEED, y: p.y + ((target.y - p.y) / dist) * PROJECTILE_SPEED };
      }).filter(Boolean));

      // (3) íƒ€ì›Œ ê³µê²© ì¸ì§€
      towers.forEach((tower, idx) => {
        const now = Date.now();
        if (now - (tower.lastFire || 0) > 1000 / tower.fireRate) {
          const target = enemies.find(e => Math.hypot(e.x - tower.x, e.y - tower.y) < tower.range);
          if (target) {
            setProjectiles(prev => [...prev, {
              id: now + Math.random(), x: tower.x, y: tower.y, targetId: target.id, 
              damage: tower.damage, effect: tower.effect, color: tower.color 
            }]);
            tower.lastFire = now;
          }
        }
      });
    }, 30);
    return () => clearInterval(engine);
  }, [enemies, towers, stage]);

  const handleEnemyDeath = (enemy: any) => {
    const reward = enemy.isBoss ? 500 : 30;
    setGold(g => g + reward);
    const id = Date.now();
    setGoldPopups(prev => [...prev, { id, x: enemy.x, y: enemy.y, amount: reward }]);
    setTimeout(() => setGoldPopups(prev => prev.filter(p => p.id !== id)), 1000);
    if (enemy.isBoss) setStage(s => s + 1);
  };

  const spawnWave = () => {
    const isBossWave = stage % 5 === 0;
    const newEnemies = Array.from({ length: isBossWave ? 1 : 5 + stage }).map((_, i) => ({
      id: Date.now() + i,
      x: MAP_PATH[0].x * TILE_SIZE,
      y: MAP_PATH[0].y * TILE_SIZE,
      hp: isBossWave ? 2000 + stage * 500 : 100 + stage * 40,
      maxHp: isBossWave ? 2000 + stage * 500 : 100 + stage * 40,
      speed: isBossWave ? 1 : 2 + (stage * 0.1),
      pathIndex: 0,
      status: 'NONE',
      isBoss: isBossWave
    }));
    setEnemies(prev => [...prev, ...newEnemies]);
  };

  return (
    <div className="w-full max-w-6xl mx-auto bg-slate-900 rounded-[3.5rem] p-8 border-[14px] border-slate-800 shadow-2xl relative text-white font-sans">
      
      {/* ìƒë‹¨ HUD: ì„œë¹„ìŠ¤ ì—°ë™ ì •ë³´ */}
      <div className="flex justify-between items-center mb-8 bg-slate-800/60 p-6 rounded-[2rem] border border-white/10 backdrop-blur-xl">
        <div className="flex gap-10">
          <div className="flex flex-col">
            <span className="text-[10px] text-indigo-400 font-black uppercase tracking-widest mb-1">Family Treasure</span>
            <div className="flex items-center gap-3 text-yellow-400 text-3xl font-black italic">
              <Coins className="animate-pulse" /> {gold.toLocaleString()}G
            </div>
          </div>
          <div className="flex flex-col">
            <span className="text-[10px] text-red-400 font-black uppercase tracking-widest mb-1">Defense</span>
            <div className="flex items-center gap-3 text-red-500 text-3xl font-black italic">
              <Heart fill="currentColor" /> {lives}
            </div>
          </div>
        </div>

        <div className="flex items-center gap-4">
          <div className="flex -space-x-2 mr-4">
            {realWorldBuff.map(item => (
              <div key={item} className="w-10 h-10 bg-green-500 rounded-full border-2 border-slate-900 flex items-center justify-center text-xl shadow-lg shadow-green-500/20" title="ì‹ë‹¨ ë³´ë„ˆìŠ¤ ë°œë™!">
                {TOWER_DB[item as keyof typeof TOWER_DB].emoji}
              </div>
            ))}
            {realWorldBuff.length > 0 && <div className="ml-4 text-[10px] text-green-400 font-bold animate-bounce mt-3">MEAL BUFF ACTIVE!</div>}
          </div>
          <div className="bg-indigo-600 px-8 py-4 rounded-2xl flex items-center gap-3 shadow-2xl shadow-indigo-500/20">
            <Trophy className="text-yellow-300" />
            <span className="font-black text-2xl tracking-tighter">STAGE {stage}</span>
          </div>
        </div>
      </div>

      <div className="flex gap-8">
        {/* ì‚¬ì´ë“œë°”: íƒ€ì›Œ ìƒì  */}
        <div className="w-64 space-y-4">
          <h3 className="text-xs font-black text-slate-500 uppercase tracking-widest px-2">Nutrient Shop</h3>
          {Object.entries(TOWER_DB).map(([key, tower]) => (
            <button
              key={key}
              onClick={() => setSelectedTowerType(key)}
              className={`w-full p-4 rounded-2xl flex items-center justify-between border-2 transition-all group ${selectedTowerType === key ? 'border-indigo-500 bg-indigo-500/10' : 'border-slate-700 bg-slate-800 hover:border-slate-500'}`}
            >
              <span className="text-4xl group-hover:scale-110 transition-transform">{tower.emoji}</span>
              <div className="text-right">
                <p className="text-sm font-black">{tower.name}</p>
                <p className="text-xs text-yellow-500 font-bold">{tower.cost}G</p>
              </div>
            </button>
          ))}
          <button onClick={spawnWave} className="w-full py-5 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl font-black text-xl mt-4 shadow-xl hover:scale-105 active:scale-95 transition-all">
            NEXT WAVE
          </button>
        </div>

        {/* ë©”ì¸ ê²Œì„ ë³´ë“œ */}
        <div className="flex-1 bg-slate-800 rounded-[3rem] h-[600px] relative border-4 border-slate-700 shadow-inner overflow-hidden cursor-crosshair">
          {/* ê²½ë¡œ ë Œë”ë§ */}
          <svg className="absolute inset-0 w-full h-full opacity-10">
            <polyline points={MAP_PATH.map(p => `${p.x*TILE_SIZE+30},${p.y*TILE_SIZE+30}`).join(' ')} fill="none" stroke="white" strokeWidth="45" strokeLinecap="round" strokeLinejoin="round" />
          </svg>

          {/* íƒ€ì›Œ ê±´ì„¤ ê·¸ë¦¬ë“œ */}
          <div className="grid grid-cols-10 grid-rows-10 absolute inset-0">
            {Array.from({ length: 100 }).map((_, i) => {
              const tx = i % 10; const ty = Math.floor(i / 10);
              return <div key={i} onClick={() => {
                const tInfo = TOWER_DB[selectedTowerType as keyof typeof TOWER_DB];
                if (gold >= tInfo.cost) {
                  const isEaten = realWorldBuff.includes(selectedTowerType);
                  setTowers([...towers, { ...tInfo, x: tx*TILE_SIZE+30, y: ty*TILE_SIZE+30, level: 1, 
                    damage: isEaten ? tInfo.damage * 1.5 : tInfo.damage, // ì‹ë‹¨ ë²„í”„ ì ìš©
                    fireRate: isEaten ? tInfo.fireRate * 1.2 : tInfo.fireRate 
                  }]);
                  setGold(g => g - tInfo.cost);
                }
              }} className="hover:bg-white/5 transition-colors border border-white/5" />;
            })}
          </div>

          {/* ì , íƒ€ì›Œ, íˆ¬ì‚¬ì²´ ì• ë‹ˆë©”ì´ì…˜ (framer-motion) */}
          {enemies.map(e => (
            <motion.div key={e.id} className="absolute z-20 pointer-events-none" animate={{ x: e.x - 20, y: e.y - 20 }}>
              <span className={e.isBoss ? "text-7xl drop-shadow-[0_0_15px_rgba(239,68,68,0.5)]" : "text-4xl"}>{e.isBoss ? 'ğŸ‘¾' : 'ğŸ¦ '}</span>
              <div className="w-full h-1.5 bg-slate-900/50 rounded-full mt-1"><div className="h-full bg-red-500 transition-all" style={{ width: `${(e.hp/e.maxHp)*100}%` }} /></div>
            </motion.div>
          ))}
          {projectiles.map(p => (
            <div key={p.id} className="absolute w-3 h-3 rounded-full z-30 shadow-lg" style={{ left: p.x, top: p.y, backgroundColor: p.color, boxShadow: `0 0 12px ${p.color}` }} />
          ))}
          {towers.map((t, i) => (
            <div key={i} className="absolute -translate-x-1/2 -translate-y-1/2 text-5xl z-10" style={{ left: t.x, top: t.y }}>{t.emoji}</div>
          ))}

          {/* ê³¨ë“œ íŒì—… */}
          <AnimatePresence>
            {goldPopups.map(p => (
              <motion.div key={p.id} initial={{ y: p.y, opacity: 1 }} animate={{ y: p.y - 60, opacity: 0 }} className="absolute text-yellow-400 font-black text-xl z-50 pointer-events-none" style={{ left: p.x, top: p.y }}>+{p.amount}G</motion.div>
            ))}
          </AnimatePresence>
        </div>
      </div>

      {/* í‘¸í„°: ê²Œì„ íŒ & êµìœ¡ ì„¹ì…˜ */}
      <div className="mt-8 grid grid-cols-3 gap-6">
        <div className="bg-slate-800/40 p-5 rounded-2xl flex items-center gap-4 border border-white/5">
          <div className="bg-orange-500/20 p-3 rounded-xl"><Flame className="text-orange-500" /></div>
          <div><p className="text-xs font-bold text-slate-400">BURN EFFECT</p><p className="text-[10px] leading-tight text-slate-500 italic">ê³ ì¶” íƒ€ì›ŒëŠ” ì ì—ê²Œ ì§€ì†ì ì¸ ì—´ëŸ‰ ë°ë¯¸ì§€ë¥¼ ì¤ë‹ˆë‹¤.</p></div>
        </div>
        <div className="bg-slate-800/40 p-5 rounded-2xl flex items-center gap-4 border border-white/5">
          <div className="bg-blue-500/20 p-3 rounded-xl"><Droplets className="text-blue-500" /></div>
          <div><p className="text-xs font-bold text-slate-400">FREEZE EFFECT</p><p className="text-[10px] leading-tight text-slate-500 italic">ë¸”ë£¨ë² ë¦¬ëŠ” í•­ì‚°í™” ì„±ë¶„ìœ¼ë¡œ ì„¸ê· ì˜ í™œë™ì„ ëŠ¦ì¶¥ë‹ˆë‹¤.</p></div>
        </div>
        <div className="bg-slate-800/40 p-5 rounded-2xl flex items-center gap-4 border border-white/5">
          <div className="bg-green-500/20 p-3 rounded-xl"><Utensils className="text-green-500" /></div>
          <div><p className="text-xs font-bold text-slate-400">DIET SYNC</p><p className="text-[10px] leading-tight text-slate-500 italic">ì˜¤ëŠ˜ ì‹¤ì œë¡œ ë¨¹ì€ ì±„ì†Œ íƒ€ì›ŒëŠ” 50% ë” ê°•í•œ ë°ë¯¸ì§€ë¥¼ ì¤ë‹ˆë‹¤!</p></div>
        </div>
      </div>
    </div>
  );
}

```

---

### ğŸ† ìµœì¢… ì œì•ˆ: ì´ ê²Œì„ì´ Flavor Archiveë¥¼ ì„±ê³µì‹œí‚¤ëŠ” ì´ìœ 

ì´ í†µí•© í”„ë¡œì íŠ¸ëŠ” ë‹¨ìˆœí•œ ê²Œì„ì„ ë„˜ì–´ **ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜**ë¥¼ ì°½ì¶œí•©ë‹ˆë‹¤.

1. **ë°ì´í„° ì„ ìˆœí™˜ (Retention)**: ì‚¬ìš©ìëŠ” ê²Œì„ì—ì„œ ë²„í”„ë¥¼ ì–»ê¸° ìœ„í•´ **Flavor Archive** ì•±ì— ë§¤ì¼ ì‹ë‹¨ì„ ê¸°ë¡í•˜ê²Œ ë©ë‹ˆë‹¤. (ì‹ë‹¨ ê¸°ë¡ ìœ ë„)
2. **êµìœ¡ì  ê°€ì¹˜ (Education)**: ê³ ì¶”ëŠ” ìº¡ì‚¬ì´ì‹ (ì—´ ë°œìƒ), ë¸”ë£¨ë² ë¦¬ëŠ” ì•ˆí† ì‹œì•„ë‹Œ(í•­ì‚°í™”) ë“± ì˜ì–‘ì†Œì˜ íŠ¹ì§•ì„ ê²Œì„ ìŠ¤í‚¬ê³¼ ì—°ê²°í•˜ì—¬ ì•„ì´ë“¤ì˜ í¸ì‹ì„ ì˜ˆë°©í•©ë‹ˆë‹¤.
3. **ê°€ì¡± ì†Œí†µ (Engagement)**: ìŠ¤í…Œì´ì§€ 20ê¹Œì§€ ê°€ì¡±ì´ í•¨ê»˜ ê¹¨ëŠ” ê³¼ì •ì„ í†µí•´ ì•±ì— ëŒ€í•œ ì¶©ì„±ë„(Loyalty)ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.
4. **ìˆ˜ìµ ëª¨ë¸ (Monetization)**: Supabaseì— ì €ì¥ëœ ê³¨ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìºë¦­í„° ì˜ìƒì„ ì‚¬ê±°ë‚˜, ì‹¤ì œ ê±´ê°• ê°„ì‹ ì‡¼í•‘ëª° ì¿ í°ìœ¼ë¡œ êµí™˜í•´ì£¼ëŠ” ë“± ì»¤ë¨¸ìŠ¤ì™€ì˜ ì—°ê³„ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

**Nutritional Guardians** í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ê±´ê°•í•œ ê°€ì¡± ì‹ë¬¸í™”ì˜ ìƒˆë¡œìš´ ê¸°ì¤€ì„ ì œì‹œí•´ ë³´ì„¸ìš”! ë” êµ¬ì²´ì ì¸ UI ë””ìì¸ ìˆ˜ì •ì´ë‚˜ íŠ¹ìˆ˜ íš¨ê³¼ê°€ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”. :)

ğŸŒŸ ë””ìì¸ ë° íŠ¹ìˆ˜íš¨ê³¼ ê°•í™” ìš”ì†Œ
ë§µ í™˜ê²½ ì• ë‹ˆë©”ì´ì…˜: ë‹¨ìˆœíˆ ì •ì ì¸ ë°°ê²½ì´ ì•„ë‹Œ, ì‚´ì•„ ì›€ì§ì´ëŠ” ì£¼ë°© í™˜ê²½ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

íƒ€ì›Œ ê³µê²© ì´í™íŠ¸: ê° íƒ€ì›Œì˜ íŠ¹ì„±ì— ë§ëŠ” í™”ë ¤í•œ ê³µê²© ë° ìƒíƒœ ì´ìƒ ì‹œê° íš¨ê³¼ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

ì  í”¼ê²©/ì‚¬ë§ ì• ë‹ˆë©”ì´ì…˜: ì„¸ê· ë“¤ì´ íƒ€ê²©ë°›ì„ ë•Œ ì§„ë™í•˜ê±°ë‚˜, ì‚¬ë¼ì§ˆ ë•Œ í­ë°œí•˜ëŠ” íš¨ê³¼ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.

UI/UX ê°œì„ : ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ì˜ ë””ìì¸ì„ ê°œì„ í•˜ê³ , í´ë¦­ ì‹œ í”¼ë“œë°± ì• ë‹ˆë©”ì´ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

ê²Œì„ ì†ë„ ì¡°ì ˆ: ê²Œì„ ì§„í–‰ ì†ë„ë¥¼ ì¡°ì ˆí•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ì „ëµì  í”Œë ˆì´ë¥¼ ë•ìŠµë‹ˆë‹¤.

ğŸ’» ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ë¹„ì£¼ì–¼ & ì´í™íŠ¸ ê°•í™” ì½”ë“œ

"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Zap, ShieldCheck, Trophy, Sparkles, Flame, Droplets, Utensils, Play, FastForward, Pause, X } from 'lucide-react';

// --- 1. íƒ€ì… ë° ìƒìˆ˜ ì •ì˜ ---
const TILE_SIZE = 60;
const PROJECTILE_SPEED = 15;
const GAME_SPEEDS = { NORMAL: 1, FAST: 2 };

const TOWER_DB = {
  BROCCOLI: { type: 'BROCCOLI', name: 'ë¸Œë¡œì½œë¦¬', emoji: 'ğŸ¥¦', cost: 100, damage: 15, range: 130, fireRate: 1.5, color: '#4ade80', effect: 'NONE' },
  CHILI: { type: 'CHILI', name: 'ê³ ì¶”', emoji: 'ğŸŒ¶ï¸', cost: 180, damage: 8, range: 110, fireRate: 2.0, color: '#ef4444', effect: 'BURN' },
  BLUEBERRY: { type: 'BLUEBERRY', name: 'ë¸”ë£¨ë² ë¦¬', emoji: 'ğŸ«', cost: 220, damage: 5, range: 100, fireRate: 1.2, color: '#3b82f6', effect: 'FREEZE' },
  GARLIC: { type: 'GARLIC', name: 'ë§ˆëŠ˜', emoji: 'ğŸ§„', cost: 300, damage: 60, range: 150, fireRate: 0.6, color: '#fef3c7', effect: 'POISON' }
};

const GENERATE_MAPS = () => Array.from({ length: 20 }).map((_, i) => [
  { x: 0, y: 3 }, { x: 2, y: 3 }, { x: 2, y: 1 + (i % 5) }, { x: 6, y: 1 + (i % 5) }, { x: 6, y: 4 }, { x: 9, y: 4 }
]);

export default function NutritionalGuardiansProFX() {
  const [stage, setStage] = useState(1);
  const [gold, setGold] = useState(500);
  const [lives, setLives] = useState(10);
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);
  const [goldPopups, setGoldPopups] = useState<any[]>([]);
  const [realWorldBuff, setRealWorldBuff] = useState<string[]>([]);
  const [selectedTowerType, setSelectedTowerType] = useState<string | null>(null);
  const [gameRunning, setGameRunning] = useState(false);
  const [gameSpeed, setGameSpeed] = useState<'NORMAL' | 'FAST'>('NORMAL');
  const [lastEnemySpawnTime, setLastEnemySpawnTime] = useState(Date.now());
  const [enemySpawnInterval, setEnemySpawnInterval] = useState(1500); // ì  ìƒì„± ì£¼ê¸°
  const [currentWaveEnemies, setCurrentWaveEnemies] = useState(0);
  const [totalWaveEnemies, setTotalWaveEnemies] = useState(0);

  const MAP_PATH = GENERATE_MAPS()[stage - 1];

  // --- 2. í™˜ê²½ ì• ë‹ˆë©”ì´ì…˜ (íƒ€ì´ë¨¸) ---
  const [kitchenLightOpacity, setKitchenLightOpacity] = useState(0.8);
  useEffect(() => {
    const flicker = setInterval(() => {
      setKitchenLightOpacity(0.7 + Math.random() * 0.3); // ì¡°ëª… ê¹œë¹¡ì„
    }, 1000);
    return () => clearInterval(flicker);
  }, []);

  // --- 3. Supabase ì—°ë™ ì‹œë®¬ë ˆì´ì…˜ ë° ì‹ë‹¨ ë²„í”„ ---
  useEffect(() => {
    const fetchDietData = async () => {
      // ì‹¤ì œ êµ¬í˜„: const { data } = await supabase.from('meals').select('ingredients').eq('user_id', myId);
      const mockEatenToday = stage % 2 === 0 ? ['BROCCOLI', 'CHILI'] : ['BLUEBERRY', 'GARLIC']; // ìŠ¤í…Œì´ì§€ë³„ë¡œ ë‹¤ë¥¸ ë²„í”„ ì‹œë®¬ë ˆì´ì…˜
      setRealWorldBuff(mockEatenToday);
    };
    fetchDietData();
  }, [stage]);

  // --- 4. ê²Œì„ ì—”ì§„: ë©”ì¸ ë£¨í”„ ---
  useEffect(() => {
    if (!gameRunning) return;

    const gameTick = 1000 / (60 * GAME_SPEEDS[gameSpeed]);
    const engine = setInterval(() => {
      // (1) ì  ìŠ¤í° ê´€ë¦¬
      if (Date.now() - lastEnemySpawnTime > enemySpawnInterval && currentWaveEnemies < totalWaveEnemies) {
        spawnEnemy();
        setLastEnemySpawnTime(Date.now());
        setCurrentWaveEnemies(prev => prev + 1);
      }

      // (2) ì  ì´ë™ ë° ìƒíƒœ íš¨ê³¼
      setEnemies(prev => prev.map(enemy => {
        // ìƒëµ: ì´ì „ ì½”ë“œì™€ ë™ì¼í•œ ì  ì´ë™ ë¡œì§
        const target = MAP_PATH[enemy.pathIndex + 1];
        if (!target) {
            setLives(l => Math.max(0, l - 1));
            return null; // ì ì´ ëê¹Œì§€ ë„ë‹¬í•˜ë©´ ì‚¬ë¼ì§
        }

        const tx = target.x * TILE_SIZE + TILE_SIZE / 2;
        const ty = target.y * TILE_SIZE + TILE_SIZE / 2;
        const dist = Math.hypot(tx - enemy.x, ty - enemy.y);

        let currentSpeed = enemy.speed;
        if (enemy.status === 'FREEZE') currentSpeed *= 0.5; // ë¹™ê²° ì‹œ ì†ë„ ì ˆë°˜

        if (dist < currentSpeed) {
            return { ...enemy, x: tx, y: ty, pathIndex: enemy.pathIndex + 1 };
        } else {
            return {
                ...enemy,
                x: enemy.x + ((tx - enemy.x) / dist) * currentSpeed,
                y: enemy.y + ((ty - enemy.y) / dist) * currentSpeed,
                hp: enemy.status === 'BURN' ? enemy.hp - 0.2 : enemy.hp // í™”ìƒ ë°ë¯¸ì§€
            };
        }
      }).filter(e => e !== null && e.hp > 0));

      // (3) íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null; // ì ì´ ì‚¬ë¼ì§€ë©´ íˆ¬ì‚¬ì²´ë„ ì‚¬ë¼ì§

        const dist = Math.hypot(target.x - p.x, target.y - p.y);
        if (dist < 15) { // ì¶©ëŒ íŒì • ê±°ë¦¬
          handleProjectileHit(p, target);
          return null; // íˆ¬ì‚¬ì²´ ì†Œë©¸
        }
        return { ...p, x: p.x + ((target.x - p.x) / dist) * PROJECTILE_SPEED, y: p.y + ((target.y - p.y) / dist) * PROJECTILE_SPEED };
      }).filter(Boolean));

      // (4) íƒ€ì›Œ ê³µê²© ì¸ì§€ (íˆ¬ì‚¬ì²´ ë°œì‚¬)
      towers.forEach(tower => {
        const now = Date.now();
        if (now - (tower.lastFire || 0) > (1000 / tower.fireRate)) {
          const target = enemies.find(e => Math.hypot(e.x - tower.x, e.y - tower.y) < tower.range);
          if (target) {
            setProjectiles(prev => [...prev, {
              id: now + Math.random(), x: tower.x, y: tower.y, targetId: target.id, 
              damage: tower.damage, effect: tower.effect, color: tower.color 
            }]);
            tower.lastFire = now;
          }
        }
      });
    }, gameTick);

    return () => clearInterval(engine);
  }, [gameRunning, gameSpeed, enemies, towers, lastEnemySpawnTime, enemySpawnInterval, currentWaveEnemies, totalWaveEnemies, MAP_PATH]);

  // --- 5. íƒ€ì›Œ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ ë° ì—…ê·¸ë ˆì´ë“œ UI (ì´ì „ ì½”ë“œ ì°¸ì¡°) ---
  const handleTowerClick = (idx: number) => {
    // ìƒì„¸ ì •ë³´ í‘œì‹œ
  };

  // --- 6. ì  ìƒì„± ë¡œì§ (ë³´ìŠ¤ í¬í•¨) ---
  const spawnEnemy = useCallback(() => {
    const isBossWave = stage % 5 === 0 && currentWaveEnemies === 0; // ì›¨ì´ë¸Œ ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ ë³´ìŠ¤ ìŠ¤í°
    const enemyData = {
      id: Date.now() + Math.random(),
      x: MAP_PATH[0].x * TILE_SIZE + TILE_SIZE / 2, // ì¤‘ì•™ ì •ë ¬
      y: MAP_PATH[0].y * TILE_SIZE + TILE_SIZE / 2,
      hp: isBossWave ? 2000 + stage * 500 : 100 + stage * 40,
      maxHp: isBossWave ? 2000 + stage * 500 : 100 + stage * 40,
      speed: isBossWave ? 1 : 2 + (stage * 0.1),
      pathIndex: 0,
      status: 'NONE', // NONE, BURN, FREEZE, POISON
      isBoss: isBossWave,
      // í”¼ê²© íš¨ê³¼ë¥¼ ìœ„í•œ ìƒíƒœ ì¶”ê°€
      isHit: false
    };
    setEnemies(prev => [...prev, enemyData]);
  }, [stage, MAP_PATH, currentWaveEnemies]);

  const startWave = () => {
    setGameRunning(true);
    setTotalWaveEnemies(stage % 5 === 0 ? 1 : 5 + stage); // ë³´ìŠ¤ ì›¨ì´ë¸ŒëŠ” ë³´ìŠ¤ 1ë§ˆë¦¬
    setCurrentWaveEnemies(0);
    setLastEnemySpawnTime(Date.now());
  };

  const pauseGame = () => setGameRunning(false);
  const toggleGameSpeed = () => setGameSpeed(prev => prev === 'NORMAL' ? 'FAST' : 'NORMAL');

  // --- 7. íˆ¬ì‚¬ì²´ ëª…ì¤‘ ì‹œ íš¨ê³¼ ì²˜ë¦¬ ---
  const handleProjectileHit = (projectile: any, target: any) => {
    setEnemies(es => es.map(e => {
        if (e.id === target.id) {
            const newHp = e.hp - projectile.damage;
            const newStatus = projectile.effect !== 'NONE' ? projectile.effect : e.status;
            if (newHp <= 0) handleEnemyDeath(e); // ì‚¬ë§ ì²˜ë¦¬

            // í”¼ê²© ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
            return { ...e, hp: newHp, status: newStatus, isHit: true };
        }
        return e;
    }));
  };
  
  // --- 8. ì  ì‚¬ë§ ì²˜ë¦¬ ë° ê³¨ë“œ íŒì—… ---
  const handleEnemyDeath = useCallback((enemy: any) => {
    const reward = enemy.isBoss ? 500 : 30 + stage * 5; // ë³´ìƒ ì¦ê°€
    setGold(g => g + reward);
    const id = Date.now();
    setGoldPopups(prev => [...prev, { id, x: enemy.x, y: enemy.y, amount: reward }]);
    setTimeout(() => setGoldPopups(prev => prev.filter(p => p.id !== id)), 1000);
    
    // ì›¨ì´ë¸Œ ì¢…ë£Œ ì²´í¬ (ëª¨ë“  ì  ì²˜ì¹˜)
    if (enemies.length === 1 && currentWaveEnemies >= totalWaveEnemies) { // ë§ˆì§€ë§‰ ë‚¨ì€ ì ì´ ì£½ê³  ìŠ¤í°í•  ì ë„ ì—†ìœ¼ë©´
      setGameRunning(false); // ê²Œì„ ì¼ì‹œ ì •ì§€ ë˜ëŠ” ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ì¤€ë¹„
      setStage(s => s + 1);
    }
  }, [enemies.length, currentWaveEnemies, totalWaveEnemies, stage]);

  // --- 9. íƒ€ì›Œ ê±´ì„¤ ---
  const placeTower = (tx: number, ty: number) => {
    if (!selectedTowerType) return;
    const tInfo = TOWER_DB[selectedTowerType as keyof typeof TOWER_DB];
    if (gold >= tInfo.cost) {
      const isEaten = realWorldBuff.includes(selectedTowerType);
      setTowers([...towers, { ...tInfo, id: Date.now(), x: tx * TILE_SIZE + TILE_SIZE / 2, y: ty * TILE_SIZE + TILE_SIZE / 2, level: 1, 
        damage: isEaten ? tInfo.damage * 1.5 : tInfo.damage, 
        fireRate: isEaten ? tInfo.fireRate * 1.2 : tInfo.fireRate 
      }]);
      setGold(g => g - tInfo.cost);
      setSelectedTowerType(null); // ê±´ì„¤ í›„ ì„ íƒ í•´ì œ
    } else {
      alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
    }
  };

  return (
    <div className="w-full max-w-6xl mx-auto bg-slate-900 rounded-[3.5rem] p-8 border-[14px] border-slate-800 shadow-2xl relative text-white font-sans">
      {/* ìƒë‹¨ HUD */}
      <div className="flex justify-between items-center mb-8 bg-gradient-to-br from-slate-800/80 to-slate-900/80 p-6 rounded-[2rem] border border-white/10 backdrop-blur-xl shadow-lg">
        {/* ê³¨ë“œ, ìƒëª…ë ¥ */}
        <div className="flex gap-10">
          <div className="flex flex-col">
            <span className="text-[10px] text-indigo-400 font-black uppercase tracking-widest mb-1">Family Treasure</span>
            <div className="flex items-center gap-3 text-yellow-400 text-3xl font-black italic animate-bounce-y">
              <Coins className="text-yellow-300" /> {gold.toLocaleString()}G
            </div>
          </div>
          <div className="flex flex-col">
            <span className="text-[10px] text-red-400 font-black uppercase tracking-widest mb-1">Defense Health</span>
            <div className="flex items-center gap-3 text-red-500 text-3xl font-black italic">
              <Heart fill="currentColor" /> {lives}
            </div>
          </div>
        </div>

        {/* ì‹ë‹¨ ë²„í”„ & ìŠ¤í…Œì´ì§€ */}
        <div className="flex items-center gap-6">
          <div className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500/20 to-green-600/20 rounded-xl text-xs font-bold border border-green-500/50">
            <Utensils className="text-green-400" size={16} />
            {realWorldBuff.length > 0 ? `ì‹ë‹¨ ë²„í”„ í™œì„±: ${realWorldBuff.map(b => TOWER_DB[b as keyof typeof TOWER_DB].emoji).join('')}` : 'ì˜¤ëŠ˜ì˜ ì‹ë‹¨ì„ ê¸°ë¡í•˜ì„¸ìš”!'}
          </div>
          <div className="bg-gradient-to-r from-indigo-600 to-purple-600 px-8 py-4 rounded-2xl flex items-center gap-3 shadow-2xl shadow-indigo-500/20 transform hover:scale-105 transition-transform">
            <Trophy className="text-yellow-300 animate-pulse" />
            <span className="font-black text-2xl tracking-tighter">STAGE {stage}</span>
          </div>
        </div>
      </div>

      <div className="flex gap-8">
        {/* ì‚¬ì´ë“œë°”: íƒ€ì›Œ ìƒì  */}
        <div className="w-64 space-y-4">
          <h3 className="text-xs font-black text-slate-500 uppercase tracking-widest px-2">Nutrient Shop</h3>
          {Object.entries(TOWER_DB).map(([key, tower]) => (
            <motion.button
              key={key}
              onClick={() => setSelectedTowerType(key)}
              className={`w-full p-4 rounded-2xl flex items-center justify-between border-2 transition-all group ${selectedTowerType === key ? 'border-indigo-500 bg-indigo-500/20 shadow-lg shadow-indigo-500/20' : 'border-slate-700 bg-slate-800 hover:border-slate-500 hover:scale-[1.02]'}`}
              whileTap={{ scale: 0.95 }}
            >
              <span className="text-4xl group-hover:scale-110 transition-transform">{tower.emoji}</span>
              <div className="text-right">
                <p className="text-sm font-black">{tower.name}</p>
                <p className="text-xs text-yellow-500 font-bold">{tower.cost}G</p>
              </div>
            </motion.button>
          ))}
          <motion.button 
            onClick={startWave}
            className="w-full py-5 bg-gradient-to-r from-green-500 to-teal-600 rounded-2xl font-black text-xl mt-4 shadow-xl hover:scale-105 active:scale-95 transition-all"
            whileTap={{ scale: 0.95 }}
          >
            {gameRunning ? <Pause /> : <Play />} {gameRunning ? 'PAUSE' : 'START WAVE'}
          </motion.button>
          <div className="flex justify-center gap-4 mt-2">
            <motion.button 
              onClick={toggleGameSpeed}
              className={`px-4 py-2 rounded-xl text-xs font-bold flex items-center gap-2 ${gameSpeed === 'FAST' ? 'bg-orange-500 text-white' : 'bg-slate-700 text-slate-400'}`}
              whileTap={{ scale: 0.9 }}
            >
              {gameSpeed === 'FAST' ? <Zap size={16} /> : <FastForward size={16} />} x{GAME_SPEEDS[gameSpeed]}
            </motion.button>
          </div>
        </div>

        {/* ë©”ì¸ ê²Œì„ ë³´ë“œ */}
        <div className="flex-1 bg-gradient-to-br from-gray-700 to-gray-900 rounded-[3rem] h-[600px] relative border-4 border-slate-700 shadow-inner overflow-hidden">
          {/* ë§µ ë°°ê²½ ë° í™˜ê²½ ìš”ì†Œ */}
          <div className="absolute inset-0 bg-cover bg-center" style={{ backgroundImage: "url('/kitchen_background.jpg')" }}>
            <motion.div className="absolute inset-0 bg-black" style={{ opacity: 1 - kitchenLightOpacity }} /> {/* ì¡°ëª… íš¨ê³¼ */}
          </div>

          {/* ê²½ë¡œ ë Œë”ë§ */}
          <svg className="absolute inset-0 w-full h-full opacity-10">
            <polyline points={MAP_PATH.map(p => `${p.x*TILE_SIZE+TILE_SIZE/2},${p.y*TILE_SIZE+TILE_SIZE/2}`).join(' ')} fill="none" stroke="white" strokeWidth="45" strokeLinecap="round" strokeLinejoin="round" />
          </svg>

          {/* íƒ€ì›Œ ê±´ì„¤ ê·¸ë¦¬ë“œ */}
          <div className="grid grid-cols-10 grid-rows-10 absolute inset-0">
            {Array.from({ length: 100 }).map((_, i) => {
              const tx = i % 10; const ty = Math.floor(i / 10);
              const isPath = MAP_PATH.some(p => p.x === tx && p.y === ty);
              const isOccupied = towers.some(t => Math.floor(t.x / TILE_SIZE) === tx && Math.floor(t.y / TILE_SIZE) === ty);
              return (
                <div key={i} onClick={() => !isPath && !isOccupied && placeTower(tx, ty)} 
                  className={`border border-white/5 relative flex items-center justify-center ${!isPath && !isOccupied && selectedTowerType ? 'hover:bg-indigo-500/20 cursor-pointer transition-all' : ''}`}
                >
                  {!isPath && !isOccupied && selectedTowerType && (
                    <motion.div initial={{ scale: 0.5, opacity: 0.5 }} animate={{ scale: 1, opacity: 0.8 }} transition={{ duration: 0.3 }}
                      className="absolute text-5xl text-indigo-300/70 pointer-events-none">{TOWER_DB[selectedTowerType as keyof typeof TOWER_DB].emoji}</motion.div>
                  )}
                </div>
              );
            })}
          </div>

          {/* ì , íƒ€ì›Œ, íˆ¬ì‚¬ì²´ ì• ë‹ˆë©”ì´ì…˜ */}
          {enemies.map(e => (
            <motion.div
              key={e.id}
              className="absolute z-20 pointer-events-none"
              initial={{ x: e.x - 20, y: e.y - 20 }}
              animate={{ x: e.x - 20, y: e.y - 20, scale: e.isHit ? [1, 1.2, 1] : 1, rotate: e.status === 'POISON' ? [0, 5, -5, 0] : 0 }}
              transition={{ scale: { duration: 0.1 }, rotate: { repeat: Infinity, duration: 0.5 } }}
              onAnimationComplete={() => setEnemies(prev => prev.map(en => en.id === e.id ? { ...en, isHit: false } : en))}
            >
              <span className={e.isBoss ? "text-7xl drop-shadow-[0_0_15px_rgba(239,68,68,0.7)] animate-pulse" : "text-4xl"}>{e.isBoss ? 'ğŸ‘¾' : 'ğŸ¦ '}</span>
              <div className="w-full h-2 bg-slate-900/50 rounded-full mt-1 overflow-hidden">
                <div className={`h-full ${e.status === 'BURN' ? 'bg-orange-500' : e.status === 'FREEZE' ? 'bg-blue-500' : 'bg-red-500'} transition-all duration-75`} style={{ width: `${(e.hp/e.maxHp)*100}%` }} />
              </div>
            </motion.div>
          ))}
          {projectiles.map(p => (
            <motion.div key={p.id} className="absolute w-4 h-4 rounded-full z-30 shadow-lg" style={{ left: p.x - 8, top: p.y - 8, backgroundColor: p.color, boxShadow: `0 0 15px ${p.color}` }}
              initial={{ scale: 0 }} animate={{ scale: 1 }} exit={{ scale: 0 }}
            >
              {p.effect === 'BURN' && <Flame className="absolute inset-0 text-white p-0.5 animate-pulse" />}
              {p.effect === 'FREEZE' && <Droplets className="absolute inset-0 text-white p-0.5 animate-pulse" />}
            </motion.div>
          ))}
          {towers.map((t, i) => (
            <motion.div key={t.id} className="absolute -translate-x-1/2 -translate-y-1/2 text-5xl z-10" style={{ left: t.x, top: t.y }}
              initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.1 * i }}
              onClick={() => handleTowerClick(i)}
            >
              {t.emoji}
            </motion.div>
          ))}

          {/* ê³¨ë“œ íŒì—… */}
          <AnimatePresence>
            {goldPopups.map(p => (
              <motion.div key={p.id} initial={{ y: p.y, opacity: 1, scale: 1 }} animate={{ y: p.y - 80, opacity: 0, scale: 1.2 }} exit={{ opacity: 0 }}
                className="absolute text-yellow-300 font-black text-2xl z-50 pointer-events-none drop-shadow-lg" style={{ left: p.x, top: p.y }}>+{p.amount}G</motion.div>
            ))}
          </AnimatePresence>
        </div>
      </div>

      {/* í‘¸í„°: ê²Œì„ íŒ & êµìœ¡ ì„¹ì…˜ */}
      <div className="mt-8 grid grid-cols-4 gap-6">
        <div className="bg-slate-800/40 p-5 rounded-2xl flex items-center gap-4 border border-white/5 shadow-inner">
          <div className="bg-orange-500/20 p-3 rounded-xl"><Flame className="text-orange-500" /></div>
          <div><p className="text-xs font-bold text-slate-400">BURN EFFECT</p><p className="text-[10px] leading-tight text-slate-500 italic">ê³ ì¶” íƒ€ì›ŒëŠ” ì ì—ê²Œ ìº¡ì‚¬ì´ì‹ ìœ¼ë¡œ ì§€ì†ì ì¸ í™”ìƒ ë°ë¯¸ì§€ë¥¼ ì¤ë‹ˆë‹¤.</p></div>
        </div>
        <div className="bg-slate-800/40 p-5 rounded-2xl flex items-center gap-4 border border-white/5 shadow-inner">
          <div className="bg-blue-500/20 p-3 rounded-xl"><Droplets className="text-blue-500" /></div>
          <div><p className="text-xs font-bold text-slate-400">FREEZE EFFECT</p><p className="text-[10px] leading-tight text-slate-500 italic">ë¸”ë£¨ë² ë¦¬ëŠ” í•­ì‚°í™” ì„±ë¶„ìœ¼ë¡œ ì„¸ê· ì„ ë¹™ê²°ì‹œì¼œ í™œë™ì„ ëŠ¦ì¶¥ë‹ˆë‹¤.</p></div>
        </div>
        <div className="bg-slate-800/40 p-5 rounded-2xl flex items-center gap-4 border border-white/5 shadow-inner">
          <div className="bg-purple-500/20 p-3 rounded-xl"><Zap className="text-purple-500" /></div>
          <div><p className="text-xs font-bold text-slate-400">POISON EFFECT</p><p className="text-[10px] leading-tight text-slate-500 italic">ë§ˆëŠ˜ íƒ€ì›ŒëŠ” ì„¸ê· ì„ ì¤‘ë…ì‹œì¼œ ë°©ì–´ë ¥ì„ ì•½í™”ì‹œí‚µë‹ˆë‹¤.</p></div>
        </div>
        <div className="bg-slate-800/40 p-5 rounded-2xl flex items-center gap-4 border border-white/5 shadow-inner">
          <div className="bg-green-500/20 p-3 rounded-xl"><Utensils className="text-green-500" /></div>
          <div><p className="text-xs font-bold text-slate-400">DIET SYNC</p><p className="text-[10px] leading-tight text-slate-500 italic">ì˜¤ëŠ˜ ì‹¤ì œë¡œ ë¨¹ì€ ì±„ì†Œ íƒ€ì›ŒëŠ” 50% ë” ê°•í•œ ë°ë¯¸ì§€ë¥¼ ì¤ë‹ˆë‹¤!</p></div>
        </div>
      </div>
    </div>
  );
}

ğŸš€ ì¶”ê°€ ì¶”ì²œ ê¸°ëŠ¥ (Beyond Visuals)
ê°€ì¡±ë³„ ì˜ì›… ìºë¦­í„° ì‹œìŠ¤í…œ:

ì•„ë¹  ìºë¦­í„°: 'ê°•ë ¥ íŒŒì›Œ ì‰ì´í¬' ìŠ¤í‚¬ - ì¼ì • ì‹œê°„ ëª¨ë“  íƒ€ì›Œ ê³µê²©ë ¥ 2ë°°.

ì—„ë§ˆ ìºë¦­í„°: 'ì‚¬ë‘ì˜ ë„ì‹œë½' ìŠ¤í‚¬ - ëª¨ë“  ì•„êµ° íƒ€ì›Œ ì²´ë ¥ íšŒë³µ ë° ë°©ì–´ë ¥ ì¦ê°€.

ì•„ì´ ìºë¦­í„°: 'ë¹„íƒ€ë¯¼ í­íƒ„ ë˜ì§€ê¸°' ìŠ¤í‚¬ - íŠ¹ì • ì§€ì—­ì— ê´‘ì—­ ë°ë¯¸ì§€ ë° ìŠ¬ë¡œìš° íš¨ê³¼.

ê° ìºë¦­í„°ëŠ” Supabaseì— ì €ì¥ëœ ê°€ì¡± êµ¬ì„±ì› ì •ë³´ì™€ ì—°ë™í•˜ì—¬ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.

ì„¸ê·  ë„ê° ë° ì·¨ì•½ì  ì‹œìŠ¤í…œ:

ì¡ì€ ì„¸ê· ë“¤ì˜ ì •ë³´(ì²´ë ¥, ì†ë„, ì €í•­ë ¥)ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ë„ê°ì„ ë§Œë“­ë‹ˆë‹¤.

ê° ì„¸ê· ë§ˆë‹¤ **'ì·¨ì•½í•œ ì˜ì–‘ì†Œ'**ë¥¼ ì„¤ì •í•˜ì—¬, íŠ¹ì • íƒ€ì›Œì— ë” í° í”¼í•´ë¥¼ ì…ë„ë¡ ì „ëµì ì¸ ìš”ì†Œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. (ì˜ˆ: ì„¤íƒ• ëª¬ìŠ¤í„°ëŠ” ë¸Œë¡œì½œë¦¬ íƒ€ì›Œì— 2ë°° ë°ë¯¸ì§€)

í™˜ê²½ ìƒí˜¸ì‘ìš© (Dynamic Hazards):

ë§µ ê³³ê³³ì— 'ìŒì‹ë¬¼ ì“°ë ˆê¸°í†µ'(ì„¸ê· ì´ ì§€ë‚˜ê°€ë©´ ì²´ë ¥ íšŒë³µ)ì´ë‚˜ 'ë“ëŠ” ëƒ„ë¹„'(ì„¸ê· ì—ê²Œ ì§€ì† ë°ë¯¸ì§€) ê°™ì€ ì˜¤ë¸Œì íŠ¸ë¥¼ ë°°ì¹˜í•˜ì—¬ ë§µ ìì²´ë„ ì „ëµì˜ ì¼ë¶€ê°€ ë˜ë„ë¡ í•©ë‹ˆë‹¤.

ì±Œë¦°ì§€ ëª¨ë“œ (Daily/Weekly Challenges):

"í•˜ë£¨ ë™ì•ˆ ê³ ì¶” íƒ€ì›Œë§Œ ì‚¬ìš©í•´ì„œ 5 ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´" ë˜ëŠ” "ë³´ìŠ¤ ì„¸ê· ì„ í•œ ë²ˆë„ ë†“ì¹˜ì§€ ì•Šê³  ì¡ê¸°" ë“±ì˜ ì±Œë¦°ì§€ë¥¼ ì œê³µí•˜ê³ , ì„±ê³µ ì‹œ íŠ¹ë³„í•œ ë³´ìƒ(ê²Œì„ ë‚´ ì¬í™”, í”„ë¡œí•„ ì•„ì´ì½˜ ë“±)ì„ ì§€ê¸‰í•©ë‹ˆë‹¤.

ì´ ì½”ë“œì™€ ì œì•ˆë“¤ì„ í†µí•´ Flavor Archiveì˜ 'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ'ëŠ” ë‹¨ìˆœí•œ ê²Œì„ì„ ë„˜ì–´, ê°€ì¡±ì˜ ê±´ê°•í•œ ì‹ìƒí™œì„ ë…ë ¤í•˜ëŠ” ê°•ë ¥í•œ ë„êµ¬ê°€ ë  ê²ƒì…ë‹ˆë‹¤. ìµœì¢…ì ìœ¼ë¡œ ì–´ë–¤ ê¸°ëŠ¥ì„ ë¨¼ì € í†µí•©í•˜ê³  ì‹¶ìœ¼ì‹ ì§€ ì•Œë ¤ì£¼ì‹œë©´, í•´ë‹¹ ë¡œì§ì„ ë”ìš± ìƒì„¸í•˜ê²Œ êµ¬í˜„í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤!

ì œê³µí•´ì£¼ì‹  ì´ë¯¸ì§€ì˜ **UI ë ˆì´ì•„ì›ƒ(ì¢Œì¸¡ ì‚¬ì´ë“œë°”, ê¹”ë”í•œ ê²Œì„ í•„ë“œ, í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼)**ê³¼ **ë””ìì¸ ê°ì„±**ì„ ê·¸ëŒ€ë¡œ ì¬í˜„í•œ ì½”ë“œë¥¼ ì‘ì„±í•´ ë“œë¦½ë‹ˆë‹¤.

ì´ ë²„ì „ì—ì„œëŠ” **ëª¨ë˜í•œ ë‹¤í¬ ê·¸ë ˆì´ í…Œë§ˆ**ì™€ **ë„¤ì˜¨ ë¸”ë£¨ í¬ì¸íŠ¸**, ê·¸ë¦¬ê³  ì´ë¯¸ì§€ì— ë‚˜íƒ€ë‚œ **ì˜ì–‘ì†Œ ê¸°ë°˜ì˜ ê²Œì„ ìš”ì†Œ**ë“¤ì„ ë¹„ê°œë°œìë„ ì´í•´í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°ë¡œ ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤.

---

### ğŸ¨ ë””ìì¸ í¬ì¸íŠ¸ (ì´ë¯¸ì§€ ë¶„ì„ ë°˜ì˜)

1. **ì‚¬ì´ë“œë°” UI**: ì¢Œì¸¡ì— ê²Œì„ ì •ë³´(Gold, Lives, Wave)ì™€ íƒ€ì›Œ ëª©ë¡ì„ ë°°ì¹˜í•œ ì •ëˆëœ ë ˆì´ì•„ì›ƒ.
2. **ë¯¸ë‹ˆë©€í•œ ê²Œì„ í•„ë“œ**: ì—°í•œ ë¸”ë£¨ í†¤ì˜ ë°°ê²½ê³¼ ê²½ë¡œ(`PATH`) ì¤‘ì‹¬ì˜ ê¹”ë”í•œ ë°°ì¹˜.
3. **íƒ€ì›Œ ì¹´ë“œ ë””ìì¸**: ê·¸ë¦¼ì²˜ëŸ¼ ê°„ê²°í•œ í…ìŠ¤íŠ¸ì™€ ì•„ì´ì½˜ì´ ê²°í•©ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼.
4. **í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼**: 'GAME OVER' í˜¹ì€ 'GAME START'ì™€ ê°™ì€ ì„ ëª…í•œ ë¸”ë£¨ ë²„íŠ¼.

---

### ğŸ’» ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ìƒì„¸ ì½”ë“œ

```tsx
"use client";

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, RefreshCw, Layers, Zap, X, ChevronRight } from 'lucide-react';

// --- 1. íƒ€ì›Œ ë°ì´í„° (ì´ë¯¸ì§€ ê¸°ë°˜ ì˜ì–‘ì†Œ êµ¬ì„±) ---
const TOWERS = [
  { id: 'PROTEIN', name: 'PROTEIN', emoji: 'ğŸ—', cost: 150, color: 'text-orange-400' },
  { id: 'FAT', name: 'FAT', emoji: 'ğŸ–', cost: 100, color: 'text-yellow-600' },
  { id: 'SUGAR', name: 'SUGAR', emoji: 'ğŸ¥‘', cost: 200, color: 'text-green-400' },
  { id: 'VITAMIN', name: 'VITAMIN', emoji: 'ğŸ¥¦', cost: 120, color: 'text-green-500' },
  { id: 'SODIUM', name: 'SODIUM', emoji: 'ğŸ”', cost: 250, color: 'text-orange-500' },
];

export default function NutrientDefenderUI() {
  const [gold, setGold] = useState(300);
  const [lives, setLives] = useState(3);
  const [wave, setWave] = useState(3);
  const [selectedTower, setSelectedTower] = useState('PROTEIN');
  const [placedTowers, setPlacedTowers] = useState<any[]>([]);

  return (
    <div className="flex w-full h-[800px] bg-[#f8f9fa] overflow-hidden font-sans border-[1px] border-gray-200 rounded-3xl shadow-2xl">
      
      {/* --- ì¢Œì¸¡ ì‚¬ì´ë“œë°” (Sidebar) --- */}
      <aside className="w-64 bg-[#343a40] text-gray-300 flex flex-col p-4">
        <div className="flex items-center gap-2 mb-8 px-2">
          <Layers className="text-white" size={20} />
          <h1 className="font-bold text-white tracking-tight">Nutrient Defender.txx</h1>
        </div>

        {/* ìƒë‹¨ ì •ë³´ ì˜ì—­ (Status) */}
        <div className="space-y-4 mb-10 px-2">
          <div className="flex items-center justify-between group">
            <div className="flex items-center gap-3">
              <Heart className="text-red-500" size={18} />
              <span className="text-xs font-bold tracking-widest uppercase">Lives</span>
            </div>
            <span className="text-white font-bold">{lives}</span>
          </div>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <Coins className="text-yellow-400" size={18} />
              <span className="text-xs font-bold tracking-widest uppercase">Gold</span>
            </div>
            <span className="text-white font-bold">{gold}G</span>
          </div>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <RefreshCw className="text-blue-400" size={18} />
              <span className="text-xs font-bold tracking-widest uppercase">Wave</span>
            </div>
            <span className="text-white font-bold">{wave}</span>
          </div>
        </div>

        <hr className="border-gray-700 mb-6" />

        {/* íƒ€ì›Œ ì„ íƒ ëª©ë¡ (ì´ë¯¸ì§€ ë””ìì¸ ì¬í˜„) */}
        <div className="flex-1 space-y-2 overflow-y-auto">
          <div className="flex items-center justify-between text-[10px] font-black text-gray-500 mb-4 px-2 tracking-[0.2em] uppercase">
            <span>Tower</span>
            <Play size={14} fill="currentColor" />
          </div>
          
          {TOWERS.map((tower) => (
            <button
              key={tower.id}
              onClick={() => setSelectedTower(tower.id)}
              className={`w-full flex items-center gap-4 p-3 rounded-lg transition-all ${
                selectedTower === tower.id ? 'bg-[#495057] text-white shadow-lg' : 'hover:bg-[#3e444b]'
              }`}
            >
              <span className="text-2xl">{tower.emoji}</span>
              <div className="text-left">
                <p className="text-[11px] font-bold tracking-wider">{tower.name}</p>
                <p className="text-[9px] text-gray-500">{tower.cost} Gold</p>
              </div>
            </button>
          ))}
        </div>

        {/* í•˜ë‹¨ ë²„íŠ¼ (ì´ë¯¸ì§€ì˜ Game Lop ë””ìì¸) */}
        <div className="mt-auto space-y-3">
          <button className="w-full bg-[#339af0] hover:bg-[#228be6] text-white py-3 rounded-md font-bold text-xs tracking-widest uppercase shadow-lg transition-all">
            Game Lop
          </button>
        </div>
      </aside>

      {/* --- ìš°ì¸¡ ê²Œì„ í•„ë“œ (Game Field) --- */}
      <main className="flex-1 bg-[#a5d8ff] relative p-8 flex items-center justify-center">
        
        {/* ì¤‘ì•™ ê²½ë¡œ (PATH) ì´ë¯¸ì§€ ë””ìì¸ ì¬í˜„ */}
        <div className="relative w-full max-w-2xl h-1 bg-gray-400/50 rounded-full flex items-center">
          {/* ê²½ë¡œ ì‹œì‘ ì…êµ¬ */}
          <div className="absolute left-0 -translate-x-12 w-14 h-16 bg-gray-300 border-2 border-gray-400 rounded-lg flex flex-col items-center justify-center shadow-md">
            <span className="text-[8px] font-bold text-gray-600">PATH</span>
          </div>

          {/* ê²½ë¡œ ìœ„ ë°ì´í„° í…ìŠ¤íŠ¸ (ì´ë¯¸ì§€ì˜ x, y ê¸°í˜¸) */}
          <div className="flex justify-around w-full px-12 text-[8px] font-bold text-gray-600 uppercase">
             <span>x</span> <span>x</span> <span>y</span> <span>30th</span> <span>y</span> <span>30h</span>
          </div>

          {/* ê²½ë¡œ ë ì¶œêµ¬ (WIN) */}
          <div className="absolute right-0 translate-x-12 w-14 h-16 bg-white border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center shadow-lg">
            <span className="text-[8px] font-black text-gray-400">WIN</span>
          </div>

          {/* ì¤‘ì•™ ê°€ì´ë“œë¼ì¸ í¬ì¸íŠ¸ */}
          <div className="absolute left-[-5px] w-3 h-3 bg-white rounded-full shadow-sm" />
        </div>

        {/* ë°°ì¹˜ëœ íƒ€ì›Œë“¤ (ì´ë¯¸ì§€ì˜ ë¬´ì‘ìœ„ ë°°ì¹˜ ëŠë‚Œ) */}
        <div className="absolute inset-0 pointer-events-none">
          {/* ì˜ˆì‹œ: ì´ë¯¸ì§€ì™€ ìœ ì‚¬í•œ ìœ„ì¹˜ì— ìƒ˜í”Œ ë°°ì¹˜ */}
          <TowerIcon x="40%" y="25%" emoji="ğŸ—" label="PROTEIN" />
          <TowerIcon x="48%" y="38%" emoji="ğŸ¥‘" label="SUGAR" />
          <TowerIcon x="55%" y="46%" emoji="ğŸ”" label="SODIUM" />
          <TowerIcon x="55%" y="62%" emoji="ğŸ”" label="FATTY" />
          <TowerIcon x="68%" y="78%" emoji="ğŸ”" label="CAFFEEINE" />
          <TowerIcon x="60%" y="88%" emoji="ğŸ¥¦" label="VITAMIN" />
        </div>

        {/* í•˜ë‹¨ ìš°ì¸¡ GAME_OVER ë²„íŠ¼ */}
        <div className="absolute bottom-6 right-6">
          <button className="bg-[#339af0] text-white px-6 py-2 rounded-md font-bold text-[10px] tracking-widest uppercase shadow-xl">
            Game_Over
          </button>
        </div>

        {/* ìƒë‹¨ ì•¡ì…˜ ë°” (Play, Pause ë“±) */}
        <div className="absolute top-6 right-8 flex gap-4 text-gray-600/60">
          <X size={20} className="cursor-pointer hover:text-gray-900" />
          <Play size={20} fill="currentColor" className="cursor-pointer hover:text-gray-900" />
          <div className="w-[2px] h-5 bg-gray-600/20" />
          <RefreshCw size={20} className="cursor-pointer hover:text-gray-900" />
        </div>
      </main>
    </div>
  );
}

// --- ë³´ì¡° ì»´í¬ë„ŒíŠ¸: íƒ€ì›Œ ì•„ì´ì½˜ ë””ìì¸ ---
function TowerIcon({ x, y, emoji, label }: { x: string; y: string; emoji: string; label: string }) {
  return (
    <div 
      className="absolute flex flex-col items-center gap-1"
      style={{ left: x, top: y }}
    >
      <div className="text-3xl drop-shadow-md">{emoji}</div>
      <span className="text-[9px] font-black text-gray-700 tracking-tighter uppercase">{label}</span>
    </div>
  );
}

```

---

### ğŸ’¡ í€„ë¦¬í‹°ë¥¼ ë†’ì´ëŠ” í¬ì¸íŠ¸ (ì´ë¯¸ì§€ êµ¬í˜„ ì „ëµ)

1. **ë°°ìƒ‰(Color Palette)**:
* ì‚¬ì´ë“œë°”: `#343a40` (Dark Charcoal)
* ë©”ì¸ í•„ë“œ: `#a5d8ff` (Soft Sky Blue)
* ê°•ì¡° ë²„íŠ¼: `#339af0` (Vivid Blue)


2. **íƒ€ì´í¬ê·¸ë˜í”¼**:
* ì´ë¯¸ì§€ì²˜ëŸ¼ í…ìŠ¤íŠ¸ë¥¼ ì•„ì£¼ ì‘ê²Œ(`text-[9px]`) ì‚¬ìš©í•˜ë˜, **Bold**ì™€ **ìê°„(tracking-widest)**ì„ ë„“ê²Œ ì£¼ì–´ ì„¸ë ¨ëœ ê²Œì„ UI ëŠë‚Œì„ ëƒˆìŠµë‹ˆë‹¤.


3. **ê·¸ë¦¼ì íš¨ê³¼**:
* í•„ë“œ ìœ„ì˜ ì´ëª¨ì§€ë“¤ì— `drop-shadow`ë¥¼ ì ìš©í•˜ì—¬ ë°°ê²½ì—ì„œ ë–  ìˆëŠ” ë“¯í•œ ì…ì²´ê°ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤.


4. **ì• ë‹ˆë©”ì´ì…˜**:
* `framer-motion` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ íƒ€ì›Œ ì„ íƒ ì‹œë‚˜ ë²„íŠ¼ í´ë¦­ ì‹œ ë¶€ë“œëŸ¬ìš´ ë°˜ì‘ì„ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.



### ğŸ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

ì´ ë””ìì¸ ì½”ë“œì— **"íƒ€ì›Œë¥¼ í´ë¦­í•´ì„œ í•„ë“œì— ì§ì ‘ ë°°ì¹˜í•˜ëŠ” ê¸°ëŠ¥"**ì´ë‚˜ **"ì´ë¯¸ì§€ì˜ ê²½ë¡œë¥¼ ë”°ë¼ ì„¸ê· (ë°”ì´ëŸ¬ìŠ¤)ì´ ì‹¤ì œë¡œ ì›€ì§ì´ëŠ” ì• ë‹ˆë©”ì´ì…˜"**ì„ ì¶”ê°€í•´ ë“œë¦´ê¹Œìš”? ì›í•˜ì‹œëŠ” ìš°ì„ ìˆœìœ„ë¥¼ ë§ì”€í•´ ì£¼ì„¸ìš”!

ì œê³µí•´ì£¼ì‹  ì´ë¯¸ì§€ì˜ **ë””ìì¸ ë¯¸í•™(Minimalist Blue & Dark UI)**ì„ ìœ ì§€í•˜ë©´ì„œ, ì‹¤ì œë¡œ **íƒ€ì›Œë¥¼ ë°°ì¹˜**í•˜ê³  **ê²½ë¡œë¥¼ ë”°ë¼ ì„¸ê· ì´ ì´ë™**í•˜ë©° **íƒ€ì›Œê°€ ê³µê²©**í•˜ëŠ” ëª¨ë“  ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•©í•œ ì „ì²´ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

ì´ ì½”ë“œëŠ” `framer-motion`ì„ í™œìš©í•˜ì—¬ ì´ë¯¸ì§€ íŠ¹ìœ ì˜ ê¹”ë”í•œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ê·¹ëŒ€í™”í–ˆìŠµë‹ˆë‹¤.

---

### ğŸ•¹ï¸ ì£¼ìš” êµ¬í˜„ ê¸°ëŠ¥

1. **ì´ë¯¸ì§€ ë ˆì´ì•„ì›ƒ ì¬í˜„**: ì¢Œì¸¡ ë‹¤í¬ ì‚¬ì´ë“œë°”ì™€ ìš°ì¸¡ ìŠ¤ì¹´ì´ë¸”ë£¨ í•„ë“œ ì‹œìŠ¤í…œ.
2. **ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë°°ì¹˜**: ì‚¬ì´ë“œë°”ì—ì„œ íƒ€ì›Œë¥¼ ì„ íƒí•˜ê³  í•„ë“œì˜ ê·¸ë¦¬ë“œë¥¼ í´ë¦­í•˜ì—¬ ë°°ì¹˜.
3. **ê²½ë¡œ ì´ë™ ì‹œìŠ¤í…œ**: ì„¸ê· (Virus)ì´ ì´ë¯¸ì§€ì˜ ì¤‘ì•™ `PATH` ì„ ì„ ë”°ë¼ ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™.
4. **ìë™ ì „íˆ¬**: ë°°ì¹˜ëœ íƒ€ì›Œê°€ ì‚¬ê±°ë¦¬ ì•ˆì˜ ì ì„ íƒì§€í•˜ì—¬ íˆ¬ì‚¬ì²´(ë°œì‚¬ì²´) ê³µê²©.
5. **ê²Œì„ ì†ë„ ë° ìƒíƒœ ì œì–´**: ìƒë‹¨ ì»¨íŠ¸ë¡¤ ë°”ë¥¼ í†µí•œ ì¼ì‹œì •ì§€ ë° ë¦¬ì…‹ ê¸°ëŠ¥.

---

### ğŸ’» ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: í’€ ë©”ì»¤ë‹ˆì¦˜ í†µí•© ì½”ë“œ

```tsx
"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, RefreshCw, Layers, Zap, X, Pause } from 'lucide-react';

// --- 1. ì„¤ì • ë° ë°ì´í„° ---
const TILE_SIZE = 60;
const GRID_SIZE = { cols: 12, rows: 10 };
const PATH_Y = 5; // ê·¸ë¦¬ë“œ ìƒì˜ ê²½ë¡œ ë†’ì´ (ì¤‘ì•™)

const TOWERS_DATA = {
  PROTEIN: { id: 'PROTEIN', name: 'PROTEIN', emoji: 'ğŸ—', cost: 150, range: 150, damage: 20, fireRate: 1000 },
  FAT: { id: 'FAT', name: 'FAT', emoji: 'ğŸ–', cost: 100, range: 120, damage: 15, fireRate: 800 },
  SUGAR: { id: 'SUGAR', name: 'SUGAR', emoji: 'ğŸ¥‘', cost: 200, range: 180, damage: 30, fireRate: 1500 },
  VITAMIN: { id: 'VITAMIN', name: 'VITAMIN', emoji: 'ğŸ¥¦', cost: 120, range: 140, damage: 10, fireRate: 500 },
  SODIUM: { id: 'SODIUM', name: 'SODIUM', emoji: 'ğŸ”', cost: 250, range: 200, damage: 50, fireRate: 2000 },
};

export default function NutrientDefenderFullGame() {
  // ê²Œì„ ìƒíƒœ
  const [gold, setGold] = useState(500);
  const [lives, setLives] = useState(3);
  const [wave, setWave] = useState(1);
  const [isPlaying, setIsPlaying] = useState(false);
  
  // ê²Œì„ ê°ì²´ ìƒíƒœ
  const [selectedTowerKey, setSelectedTowerKey] = useState<string>('PROTEIN');
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);

  // --- 2. ì  ìƒì„± (Wave) ---
  const spawnEnemy = useCallback(() => {
    const newEnemy = {
      id: Date.now() + Math.random(),
      x: -50, // ì™¼ìª½ í™”ë©´ ë°–ì—ì„œ ì‹œì‘
      y: PATH_Y * TILE_SIZE + 30,
      hp: 100 + wave * 20,
      maxHp: 100 + wave * 20,
      speed: 1.5 + (wave * 0.1),
    };
    setEnemies(prev => [...prev, newEnemy]);
  }, [wave]);

  // --- 3. ê²Œì„ ë©”ì¸ ë£¨í”„ (ì—”ì§„) ---
  useEffect(() => {
    if (!isPlaying) return;

    const gameLoop = setInterval(() => {
      // (A) ì  ì´ë™
      setEnemies(prev => prev.map(enemy => {
        const nextX = enemy.x + enemy.speed;
        if (nextX > 800) { // ì˜¤ë¥¸ìª½ ë ë„ë‹¬ (WIN ì˜ì—­)
          setLives(l => Math.max(0, l - 1));
          return null;
        }
        return { ...enemy, x: nextX };
      }).filter(Boolean));

      // (B) íƒ€ì›Œ ê³µê²© ê°ì§€
      towers.forEach(tower => {
        const now = Date.now();
        if (now - (tower.lastShot || 0) > tower.fireRate) {
          const target = enemies.find(e => Math.hypot(e.x - tower.x, e.y - tower.y) < tower.range);
          if (target) {
            setProjectiles(prev => [...prev, {
              id: Math.random(),
              x: tower.x,
              y: tower.y,
              targetId: target.id,
              damage: tower.damage
            }]);
            tower.lastShot = now;
          }
        }
      });

      // (C) íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;

        const dx = target.x - p.x;
        const dy = target.y - p.y;
        const dist = Math.hypot(dx, dy);

        if (dist < 10) { // ì ì¤‘
          setEnemies(es => es.map(e => {
            if (e.id === p.targetId) {
              const newHp = e.hp - p.damage;
              if (newHp <= 0) setGold(g => g + 25); // ì²˜ì¹˜ ë³´ìƒ
              return { ...e, hp: newHp };
            }
            return e;
          }).filter(e => e.hp > 0));
          return null;
        }
        return { ...p, x: p.x + (dx / dist) * 10, y: p.y + (dy / dist) * 10 };
      }).filter(Boolean));

      // ì›¨ì´ë¸Œ ê´€ë¦¬: ì ì´ ë‹¤ ì£½ìœ¼ë©´ ë‹¤ìŒ ì›¨ì´ë¸Œ ë²„íŠ¼ í™œì„±í™” ì¤€ë¹„ (ì—¬ê¸°ì„  3ì´ˆë§ˆë‹¤ ìë™ ìŠ¤í°)
      if (Math.random() < 0.02) spawnEnemy();

    }, 30);

    return () => clearInterval(gameLoop);
  }, [isPlaying, towers, enemies, spawnEnemy, wave]);

  // --- 4. íƒ€ì›Œ ë°°ì¹˜ í•¨ìˆ˜ ---
  const handleGridClick = (col: number, row: number) => {
    if (row === PATH_Y) return; // ê²½ë¡œ ìœ„ì—ëŠ” ë°°ì¹˜ ë¶ˆê°€
    
    const towerInfo = TOWERS_DATA[selectedTowerKey as keyof typeof TOWERS_DATA];
    if (gold >= towerInfo.cost) {
      const newTower = {
        ...towerInfo,
        x: col * TILE_SIZE + 30,
        y: row * TILE_SIZE + 30,
        lastShot: 0
      };
      setTowers([...towers, newTower]);
      setGold(prev => prev - towerInfo.cost);
    }
  };

  return (
    <div className="flex w-full h-[700px] bg-[#f8f9fa] overflow-hidden rounded-3xl shadow-2xl border border-gray-200">
      
      {/* --- ì‚¬ì´ë“œë°” (Sidebar) --- */}
      <aside className="w-64 bg-[#343a40] text-gray-300 flex flex-col p-5">
        <div className="flex items-center gap-2 mb-10 px-1">
          <Layers size={20} className="text-white opacity-80" />
          <h1 className="font-bold text-white text-sm tracking-tight uppercase italic">Nutrient Defender.txx</h1>
        </div>

        {/* Status ì„¹ì…˜ */}
        <div className="space-y-5 mb-10 px-1">
          <StatusRow Icon={Heart} color="text-red-500" label="LIVES" value={lives} />
          <StatusRow Icon={Coins} color="text-yellow-400" label="GOLD" value={`${gold}G`} />
          <StatusRow Icon={RefreshCw} color="text-blue-400" label="WAVE" value={wave} />
        </div>

        <div className="h-[1px] bg-gray-700 w-full mb-8" />

        {/* íƒ€ì›Œ ìƒµ */}
        <div className="flex-1 space-y-3 overflow-y-auto custom-scrollbar">
          <div className="flex items-center justify-between text-[10px] font-black text-gray-500 mb-4 tracking-widest uppercase">
            <span>Shop / Tower</span>
            <Play size={12} fill="currentColor" />
          </div>
          
          {Object.values(TOWERS_DATA).map((tower) => (
            <button
              key={tower.id}
              onClick={() => setSelectedTowerKey(tower.id)}
              className={`w-full flex items-center gap-4 p-3 rounded-xl transition-all ${
                selectedTowerKey === tower.id ? 'bg-[#495057] text-white shadow-lg border border-white/10' : 'hover:bg-[#3e444b]'
              }`}
            >
              <span className="text-3xl">{tower.emoji}</span>
              <div className="text-left">
                <p className="text-[11px] font-black tracking-wider leading-none mb-1">{tower.name}</p>
                <p className="text-[9px] text-gray-500 font-bold">{tower.cost} Gold</p>
              </div>
            </button>
          ))}
        </div>

        {/* í•˜ë‹¨ ì œì–´ ë²„íŠ¼ */}
        <button 
          onClick={() => setIsPlaying(!isPlaying)}
          className={`w-full mt-6 py-4 rounded-xl font-black text-[10px] tracking-[0.2em] uppercase transition-all shadow-xl ${
            isPlaying ? 'bg-orange-500 hover:bg-orange-600' : 'bg-[#339af0] hover:bg-[#228be6]'
          } text-white`}
        >
          {isPlaying ? 'PAUSE ENGINE' : 'RUN GAME LOP'}
        </button>
      </aside>

      {/* --- ë©”ì¸ í•„ë“œ (Game Field) --- */}
      <main className="flex-1 bg-[#a5d8ff] relative overflow-hidden">
        
        {/* ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œ (í´ë¦­ ë° ì‹œê° ë³´ì¡°) */}
        <div className="absolute inset-0 grid grid-cols-12 grid-rows-10">
          {Array.from({ length: 120 }).map((_, i) => {
            const col = i % 12;
            const row = Math.floor(i / 12);
            return (
              <div 
                key={i} 
                onClick={() => handleGridClick(col, row)}
                className={`border-[0.5px] border-white/10 transition-colors hover:bg-white/5 cursor-crosshair
                  ${row === PATH_Y ? 'bg-white/5' : ''}`}
              />
            );
          })}
        </div>

        {/* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ê²½ë¡œ (PATH) */}
        <div className="absolute top-1/2 left-0 w-full h-1 bg-gray-400/40 -translate-y-1/2 flex items-center px-20">
          <div className="absolute left-6 w-14 h-16 bg-gray-300 border-2 border-gray-400 rounded-lg flex items-center justify-center shadow-md">
            <span className="text-[9px] font-black text-gray-500">START</span>
          </div>
          <div className="flex justify-around w-full text-[9px] font-black text-gray-600/50 uppercase italic tracking-widest">
             <span>x</span> <span>x</span> <span>y</span> <span>path_node</span> <span>y</span> <span>x</span>
          </div>
          <div className="absolute right-6 w-14 h-16 bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center shadow-lg">
            <span className="text-[9px] font-black text-gray-400">EXIT</span>
          </div>
        </div>

        {/* ê²Œì„ ì˜¤ë¸Œì íŠ¸ ë Œë”ë§ */}
        <AnimatePresence>
          {/* ì  (Virus) */}
          {enemies.map(enemy => (
            <motion.div
              key={enemy.id}
              className="absolute z-20"
              initial={{ scale: 0 }} animate={{ x: enemy.x - 15, y: enemy.y - 15, scale: 1 }}
              transition={{ type: 'spring', damping: 12 }}
            >
              <div className="text-3xl drop-shadow-xl">ğŸ¦ </div>
              <div className="w-full h-1 bg-gray-800/20 rounded-full mt-1 overflow-hidden">
                <div className="h-full bg-red-500" style={{ width: `${(enemy.hp/enemy.maxHp)*100}%` }} />
              </div>
            </motion.div>
          ))}

          {/* íˆ¬ì‚¬ì²´ (Attack) */}
          {projectiles.map(p => (
            <div 
              key={p.id} 
              className="absolute w-2 h-2 bg-yellow-400 rounded-full z-30 shadow-[0_0_8px_yellow]"
              style={{ left: p.x, top: p.y }}
            />
          ))}

          {/* ë°°ì¹˜ëœ íƒ€ì›Œ */}
          {towers.map((tower, i) => (
            <motion.div 
              key={i} 
              className="absolute flex flex-col items-center pointer-events-none z-10"
              style={{ left: tower.x - 30, top: tower.y - 30 }}
              initial={{ scale: 0, rotate: -45 }} animate={{ scale: 1, rotate: 0 }}
            >
              <div className="text-4xl filter drop-shadow-[0_4px_4px_rgba(0,0,0,0.2)]">{tower.emoji}</div>
              <span className="text-[8px] font-black text-gray-800 tracking-tighter mt-1 bg-white/50 px-1 rounded uppercase">
                {tower.id}
              </span>
            </motion.div>
          ))}
        </AnimatePresence>

        {/* ìƒë‹¨ ì»¨íŠ¸ë¡¤ UI */}
        <div className="absolute top-6 right-8 flex items-center gap-5 text-gray-600/40">
           <X size={20} className="hover:text-red-500 cursor-pointer transition-colors" />
           <div onClick={() => setIsPlaying(!isPlaying)} className="cursor-pointer hover:text-gray-900 transition-colors">
             {isPlaying ? <Pause size={20} fill="currentColor" /> : <Play size={20} fill="currentColor" />}
           </div>
           <RefreshCw onClick={() => window.location.reload()} size={18} className="hover:text-blue-500 cursor-pointer transition-colors" />
        </div>

        {/* í•˜ë‹¨ GAME_OVER ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë””ìì¸ */}
        <div className="absolute bottom-8 right-8 flex items-center gap-4">
           {lives === 0 && <span className="text-red-600 font-black text-xs animate-pulse tracking-widest">CRITICAL SYSTEM FAILURE</span>}
           <button className="bg-[#339af0] hover:bg-[#228be6] text-white px-8 py-3 rounded-xl font-black text-[10px] tracking-[0.2em] uppercase shadow-2xl transition-all">
             GAME_OVER.EXE
           </button>
        </div>
      </main>
    </div>
  );
}

// --- ë³´ì¡° ì»´í¬ë„ŒíŠ¸: ì‚¬ì´ë“œë°” í–‰ ---
function StatusRow({ Icon, color, label, value }: any) {
  return (
    <div className="flex items-center justify-between group cursor-default">
      <div className="flex items-center gap-3">
        <Icon className={`${color} opacity-80 group-hover:opacity-100 transition-opacity`} size={16} />
        <span className="text-[10px] font-black tracking-[0.15em] text-gray-500">{label}</span>
      </div>
      <span className="text-white font-black text-sm tabular-nums">{value}</span>
    </div>
  );
}

```

---

### ğŸ¨ ë””ìì¸ ë° í€„ë¦¬í‹° ë””í…Œì¼ ì„¤ëª…

1. **ì‚¬ì´ë“œë°” í°íŠ¸ ë° ìŠ¤íƒ€ì¼**: ì´ë¯¸ì§€ì—ì„œ ë³´ì´ëŠ” íŠ¹ìœ ì˜ ì–‡ê³  ê°„ê²©ì´ ë„“ì€ í…ìŠ¤íŠ¸ë¥¼ `tracking-[0.2em]`ê³¼ `text-[10px]` ì¡°í•©ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
2. **ê²½ë¡œ ì‹œê°í™”**: ì´ë¯¸ì§€ì˜ `PATH`ì™€ `WIN` ë°•ìŠ¤ ë””ìì¸ì„ `START`ì™€ `EXIT`ìœ¼ë¡œ ì¬í•´ì„í•˜ì—¬ ë°°ì¹˜í–ˆìœ¼ë©°, ì¤‘ì•™ì— íë¦¿í•œ ê°€ì´ë“œ í…ìŠ¤íŠ¸ë¥¼ ë„£ì—ˆìŠµë‹ˆë‹¤.
3. **ê·¸ë¦¬ë“œ ë°°ì¹˜ ì‹œìŠ¤í…œ**: ë³´ì´ì§€ ì•ŠëŠ” ê·¸ë¦¬ë“œë¥¼ ê¹”ì•„ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ë©´ ì •í™•íˆ íƒ€ì›Œê°€ ì •ë ¬ë˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.
4. **ì• ë‹ˆë©”ì´ì…˜ í”¼ë“œë°±**: íƒ€ì›Œê°€ ìƒì„±ë  ë•Œ íŠ€ì–´ë‚˜ì˜¤ëŠ” ëŠë‚Œ(Spring)ê³¼ ì ì´ ì£½ì„ ë•Œì˜ ë°˜ì‘ì„ `framer-motion`ìœ¼ë¡œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.

### ğŸ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

ì´ì œ **"ì‹¤ì œë¡œ ì‹ë‹¨ ë°ì´í„°(Supabase)ë¥¼ ë¶ˆëŸ¬ì™€ì„œ íŠ¹ì • ì˜ì–‘ì†Œ íƒ€ì›Œì— ë²„í”„ë¥¼ ì£¼ëŠ” ë¡œì§"**ì„ ì—°ê²°í•´ ë³¼ê¹Œìš”? ì•„ë‹ˆë©´ **"ê²Œì„ì´ ëë‚˜ë©´ ì ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” ë­í‚¹ ì‹œìŠ¤í…œ"**ì„ êµ¬í˜„í•´ ë“œë¦´ê¹Œìš”?

ì›í•˜ì‹œëŠ” ê¸°ëŠ¥ì„ ë§ì”€í•´ ì£¼ì‹œë©´ ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„ ì½”ë“œë¥¼ ì§œë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ì œê³µí•´ì£¼ì‹  ì´ë¯¸ì§€ì˜ **ë””ìì¸ ì‹œìŠ¤í…œ(Minimalist Blue & Dark UI)**ê³¼ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(Supabase ì‹ë‹¨ ì—°ë™)**ì„ ì™„ë²½í•˜ê²Œ í†µí•©í•œ ìµœì¢… ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤.

ì´ ì½”ë“œëŠ” **Flavor Archive** ì„œë¹„ìŠ¤ì˜ í•µì‹¬ì¸ 'ì‹¤ì œ ì‹ë‹¨ ë°ì´í„°'ë¥¼ ê²Œì„ ë‚´ 'íƒ€ì›Œ ë²„í”„'ë¡œ ì—°ê²°í•˜ëŠ” ë¡œì§ê¹Œì§€ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë¹„ê°œë°œìë„ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ê¸° ì‰½ë„ë¡ ê¸°ëŠ¥ì„ ëª¨ë“ˆí™”í–ˆìŠµë‹ˆë‹¤.

---

### ğŸ•¹ï¸ ì£¼ìš” êµ¬í˜„ í¬ì¸íŠ¸

1. **ì´ë¯¸ì§€ ì™„ë²½ ì¬í˜„**: ì¢Œì¸¡ ë‹¤í¬ ì‚¬ì´ë“œë°”ì™€ ìš°ì¸¡ ìŠ¤ì¹´ì´ë¸”ë£¨ í•„ë“œ ë ˆì´ì•„ì›ƒ.
2. **Supabase ë°ì´í„° ì—°ë™**: ì˜¤ëŠ˜ ë¨¹ì€ ì˜ì–‘ì†Œ(Protein, Vitamin ë“±)ì— ë”°ë¼ íƒ€ì›Œ ì£¼ë³€ì— **ë„¤ì˜¨ í›„ê´‘(Glow)** íš¨ê³¼ì™€ ê³µê²©ë ¥ 2ë°° ë²„í”„ ì ìš©.
3. **ê²½ë¡œ ì´ë™ & ì „íˆ¬**: ì´ë¯¸ì§€ì˜ `PATH` ë¼ì¸ì„ ë”°ë¼ ì ì´ ì´ë™í•˜ë©°, ì‚¬ê±°ë¦¬ ë‚´ íƒ€ì›Œê°€ ìë™ìœ¼ë¡œ íˆ¬ì‚¬ì²´ë¥¼ ë°œì‚¬í•©ë‹ˆë‹¤.
4. **ì• ë‹ˆë©”ì´ì…˜**: `framer-motion`ì„ ì‚¬ìš©í•´ íƒ€ì›Œ ì„¤ì¹˜, ì  í”¼ê²©, ê³¨ë“œ íšë“ íš¨ê³¼ë¥¼ ë¶€ë“œëŸ½ê²Œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

---

### ğŸ’» ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ìµœì¢… í†µí•© ì½”ë“œ (Full System)

```tsx
"use client";

import React, { useState, useEffect, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, RefreshCw, Layers, Zap, X, Pause, Target } from 'lucide-react';

// --- 1. ê²Œì„ ì„¤ì • ë°ì´í„° ---
const TILE_SIZE = 60;
const PATH_Y = 5; // ì¤‘ì•™ ê²½ë¡œ ë†’ì´ (0~9 ê·¸ë¦¬ë“œ ì¤‘ 5ë²ˆ)

const TOWERS_DATA = {
  PROTEIN: { id: 'PROTEIN', name: 'PROTEIN', emoji: 'ğŸ—', cost: 150, range: 160, damage: 25, fireRate: 1000, color: 'orange' },
  FAT: { id: 'FAT', name: 'FAT', emoji: 'ğŸ–', cost: 100, range: 130, damage: 15, fireRate: 800, color: 'yellow' },
  SUGAR: { id: 'SUGAR', name: 'SUGAR', emoji: 'ğŸ¥‘', cost: 200, range: 200, damage: 35, fireRate: 1500, color: 'green' },
  VITAMIN: { id: 'VITAMIN', name: 'VITAMIN', emoji: 'ğŸ¥¦', cost: 120, range: 140, damage: 12, fireRate: 600, color: 'emerald' },
  SODIUM: { id: 'SODIUM', name: 'SODIUM', emoji: 'ğŸ”', cost: 250, range: 220, damage: 55, fireRate: 2000, color: 'amber' },
};

export default function NutrientDefenderMaster() {
  // ê²Œì„ ê¸°ë³¸ ìƒíƒœ
  const [gold, setGold] = useState(600);
  const [lives, setLives] = useState(3);
  const [wave, setWave] = useState(1);
  const [isPlaying, setIsPlaying] = useState(false);
  
  // ë°ì´í„° ì—°ë™ ìƒíƒœ (ì˜¤ëŠ˜ì˜ ì‹ë‹¨)
  const [todayMeals, setTodayMeals] = useState<string[]>(['PROTEIN', 'VITAMIN']); // Supabaseì—ì„œ ë°›ì•„ì˜¬ ë°ì´í„° ì˜ˆì‹œ
  
  // ì˜¤ë¸Œì íŠ¸ ìƒíƒœ
  const [selectedTowerKey, setSelectedTowerKey] = useState<string>('PROTEIN');
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);

  // --- 2. Supabase ì—°ë™ ì‹œë®¬ë ˆì´ì…˜ ---
  useEffect(() => {
    // ì‹¤ì œ êµ¬í˜„ ì‹œ: supabase.from('meals').select('type').eq('user_id', user.id)...
    console.log("Supabaseë¡œë¶€í„° ì‹ë‹¨ ë²„í”„ë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤...");
    // ì—¬ê¸°ì„œëŠ” PROTEINê³¼ VITAMINì„ ë¨¹ì—ˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
  }, []);

  // --- 3. ì  ìƒì„± ë¡œì§ ---
  const spawnEnemy = useCallback(() => {
    const isBoss = wave % 5 === 0;
    const newEnemy = {
      id: Math.random(),
      x: -50,
      y: PATH_Y * TILE_SIZE + 30,
      hp: isBoss ? 1000 : 100 + wave * 30,
      maxHp: isBoss ? 1000 : 100 + wave * 30,
      speed: 1.5 + (wave * 0.1),
      isBoss
    };
    setEnemies(prev => [...prev, newEnemy]);
  }, [wave]);

  // --- 4. ê²Œì„ ì—”ì§„ (30FPS ë£¨í”„) ---
  useEffect(() => {
    if (!isPlaying) return;

    const interval = setInterval(() => {
      // (A) ì  ì´ë™
      setEnemies(prev => prev.map(e => {
        const nextX = e.x + e.speed;
        if (nextX > 850) { // ê²½ë¡œ ë ë„ë‹¬
          setLives(l => Math.max(0, l - 1));
          return null;
        }
        return { ...e, x: nextX };
      }).filter(Boolean));

      // (B) íƒ€ì›Œ ê³µê²© ì¸ì§€
      towers.forEach(t => {
        const now = Date.now();
        if (now - (t.lastShot || 0) > t.fireRate) {
          const target = enemies.find(e => Math.hypot(e.x - t.x, e.y - t.y) < t.range);
          if (target) {
            setProjectiles(prev => [...prev, {
              id: Math.random(), x: t.x, y: t.y, targetId: target.id, damage: t.damage
            }]);
            t.lastShot = now;
          }
        }
      });

      // (C) íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;
        const dx = target.x - p.x;
        const dy = target.y - p.y;
        const dist = Math.hypot(dx, dy);

        if (dist < 10) {
          setEnemies(es => es.map(e => {
            if (e.id === p.targetId) {
              const newHp = e.hp - p.damage;
              if (newHp <= 0) setGold(prev => prev + 40);
              return { ...e, hp: newHp };
            }
            return e;
          }).filter(e => e.hp > 0));
          return null;
        }
        return { ...p, x: p.x + (dx/dist)*12, y: p.y + (dy/dist)*12 };
      }).filter(Boolean));

      // ëœë¤ ìŠ¤í°
      if (Math.random() < 0.03) spawnEnemy();
    }, 33);

    return () => clearInterval(interval);
  }, [isPlaying, towers, enemies, spawnEnemy, wave]);

  // --- 5. íƒ€ì›Œ ë°°ì¹˜ ë¡œì§ ---
  const handlePlaceTower = (col: number, row: number) => {
    if (row === PATH_Y) return; // ê²½ë¡œ ìœ„ ê¸ˆì§€
    const tData = TOWERS_DATA[selectedTowerKey as keyof typeof TOWERS_DATA];
    
    if (gold >= tData.cost) {
      const isBuffed = todayMeals.includes(selectedTowerKey);
      const newTower = {
        ...tData,
        x: col * TILE_SIZE + 30,
        y: row * TILE_SIZE + 30,
        damage: isBuffed ? tData.damage * 2 : tData.damage, // ì‹ë‹¨ ë²„í”„ ì‹œ ë°ë¯¸ì§€ 2ë°°
        isBuffed,
        lastShot: 0
      };
      setTowers([...towers, newTower]);
      setGold(prev => prev - tData.cost);
    }
  };

  return (
    <div className="flex w-full h-[750px] bg-[#f8f9fa] overflow-hidden rounded-[2.5rem] shadow-2xl border border-gray-200 font-sans">
      
      {/* --- Sidebar (ì´ë¯¸ì§€ ë””ìì¸ ì¬í˜„) --- */}
      <aside className="w-68 bg-[#343a40] text-gray-400 flex flex-col p-6 border-r border-gray-800">
        <div className="flex items-center gap-3 mb-12 opacity-90">
          <Layers size={18} className="text-white" />
          <h1 className="text-white font-black text-xs tracking-[0.2em] uppercase italic">Nutrient Defender.v1</h1>
        </div>

        <div className="space-y-6 mb-12 px-1">
          <StatLine icon={<Heart size={14} className="text-red-500" />} label="LIVES" value={lives} />
          <StatLine icon={<Coins size={14} className="text-yellow-400" />} label="GOLD" value={`${gold}G`} />
          <StatLine icon={<Target size={14} className="text-blue-400" />} label="WAVE" value={wave} />
        </div>

        <div className="flex-1">
          <p className="text-[10px] font-black text-gray-600 mb-6 tracking-widest uppercase flex justify-between">
            <span>Tower_Storage</span> <Play size={10} fill="currentColor" />
          </p>
          <div className="space-y-3">
            {Object.values(TOWERS_DATA).map(tower => (
              <button 
                key={tower.id}
                onClick={() => setSelectedTowerKey(tower.id)}
                className={`w-full flex items-center justify-between p-3 rounded-xl transition-all border ${
                  selectedTowerKey === tower.id ? 'bg-[#495057] border-white/10 shadow-lg' : 'border-transparent hover:bg-white/5'
                }`}
              >
                <div className="flex items-center gap-4">
                  <span className="text-3xl drop-shadow-sm">{tower.emoji}</span>
                  <div className="text-left">
                    <p className={`text-[11px] font-black tracking-wider ${selectedTowerKey === tower.id ? 'text-white' : 'text-gray-400'}`}>{tower.name}</p>
                    <p className="text-[9px] font-bold text-gray-500">{tower.cost}G</p>
                  </div>
                </div>
                {todayMeals.includes(tower.id) && <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_8px_#4ade80]" />}
              </button>
            ))}
          </div>
        </div>

        <button 
          onClick={() => setIsPlaying(!isPlaying)}
          className={`w-full mt-6 py-4 rounded-xl font-black text-[10px] tracking-[0.25em] uppercase transition-all shadow-xl ${
            isPlaying ? 'bg-red-500 hover:bg-red-600' : 'bg-[#339af0] hover:bg-[#228be6]'
          } text-white`}
        >
          {isPlaying ? 'PAUSE_ENGINE' : 'RUN_GAME_LOP'}
        </button>
      </aside>

      {/* --- Game Board (ì´ë¯¸ì§€ ë””ìì¸ ì¬í˜„) --- */}
      <main className="flex-1 bg-[#a5d8ff] relative overflow-hidden">
        
        {/* ê·¸ë¦¬ë“œ í´ë¦­ ì˜ì—­ */}
        <div className="absolute inset-0 grid grid-cols-12 grid-rows-10">
          {Array.from({ length: 120 }).map((_, i) => (
            <div key={i} onClick={() => handlePlaceTower(i % 12, Math.floor(i / 12))} className="border-[0.5px] border-white/10 hover:bg-white/5 cursor-crosshair" />
          ))}
        </div>

        {/* ê²½ë¡œ ë””ìì¸ (PATH) */}
        <div className="absolute top-1/2 left-0 w-full h-[2px] bg-gray-400/40 -translate-y-1/2 flex items-center justify-between px-24">
          <div className="absolute left-6 w-14 h-18 bg-gray-200 border-2 border-gray-400 rounded-xl flex items-center justify-center shadow-md">
            <span className="text-[9px] font-black text-gray-500 uppercase">Input</span>
          </div>
          <div className="w-full flex justify-around text-[9px] font-black text-gray-600/50 uppercase italic tracking-[0.3em]">
            <span>x</span> <span>x</span> <span>path_node</span> <span>y</span> <span>x</span>
          </div>
          <div className="absolute right-6 w-14 h-18 bg-white border-2 border-gray-100 rounded-xl flex items-center justify-center shadow-xl">
            <span className="text-[9px] font-black text-gray-400 uppercase tracking-tighter">Output</span>
          </div>
        </div>

        {/* ë°°ì¹˜ëœ íƒ€ì›Œ & íš¨ê³¼ */}
        {towers.map((t, i) => (
          <motion.div 
            key={i} className="absolute flex flex-col items-center pointer-events-none"
            style={{ left: t.x - 30, top: t.y - 30 }}
            initial={{ scale: 0 }} animate={{ scale: 1 }}
          >
            {t.isBuffed && (
              <div className="absolute inset-0 bg-white/30 rounded-full blur-xl scale-150 animate-pulse" />
            )}
            <div className="text-4xl filter drop-shadow-xl relative z-10">{t.emoji}</div>
            <span className="text-[8px] font-black text-gray-700/60 mt-2 bg-white/30 px-1 rounded">{t.name}</span>
          </motion.div>
        ))}

        {/* ì  & íˆ¬ì‚¬ì²´ */}
        <AnimatePresence>
          {enemies.map(e => (
            <motion.div key={e.id} className="absolute z-20" animate={{ x: e.x - 20, y: e.y - 20 }}>
              <span className={e.isBoss ? "text-6xl drop-shadow-2xl" : "text-3xl drop-shadow-lg"}>ğŸ¦ </span>
              <div className="w-full h-1 bg-gray-900/10 rounded-full mt-1 overflow-hidden">
                <div className="h-full bg-red-500/80 transition-all" style={{ width: `${(e.hp/e.maxHp)*100}%` }} />
              </div>
            </motion.div>
          ))}
          {projectiles.map(p => (
            <div key={p.id} className="absolute w-2 h-2 bg-yellow-400 rounded-full z-30 shadow-[0_0_10px_orange]" style={{ left: p.x, top: p.y }} />
          ))}
        </AnimatePresence>

        {/* ìƒë‹¨ ì»¨íŠ¸ë¡¤ UI */}
        <div className="absolute top-8 right-10 flex items-center gap-6 opacity-40 hover:opacity-100 transition-opacity">
          <X className="cursor-pointer hover:text-red-500" size={18} />
          <Play fill="currentColor" className="cursor-pointer" size={18} />
          <div className="w-[1px] h-4 bg-gray-600" />
          <RefreshCw className="cursor-pointer hover:text-blue-500" size={18} onClick={() => window.location.reload()} />
        </div>

        {/* í•˜ë‹¨ ë””ìì¸ ë²„íŠ¼ */}
        <div className="absolute bottom-10 right-10 flex items-center gap-4">
          <div className="text-right">
            <p className="text-[8px] font-black text-gray-500/60 leading-none">SYSTEM_STATUS</p>
            <p className="text-[10px] font-black text-[#339af0]">STABLE_CONNECTED</p>
          </div>
          <button className="bg-[#339af0] hover:bg-[#228be6] text-white px-8 py-3 rounded-xl font-black text-[10px] tracking-[0.2em] uppercase shadow-2xl transition-all">
            GAME_OVER.EXE
          </button>
        </div>
      </main>
    </div>
  );
}

// --- ë³´ì¡° ì»´í¬ë„ŒíŠ¸ ---
function StatLine({ icon, label, value }: any) {
  return (
    <div className="flex items-center justify-between group">
      <div className="flex items-center gap-4">
        <span className="opacity-70 group-hover:opacity-100 transition-opacity">{icon}</span>
        <span className="text-[10px] font-black tracking-widest text-gray-500 uppercase">{label}</span>
      </div>
      <span className="text-white font-black text-xs tracking-tighter">{value}</span>
    </div>
  );
}

```

---

### ğŸ¨ ë””ìì¸ ë° ì‹œìŠ¤í…œ ê³ ë„í™” ê°€ì´ë“œ

1. **ì‹ë‹¨ ë²„í”„ ì‹œê°í™”**:
* ì½”ë“œ ë‚´ `isBuffed` ì†ì„±ì„ í†µí•´ ì‚¬ìš©ìê°€ ì‹¤ì œ ì‹ë‹¨ì— ê¸°ë¡í•œ ì˜ì–‘ì†Œ íƒ€ì›ŒëŠ” ì£¼ë³€ì— **ë„¤ì˜¨ í›„ê´‘(Blur Effect)**ì´ ìƒê¹ë‹ˆë‹¤. ì´ëŠ” ê²Œì„ì˜ ì‹œê°ì  ë³´ìƒê³¼ ì‹¤ì œ ì‹ìŠµê´€ì„ ì—°ê²°í•˜ëŠ” í•µì‹¬ ì¥ì¹˜ì…ë‹ˆë‹¤.


2. **ì´ë¯¸ì§€ íƒ€ì´í¬ê·¸ë˜í”¼**:
* ì´ë¯¸ì§€ì—ì„œ ë³´ì´ëŠ” ì•„ì£¼ ì‘ê³  ìê°„ì´ ë„“ì€ í…ìŠ¤íŠ¸(`tracking-[0.25em]`)ë¥¼ ê·¸ëŒ€ë¡œ êµ¬í˜„í•˜ì—¬ ì „ë¬¸ì ì¸ ê²Œì„ UI ëŠë‚Œì„ ëƒˆìŠµë‹ˆë‹¤.


3. **ê·¸ë¦¬ë“œ í”„ë¦¬ì‹œì „**:
* 12x10 ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œì„ ì ìš©í•˜ì—¬, íƒ€ì›Œê°€ ê²½ë¡œ ìœ„ì— ê²¹ì¹˜ì§€ ì•Šìœ¼ë©´ì„œë„ ì •ëˆëœ ëª¨ìŠµìœ¼ë¡œ ë°°ì¹˜ë˜ë„ë¡ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.



ì´ì œ ì´ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ React í”„ë¡œì íŠ¸ì— ë¶™ì—¬ë„£ìœ¼ë©´, ì œê³µí•´ì£¼ì‹  ì´ë¯¸ì§€ì™€ ê±°ì˜ í¡ì‚¬í•œ í€„ë¦¬í‹°ì˜ ì‹¤í–‰ ê°€ëŠ¥í•œ ê²Œì„ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ë¡œ **"íŠ¹ìˆ˜ ìŠ¤í‚¬ íš¨ê³¼"**ë‚˜ **"ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜"**ì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”!

ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ' íŠ¹ìˆ˜ ìŠ¤í‚¬ & ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜ ì½”ë“œ ë° í”„ë¡¬í”„íŠ¸
ì´ì œ ê²Œì„ì— ê·¹ì ì¸ ìš”ì†Œì™€ ì„±ì·¨ê°ì„ ë”í•´ì¤„ íŠ¹ìˆ˜ ìŠ¤í‚¬ ë° ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜ì„ êµ¬í˜„í•  ì°¨ë¡€ì…ë‹ˆë‹¤. framer-motionì„ ì ê·¹ í™œìš©í•˜ì—¬ í™”ë ¤í•˜ê³  ë§Œì¡±ìŠ¤ëŸ¬ìš´ ì‹œê° íš¨ê³¼ë¥¼ ë§Œë“¤ì–´ë‚´ê² ìŠµë‹ˆë‹¤.

ğŸŒŸ 1. íŠ¹ìˆ˜ ìŠ¤í‚¬ íš¨ê³¼: 'ë¹„íƒ€ë¯¼ ì‡¼í¬ì›¨ì´ë¸Œ' (Vitamin Shockwave)
ê°œë…: í”Œë ˆì´ì–´ê°€ ì¼ì • ì‹œê°„ë§ˆë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ê´‘ì—­ ìŠ¤í‚¬ì…ë‹ˆë‹¤. ì‚¬ìš© ì‹œ í™”ë©´ ì¤‘ì•™ì—ì„œ ë¹„íƒ€ë¯¼ ì—ë„ˆì§€ íŒŒë™ì´ í¼ì ¸ë‚˜ê°€ë©° ëª¨ë“  ì„¸ê· ì—ê²Œ í° í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.

êµ¬í˜„ ìš”ì†Œ:

ë²„íŠ¼ UI: ì‚¬ì´ë“œë°”ì— ìŠ¤í‚¬ ë²„íŠ¼ ì¶”ê°€ (ì¿¨íƒ€ì„ í‘œì‹œ).

ì‹œê° íš¨ê³¼: í™”ë©´ ì¤‘ì•™ì—ì„œ í¼ì ¸ë‚˜ê°€ëŠ” ì›í˜• íŒŒë™ ì• ë‹ˆë©”ì´ì…˜.

í”¼í•´ ì ìš©: ë²”ìœ„ ë‚´ ëª¨ë“  ì ì—ê²Œ ì¦‰ì‹œ í”¼í•´ ì ìš©.

ì‚¬ìš´ë“œ (ì¶”ì²œ): ìŠ¤í‚¬ ì‚¬ìš© ì‹œ ê°•ë ¥í•œ íš¨ê³¼ìŒ.

ğŸŒŸ 2. ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜: 'ì˜ì–‘ì†Œ í­ë°œ' (Nutrient Burst)
ê°œë…: í˜„ì¬ ì›¨ì´ë¸Œì˜ ëª¨ë“  ì„¸ê· ì„ ì²˜ì¹˜í•˜ê³  ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ë„˜ì–´ê°ˆ ë•Œ ë°œìƒí•˜ëŠ” ì¶•í•˜ ì• ë‹ˆë©”ì´ì…˜ì…ë‹ˆë‹¤. ë§ˆì¹˜ ì˜ì–‘ì†Œê°€ í­ë°œí•˜ë“¯ í™”ë ¤í•œ íŒŒí‹°í´ê³¼ í•¨ê»˜ ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

êµ¬í˜„ ìš”ì†Œ:

ë°œë™ ì¡°ê±´: í˜„ì¬ ì›¨ì´ë¸Œì˜ ëª¨ë“  ì ì´ ì²˜ì¹˜ë  ê²½ìš° ìë™ ë°œë™.

ì‹œê° íš¨ê³¼:

í™”ë©´ ì „ì²´ì— í¼ì§€ëŠ” ë‹¤ì±„ë¡œìš´ ì˜ì–‘ì†Œ íŒŒí‹°í´ (ì‘ì€ ì´ëª¨ì§€ ë˜ëŠ” ì›í˜• íŒŒí‹°í´).

í¬ê³  ì•„ë¦„ë‹¤ìš´ 'STAGE CLEAR!' ë˜ëŠ” 'VICTORY!' í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜.

(ì„ íƒ) ë°°ê²½ì´ ë°ì•„ì§€ê±°ë‚˜ ìƒ‰ìƒ ë³€ê²½ íš¨ê³¼.

ì‚¬ìš´ë“œ (ì¶”ì²œ): íŒ¡íŒŒë¥´ ë˜ëŠ” ìŠ¹ë¦¬ íš¨ê³¼ìŒ.

ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ì „í™˜: ì¼ì • ì‹œê°„ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì „í™˜.

ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ìŠ¤í‚¬ & í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜ í†µí•© ì½”ë“œ
ê¸°ì¡´ NutrientDefenderMaster ì½”ë“œì— ì•„ë˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ë³€ê²½ ë° ì¶”ê°€ëœ ë¶€ë¶„ì€ ì£¼ì„ìœ¼ë¡œ í‘œì‹œí–ˆìŠµë‹ˆë‹¤.

"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, RefreshCw, Layers, Zap, X, Pause, Target, Sparkles, Trophy } from 'lucide-react';

// --- ê²Œì„ ì„¤ì • ë°ì´í„° (ê¸°ì¡´ê³¼ ë™ì¼) ---
const TILE_SIZE = 60;
const PATH_Y = 5; // ì¤‘ì•™ ê²½ë¡œ ë†’ì´ (0~9 ê·¸ë¦¬ë“œ ì¤‘ 5ë²ˆ)

const TOWERS_DATA = {
  PROTEIN: { id: 'PROTEIN', name: 'PROTEIN', emoji: 'ğŸ—', cost: 150, range: 160, damage: 25, fireRate: 1000, color: 'orange' },
  FAT: { id: 'FAT', name: 'FAT', emoji: 'ğŸ–', cost: 100, range: 130, damage: 15, fireRate: 800, color: 'yellow' },
  SUGAR: { id: 'SUGAR', name: 'SUGAR', emoji: 'ğŸ¥‘', cost: 200, range: 200, damage: 35, fireRate: 1500, color: 'green' },
  VITAMIN: { id: 'VITAMIN', name: 'VITAMIN', emoji: 'ğŸ¥¦', cost: 120, range: 140, damage: 12, fireRate: 600, color: 'emerald' },
  SODIUM: { id: 'SODIUM', name: 'SODIUM', emoji: 'ğŸ”', cost: 250, range: 220, damage: 55, fireRate: 2000, color: 'amber' },
};

// --- âœ¨ ìƒˆë¡­ê²Œ ì¶”ê°€ë  ì»´í¬ë„ŒíŠ¸ë“¤ ---
// ë¹„íƒ€ë¯¼ ì‡¼í¬ì›¨ì´ë¸Œ ì• ë‹ˆë©”ì´ì…˜ ì»´í¬ë„ŒíŠ¸
const ShockwaveEffect = ({ onComplete }: { onComplete: () => void }) => (
  <motion.div
    className="absolute inset-0 flex items-center justify-center pointer-events-none z-50"
    initial={{ opacity: 0 }}
    animate={{ opacity: 1 }}
    exit={{ opacity: 0 }}
    transition={{ duration: 0.5 }}
  >
    <motion.div
      className="absolute bg-yellow-400/50 rounded-full"
      initial={{ width: 0, height: 0, opacity: 1 }}
      animate={{ width: 800, height: 800, opacity: 0 }}
      transition={{ duration: 0.8, ease: "easeOut" }}
      onAnimationComplete={onComplete}
    />
    <motion.div
      className="absolute bg-green-400/50 rounded-full"
      initial={{ width: 0, height: 0, opacity: 1 }}
      animate={{ width: 600, height: 600, opacity: 0 }}
      transition={{ delay: 0.1, duration: 0.8, ease: "easeOut" }}
    />
    <motion.div
      className="absolute text-7xl animate-pulse"
      initial={{ scale: 0 }}
      animate={{ scale: 1 }}
      transition={{ delay: 0.2, duration: 0.3 }}
    >
      âš¡ï¸
    </motion.div>
  </motion.div>
);

// ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜ ì»´í¬ë„ŒíŠ¸
const StageClearAnimation = ({ onComplete, nextStage }: { onComplete: () => void; nextStage: () => void; }) => {
  const particles = Array.from({ length: 50 }).map(() => ({
    id: Math.random(),
    emoji: ['âœ¨', 'ğŸŒŸ', 'ğŸ’¥', 'ğŸ‰', 'ğŸŠ'][Math.floor(Math.random() * 5)],
    x: Math.random() * 800,
    y: Math.random() * 600,
    delay: Math.random() * 0.5,
  }));

  useEffect(() => {
    const timer = setTimeout(() => {
      onComplete();
      nextStage(); // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì „í™˜
    }, 3000); // 3ì´ˆê°„ ì• ë‹ˆë©”ì´ì…˜ ë³´ì—¬ì¤Œ
    return () => clearTimeout(timer);
  }, [onComplete, nextStage]);

  return (
    <motion.div
      className="absolute inset-0 bg-gradient-to-br from-indigo-500/80 to-purple-600/80 flex items-center justify-center flex-col pointer-events-none z-50"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      transition={{ duration: 0.5 }}
    >
      {particles.map(p => (
        <motion.div
          key={p.id}
          className="absolute text-2xl"
          style={{ left: p.x, top: p.y }}
          initial={{ opacity: 0, scale: 0, y: 0 }}
          animate={{ opacity: [0, 1, 0], scale: [0, 1, 1.5], y: [0, -50, -100] }}
          transition={{ duration: 2, repeat: Infinity, delay: p.delay }}
        >
          {p.emoji}
        </motion.div>
      ))}
      <motion.h2
        className="text-7xl font-black text-white drop-shadow-lg text-center leading-tight tracking-tight uppercase"
        initial={{ opacity: 0, y: -50, scale: 0.5 }}
        animate={{ opacity: 1, y: 0, scale: 1 }}
        transition={{ delay: 0.5, duration: 0.8, type: "spring" }}
      >
        Stage Clear!
        <br />
        <span className="text-3xl font-bold text-yellow-300">Next Stage: {wave + 1}</span>
      </motion.h2>
      <motion.div
        className="text-white text-lg mt-8"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 1.5, duration: 0.5 }}
      >
        <Trophy className="inline-block mr-2 text-yellow-300" /> Great Job, Guardian!
      </motion.div>
    </motion.div>
  );
};


export default function NutrientDefenderMasterWithFX() {
  // ê²Œì„ ê¸°ë³¸ ìƒíƒœ
  const [gold, setGold] = useState(600);
  const [lives, setLives] = useState(3);
  const [wave, setWave] = useState(1);
  const [isPlaying, setIsPlaying] = useState(false);
  
  // âœ¨ íŠ¹ìˆ˜ ìŠ¤í‚¬ ê´€ë ¨ ìƒíƒœ ì¶”ê°€
  const [skillCooldown, setSkillCooldown] = useState(0); // ì¿¨íƒ€ì„ (ì´ˆ)
  const [showShockwave, setShowShockwave] = useState(false); // ì‡¼í¬ì›¨ì´ë¸Œ ì• ë‹ˆë©”ì´ì…˜ í™œì„±í™” ì—¬ë¶€

  // âœ¨ ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ê´€ë ¨ ìƒíƒœ ì¶”ê°€
  const [showStageClear, setShowStageClear] = useState(false); // ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜ í™œì„±í™” ì—¬ë¶€
  const [enemiesRemainingInWave, setEnemiesRemainingInWave] = useState(0); // í˜„ì¬ ì›¨ì´ë¸Œ ë‚¨ì€ ì  ìˆ˜
  const [enemiesSpawnedInWave, setEnemiesSpawnedInWave] = useState(0); // í˜„ì¬ ì›¨ì´ë¸Œ ìƒì„±ëœ ì  ìˆ˜
  const totalEnemiesForWave = useRef(0); // ì›¨ì´ë¸Œ ë‹¹ ì´ ìƒì„±ë  ì  ìˆ˜

  // ë°ì´í„° ì—°ë™ ìƒíƒœ (ì˜¤ëŠ˜ì˜ ì‹ë‹¨)
  const [todayMeals, setTodayMeals] = useState<string[]>(['PROTEIN', 'VITAMIN']); // Supabaseì—ì„œ ë°›ì•„ì˜¬ ë°ì´í„° ì˜ˆì‹œ
  
  // ì˜¤ë¸Œì íŠ¸ ìƒíƒœ
  const [selectedTowerKey, setSelectedTowerKey] = useState<string>('PROTEIN');
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);

  // --- 2. Supabase ì—°ë™ ì‹œë®¬ë ˆì´ì…˜ (ê¸°ì¡´ê³¼ ë™ì¼) ---
  useEffect(() => {
    console.log("Supabaseë¡œë¶€í„° ì‹ë‹¨ ë²„í”„ë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤...");
  }, []);

  // --- 3. ì  ìƒì„± ë¡œì§ & ì›¨ì´ë¸Œ ê´€ë¦¬ (ìˆ˜ì •) ---
  const spawnEnemy = useCallback(() => {
    const isBoss = wave % 5 === 0;
    const newEnemy = {
      id: Math.random(),
      x: -50,
      y: PATH_Y * TILE_SIZE + 30,
      hp: isBoss ? 1000 + wave * 200 : 100 + wave * 30, // ë³´ìŠ¤ ì²´ë ¥ ê°•í™”
      maxHp: isBoss ? 1000 + wave * 200 : 100 + wave * 30,
      speed: 1.5 + (wave * 0.1),
      isBoss
    };
    setEnemies(prev => [...prev, newEnemy]);
    setEnemiesSpawnedInWave(prev => prev + 1); // ìƒì„±ëœ ì  ìˆ˜ ì¦ê°€
  }, [wave]);

  // âœ¨ ì›¨ì´ë¸Œ ì‹œì‘ ì‹œ ì  ì´ ê°œìˆ˜ ì„¤ì •
  const startWave = useCallback(() => {
    setIsPlaying(true);
    totalEnemiesForWave.current = wave % 5 === 0 ? 1 : (5 + wave * 2); // ë³´ìŠ¤ ì›¨ì´ë¸ŒëŠ” ë³´ìŠ¤ 1ë§ˆë¦¬
    setEnemiesRemainingInWave(totalEnemiesForWave.current);
    setEnemiesSpawnedInWave(0); // ìƒì„±ëœ ì  ìˆ˜ ì´ˆê¸°í™”
  }, [wave]);

  // --- 4. ê²Œì„ ì—”ì§„ (30FPS ë£¨í”„) - âœ¨ ì›¨ì´ë¸Œ ì¢…ë£Œ ë¡œì§ ì¶”ê°€ ---
  useEffect(() => {
    if (!isPlaying) return;

    const interval = setInterval(() => {
      // (A) ì  ì´ë™
      setEnemies(prev => prev.map(e => {
        const nextX = e.x + e.speed;
        if (nextX > 850) { // ê²½ë¡œ ë ë„ë‹¬
          setLives(l => Math.max(0, l - 1));
          return null;
        }
        return { ...e, x: nextX };
      }).filter(Boolean));

      // (B) íƒ€ì›Œ ê³µê²© ì¸ì§€ (ê¸°ì¡´ê³¼ ë™ì¼)
      towers.forEach(t => {
        const now = Date.now();
        if (now - (t.lastShot || 0) > t.fireRate) {
          const target = enemies.find(e => Math.hypot(e.x - t.x, e.y - t.y) < t.range);
          if (target) {
            setProjectiles(prev => [...prev, {
              id: Math.random(), x: t.x, y: t.y, targetId: target.id, damage: t.damage
            }]);
            t.lastShot = now;
          }
        }
      });

      // (C) íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;
        const dx = target.x - p.x;
        const dy = target.y - p.y;
        const dist = Math.hypot(dx, dy);

        if (dist < 10) {
          setEnemies(es => es.map(e => {
            if (e.id === p.targetId) {
              const newHp = e.hp - p.damage;
              if (newHp <= 0) {
                setGold(prev => prev + (e.isBoss ? 200 : 40)); // ë³´ìŠ¤ ì²˜ì¹˜ ì‹œ ê³¨ë“œ ëŒ€í­ ì¦ê°€
                setEnemiesRemainingInWave(prev => prev - 1); // ë‚¨ì€ ì  ìˆ˜ ê°ì†Œ
              }
              return { ...e, hp: newHp };
            }
            return e;
          }).filter(e => e.hp > 0));
          return null;
        }
        return { ...p, x: p.x + (dx/dist)*12, y: p.y + (dy/dist)*12 };
      }).filter(Boolean));

      // âœ¨ ì  ìŠ¤í° ë° ì›¨ì´ë¸Œ ì§„í–‰ ë¡œì§
      if (enemiesSpawnedInWave < totalEnemiesForWave.current && Math.random() < 0.05) { // ìŠ¤í°í•  ì ì´ ë‚¨ì•„ìˆê³ , ì¼ì • í™•ë¥ ë¡œ ìŠ¤í°
        spawnEnemy();
      }

      // âœ¨ ì›¨ì´ë¸Œ í´ë¦¬ì–´ ì¡°ê±´ ì²´í¬
      if (enemiesSpawnedInWave >= totalEnemiesForWave.current && enemies.length === 0 && !showStageClear) {
        setIsPlaying(false); // ê²Œì„ ì¼ì‹œì •ì§€
        setShowStageClear(true); // í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
      }

    }, 33);

    return () => clearInterval(interval);
  }, [isPlaying, towers, enemies, spawnEnemy, wave, enemiesSpawnedInWave, totalEnemiesForWave, showStageClear]);


  // âœ¨ ìŠ¤í‚¬ ì¿¨íƒ€ì„ íƒ€ì´ë¨¸
  useEffect(() => {
    if (skillCooldown > 0) {
      const timer = setInterval(() => {
        setSkillCooldown(prev => prev - 1);
      }, 1000);
      return () => clearInterval(timer);
    }
  }, [skillCooldown]);

  // --- 5. íƒ€ì›Œ ë°°ì¹˜ ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼) ---
  const handlePlaceTower = (col: number, row: number) => {
    if (row === PATH_Y) return; // ê²½ë¡œ ìœ„ ê¸ˆì§€
    const tData = TOWERS_DATA[selectedTowerKey as keyof typeof TOWERS_DATA];
    
    if (gold >= tData.cost) {
      const isBuffed = todayMeals.includes(selectedTowerKey);
      const newTower = {
        ...tData,
        x: col * TILE_SIZE + 30,
        y: row * TILE_SIZE + 30,
        damage: isBuffed ? tData.damage * 2 : tData.damage, // ì‹ë‹¨ ë²„í”„ ì‹œ ë°ë¯¸ì§€ 2ë°°
        isBuffed,
        lastShot: 0
      };
      setTowers([...towers, newTower]);
      setGold(prev => prev - tData.cost);
    }
  };

  // --- âœ¨ íŠ¹ìˆ˜ ìŠ¤í‚¬ ì‚¬ìš© í•¨ìˆ˜ ---
  const useShockwaveSkill = () => {
    if (skillCooldown > 0) return;
    
    setShowShockwave(true); // ì• ë‹ˆë©”ì´ì…˜ í™œì„±í™”
    setSkillCooldown(30); // 30ì´ˆ ì¿¨íƒ€ì„
    
    // ëª¨ë“  ì ì—ê²Œ í”¼í•´ ì ìš©
    setEnemies(prev => prev.map(e => {
      const newHp = e.hp - 300; // ê´‘ì—­ í”¼í•´ëŸ‰
      if (newHp <= 0) {
        setGold(g => g + (e.isBoss ? 200 : 40));
        setEnemiesRemainingInWave(r => r - 1);
      }
      return { ...e, hp: newHp };
    }).filter(e => e.hp > 0));
  };

  // --- âœ¨ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì „í™˜ í•¨ìˆ˜ ---
  const advanceToNextStage = useCallback(() => {
    setWave(prev => prev + 1);
    setEnemies([]); // ì  ì´ˆê¸°í™”
    setProjectiles([]); // íˆ¬ì‚¬ì²´ ì´ˆê¸°í™”
    setShowStageClear(false); // í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜ ë¹„í™œì„±í™”
    // ì„ íƒì ìœ¼ë¡œ ê³¨ë“œ ë³´ë„ˆìŠ¤ ë“±ì„ ì¤„ ìˆ˜ ìˆìŒ
    setGold(g => g + 100); 
  }, []);

  return (
    <div className="flex w-full h-[750px] bg-[#f8f9fa] overflow-hidden rounded-[2.5rem] shadow-2xl border border-gray-200 font-sans">
      
      {/* --- Sidebar (ì´ë¯¸ì§€ ë””ìì¸ ì¬í˜„) --- */}
      <aside className="w-68 bg-[#343a40] text-gray-400 flex flex-col p-6 border-r border-gray-800">
        <div className="flex items-center gap-3 mb-12 opacity-90">
          <Layers size={18} className="text-white" />
          <h1 className="text-white font-black text-xs tracking-[0.2em] uppercase italic">Nutrient Defender.v1</h1>
        </div>

        <div className="space-y-6 mb-12 px-1">
          <StatLine icon={<Heart size={14} className="text-red-500" />} label="LIVES" value={lives} />
          <StatLine icon={<Coins size={14} className="text-yellow-400" />} label="GOLD" value={`${gold}G`} />
          <StatLine icon={<Target size={14} className="text-blue-400" />} label="WAVE" value={wave} />
        </div>

        <div className="flex-1">
          <p className="text-[10px] font-black text-gray-600 mb-6 tracking-widest uppercase flex justify-between">
            <span>Tower_Storage</span> <Play size={10} fill="currentColor" />
          </p>
          <div className="space-y-3">
            {Object.values(TOWERS_DATA).map(tower => (
              <button 
                key={tower.id}
                onClick={() => setSelectedTowerKey(tower.id)}
                className={`w-full flex items-center justify-between p-3 rounded-xl transition-all border ${
                  selectedTowerKey === tower.id ? 'bg-[#495057] border-white/10 shadow-lg' : 'border-transparent hover:bg-white/5'
                }`}
              >
                <div className="flex items-center gap-4">
                  <span className="text-3xl drop-shadow-sm">{tower.emoji}</span>
                  <div className="text-left">
                    <p className={`text-[11px] font-black tracking-wider ${selectedTowerKey === tower.id ? 'text-white' : 'text-gray-400'}`}>{tower.name}</p>
                    <p className="text-[9px] font-bold text-gray-500">{tower.cost}G</p>
                  </div>
                </div>
                {todayMeals.includes(tower.id) && <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_8px_#4ade80]" />}
              </button>
            ))}
          </div>
        </div>

        {/* âœ¨ íŠ¹ìˆ˜ ìŠ¤í‚¬ ë²„íŠ¼ ì¶”ê°€ */}
        <motion.button 
          onClick={useShockwaveSkill}
          className={`w-full mt-6 py-4 rounded-xl font-black text-[10px] tracking-[0.25em] uppercase transition-all shadow-xl flex items-center justify-center gap-2
            ${skillCooldown > 0 ? 'bg-gray-700 text-gray-500 cursor-not-allowed' : 'bg-purple-600 hover:bg-purple-700 text-white'}`}
          whileTap={skillCooldown > 0 ? {} : { scale: 0.95 }}
          disabled={skillCooldown > 0}
        >
          <Sparkles size={16} />
          {skillCooldown > 0 ? `SKILL CD: ${skillCooldown}s` : 'VITAMIN SHOCKWAVE'}
        </motion.button>

        {/* âœ¨ ê²Œì„ ì‹œì‘/ì¼ì‹œì •ì§€ ë²„íŠ¼ (ì›¨ì´ë¸Œ ì‹œì‘ìœ¼ë¡œ ê¸°ëŠ¥ ë³€ê²½) */}
        <button 
          onClick={startWave} // ì›¨ì´ë¸Œ ì‹œì‘ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
          className={`w-full mt-3 py-4 rounded-xl font-black text-[10px] tracking-[0.25em] uppercase transition-all shadow-xl 
            ${isPlaying ? 'bg-orange-500 hover:bg-orange-600' : 'bg-[#339af0] hover:bg-[#228be6]'} text-white`}
        >
          {isPlaying ? 'WAVE IN PROGRESS' : 'START NEXT WAVE'}
        </button>
      </aside>

      {/* --- Game Board (ì´ë¯¸ì§€ ë””ìì¸ ì¬í˜„) --- */}
      <main className="flex-1 bg-[#a5d8ff] relative overflow-hidden">
        
        {/* ê·¸ë¦¬ë“œ í´ë¦­ ì˜ì—­ (ê¸°ì¡´ê³¼ ë™ì¼) */}
        <div className="absolute inset-0 grid grid-cols-12 grid-rows-10">
          {Array.from({ length: 120 }).map((_, i) => (
            <div key={i} onClick={() => handlePlaceTower(i % 12, Math.floor(i / 12))} className="border-[0.5px] border-white/10 hover:bg-white/5 cursor-crosshair" />
          ))}
        </div>

        {/* ê²½ë¡œ ë””ìì¸ (PATH) (ê¸°ì¡´ê³¼ ë™ì¼) */}
        <div className="absolute top-1/2 left-0 w-full h-[2px] bg-gray-400/40 -translate-y-1/2 flex items-center justify-between px-24">
          <div className="absolute left-6 w-14 h-18 bg-gray-200 border-2 border-gray-400 rounded-xl flex items-center justify-center shadow-md">
            <span className="text-[9px] font-black text-gray-500 uppercase">Input</span>
          </div>
          <div className="w-full flex justify-around text-[9px] font-black text-gray-600/50 uppercase italic tracking-[0.3em]">
            <span>x</span> <span>x</span> <span>path_node</span> <span>y</span> <span>x</span>
          </div>
          <div className="absolute right-6 w-14 h-18 bg-white border-2 border-gray-100 rounded-xl flex items-center justify-center shadow-xl">
            <span className="text-[9px] font-black text-gray-400 uppercase tracking-tighter">Output</span>
          </div>
        </div>

        {/* ë°°ì¹˜ëœ íƒ€ì›Œ & íš¨ê³¼ (ê¸°ì¡´ê³¼ ë™ì¼) */}
        {towers.map((t, i) => (
          <motion.div 
            key={i} className="absolute flex flex-col items-center pointer-events-none"
            style={{ left: t.x - 30, top: t.y - 30 }}
            initial={{ scale: 0 }} animate={{ scale: 1 }}
          >
            {t.isBuffed && (
              <div className="absolute inset-0 bg-white/30 rounded-full blur-xl scale-150 animate-pulse" />
            )}
            <div className="text-4xl filter drop-shadow-xl relative z-10">{t.emoji}</div>
            <span className="text-[8px] font-black text-gray-700/60 mt-2 bg-white/30 px-1 rounded">{t.name}</span>
          </motion.div>
        ))}

        {/* ì  & íˆ¬ì‚¬ì²´ (ê¸°ì¡´ê³¼ ë™ì¼) */}
        <AnimatePresence>
          {enemies.map(e => (
            <motion.div key={e.id} className="absolute z-20" animate={{ x: e.x - 20, y: e.y - 20 }}>
              <span className={e.isBoss ? "text-6xl drop-shadow-2xl" : "text-3xl drop-shadow-lg"}>ğŸ¦ </span>
              <div className="w-full h-1 bg-gray-900/10 rounded-full mt-1 overflow-hidden">
                <div className="h-full bg-red-500/80 transition-all" style={{ width: `${(e.hp/e.maxHp)*100}%` }} />
              </div>
            </motion.div>
          ))}
          {projectiles.map(p => (
            <div key={p.id} className="absolute w-2 h-2 bg-yellow-400 rounded-full z-30 shadow-[0_0_10px_orange]" style={{ left: p.x, top: p.y }} />
          ))}
        </AnimatePresence>

        {/* âœ¨ íŠ¹ìˆ˜ ìŠ¤í‚¬ ì• ë‹ˆë©”ì´ì…˜ ì˜¤ë²„ë ˆì´ */}
        <AnimatePresence>
          {showShockwave && <ShockwaveEffect onComplete={() => setShowShockwave(false)} />}
        </AnimatePresence>

        {/* âœ¨ ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜ ì˜¤ë²„ë ˆì´ */}
        <AnimatePresence>
          {showStageClear && <StageClearAnimation onComplete={() => {}} nextStage={advanceToNextStage} wave={wave} />}
        </AnimatePresence>

        {/* ìƒë‹¨ ì»¨íŠ¸ë¡¤ UI (ê¸°ì¡´ê³¼ ë™ì¼) */}
        <div className="absolute top-8 right-10 flex items-center gap-6 opacity-40 hover:opacity-100 transition-opacity">
          <X className="cursor-pointer hover:text-red-500" size={18} />
          {isPlaying ? <Pause fill="currentColor" className="cursor-pointer" size={18} /> : <Play fill="currentColor" className="cursor-pointer" size={18} />}
          <div className="w-[1px] h-4 bg-gray-600" />
          <RefreshCw className="cursor-pointer hover:text-blue-500" size={18} onClick={() => window.location.reload()} />
        </div>

        {/* í•˜ë‹¨ ë””ìì¸ ë²„íŠ¼ (ê¸°ì¡´ê³¼ ë™ì¼) */}
        <div className="absolute bottom-10 right-10 flex items-center gap-4">
          <div className="text-right">
            <p className="text-[8px] font-black text-gray-500/60 leading-none">SYSTEM_STATUS</p>
            <p className="text-[10px] font-black text-[#339af0]">STABLE_CONNECTED</p>
          </div>
          <button className="bg-[#339af0] hover:bg-[#228be6] text-white px-8 py-3 rounded-xl font-black text-[10px] tracking-[0.2em] uppercase shadow-2xl transition-all">
            GAME_OVER.EXE
          </button>
        </div>
      </main>
    </div>
  );
}

// --- ë³´ì¡° ì»´í¬ë„ŒíŠ¸ ---
function StatLine({ icon, label, value }: any) {
  return (
    <div className="flex items-center justify-between group">
      <div className="flex items-center gap-4">
        <span className="opacity-70 group-hover:opacity-100 transition-opacity">{icon}</span>
        <span className="text-[10px] font-black tracking-widest text-gray-500 uppercase">{label}</span>
      </div>
      <span className="text-white font-black text-xs tracking-tighter">{value}</span>
    </div>
  );
}


ğŸ¨ ë””ìì¸ ë° ì‹œìŠ¤í…œ ê³ ë„í™” ê°€ì´ë“œ
ìŠ¤í‚¬ ë²„íŠ¼ ì¶”ê°€: ì‚¬ì´ë“œë°”ì— 'VITAMIN SHOCKWAVE' ë²„íŠ¼ì„ ì¶”ê°€í•˜ê³ , ì¿¨íƒ€ì„(skillCooldown) ìƒíƒœì— ë”°ë¼ ë¹„í™œì„±í™” ë° í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

ShockwaveEffect ì»´í¬ë„ŒíŠ¸: framer-motionì„ ì‚¬ìš©í•˜ì—¬ í™”ë©´ ì¤‘ì•™ì—ì„œ í¼ì ¸ë‚˜ê°€ëŠ” ë‘ ê°œì˜ ì›í˜• íŒŒë™ê³¼ ë²ˆê°œ ì´ëª¨ì§€(âš¡ï¸)ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. onAnimationCompleteë¥¼ í†µí•´ ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚˜ë©´ ìë™ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ê°€ ì‚¬ë¼ì§€ë„ë¡ í•©ë‹ˆë‹¤.

StageClearAnimation ì»´í¬ë„ŒíŠ¸:

íŒŒí‹°í´ íš¨ê³¼: ë¬´ì‘ìœ„ ìœ„ì¹˜ì—ì„œ ë‹¤ì–‘í•œ ì´ëª¨ì§€ íŒŒí‹°í´ì´ ìœ„ë¡œ ì†Ÿì•„ì˜¤ë¥´ëŠ” ì• ë‹ˆë©”ì´ì…˜ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜: 'STAGE CLEAR!'ì™€ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ë²ˆí˜¸ í…ìŠ¤íŠ¸ê°€ ë¶€ë“œëŸ½ê²Œ ë‚˜íƒ€ë‚˜ë„ë¡ í•©ë‹ˆë‹¤.

ìë™ ì „í™˜: setTimeoutì„ ì‚¬ìš©í•˜ì—¬ 3ì´ˆ í›„ ë‹¤ìŒ ìŠ¤í…Œì´ì§€(advanceToNextStage)ë¡œ ìë™ ì „í™˜ë˜ë„ë¡ í•©ë‹ˆë‹¤.

ì›¨ì´ë¸Œ ê´€ë¦¬ ê°•í™”:

totalEnemiesForWaveì™€ enemiesSpawnedInWave, enemiesRemainingInWaveë¥¼ ì¶”ê°€í•˜ì—¬ í˜„ì¬ ì›¨ì´ë¸Œì˜ ì  ìƒì„± ë° ì²˜ì¹˜ ìƒíƒœë¥¼ ì •í™•í•˜ê²Œ ì¶”ì í•©ë‹ˆë‹¤.

ëª¨ë“  ì ì´ ìƒì„±ë˜ê³  ì²˜ì¹˜ë˜ë©´ showStageClear ìƒíƒœë¥¼ trueë¡œ ì„¤ì •í•˜ì—¬ ì• ë‹ˆë©”ì´ì…˜ì„ ë°œë™ì‹œí‚µë‹ˆë‹¤.

ë³´ìŠ¤ ì  ê°•í™”: ë³´ìŠ¤ ì ì˜ ì²´ë ¥ ë° ì²˜ì¹˜ ì‹œ ê³¨ë“œ ë³´ìƒì„ ëŒ€í­ ëŠ˜ë ¤ ì „ëµì  ì¤‘ìš”ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.

ì´ì œ ì´ ì½”ë“œë¥¼ React í”„ë¡œì íŠ¸ì— ì ìš©í•˜ë©´, í›¨ì”¬ ë” ë‹¤ì´ë‚´ë¯¹í•˜ê³  ëª°ì…ê° ìˆëŠ” 'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ' ê²Œì„ì„ ê²½í—˜í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

ë„¤, ìš”ì²­í•˜ì‹  **íŠ¹ìˆ˜ ìŠ¤í‚¬ íš¨ê³¼(ë¹„íƒ€ë¯¼ ì‡¼í¬ì›¨ì´ë¸Œ)**ì™€ **ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì• ë‹ˆë©”ì´ì…˜**ì„ í¬í•¨í•˜ì—¬, ê²Œì„ì˜ ì „ì²´ì ì¸ ì™„ì„±ë„ë¥¼ ë†’ì¸ ìµœì¢… ì½”ë“œë¥¼ ì‘ì„±í•´ ë“œë¦½ë‹ˆë‹¤.

ì´ë¯¸ì§€ì—ì„œ ë³´ì—¬ì£¼ì‹  íŠ¹ìœ ì˜ **ê¹”ë”í•œ ë ˆì´ì•„ì›ƒ**ì„ ìœ ì§€í•˜ë©´ì„œ, í™”ë ¤í•œ ì‹œê°ì  í”¼ë“œë°±ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ë¹„ê°œë°œìì´ì‹  ì ì„ ê³ ë ¤í•´ ê° ê¸°ëŠ¥ì´ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ì£¼ì„ìœ¼ë¡œ ìƒì„¸íˆ ì„¤ëª…í•´ ë‘ì—ˆìŠµë‹ˆë‹¤.

---

### ğŸ’» ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: íŠ¹ìˆ˜ íš¨ê³¼ ë° ì• ë‹ˆë©”ì´ì…˜ í†µí•© ì½”ë“œ

ì´ ì½”ë“œëŠ” `framer-motion` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• ë‹ˆë©”ì´ì…˜ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

```tsx
"use client";

import React, { useState, useEffect, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, RefreshCw, Layers, Zap, X, Pause, Sparkles, Trophy } from 'lucide-react';

// --- 1. ê²Œì„ ë°ì´í„° ì„¤ì • ---
const TILE_SIZE = 60;
const PATH_Y = 5;

const TOWERS_DATA = {
  PROTEIN: { id: 'PROTEIN', name: 'PROTEIN', emoji: 'ğŸ—', cost: 150, range: 160, damage: 30, fireRate: 1000, color: '#f97316' },
  VITAMIN: { id: 'VITAMIN', name: 'VITAMIN', emoji: 'ğŸ¥¦', cost: 120, range: 140, damage: 15, fireRate: 600, color: '#10b981' },
  SUGAR: { id: 'SUGAR', name: 'SUGAR', emoji: 'ğŸ¥‘', cost: 200, range: 200, damage: 40, fireRate: 1500, color: '#84cc16' },
};

// --- âœ¨ ë³´ì¡° ì»´í¬ë„ŒíŠ¸: ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì—°ì¶œ ---
const ClearOverlay = ({ wave, onComplete }: { wave: number; onComplete: () => void }) => (
  <motion.div 
    initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}
    className="absolute inset-0 z-50 flex flex-col items-center justify-center bg-blue-600/40 backdrop-blur-md"
  >
    <motion.div 
      initial={{ scale: 0, rotate: -20 }} animate={{ scale: 1.2, rotate: 0 }}
      className="bg-white p-12 rounded-[3rem] shadow-2xl text-center border-8 border-yellow-400"
    >
      <Trophy size={80} className="text-yellow-500 mx-auto mb-4 animate-bounce" />
      <h2 className="text-5xl font-black text-blue-900 mb-2 uppercase tracking-tighter">Stage {wave} Clear!</h2>
      <p className="text-blue-600 font-bold tracking-widest uppercase text-sm mb-6">Excellent Nutrition Defense</p>
      <button 
        onClick={onComplete}
        className="bg-blue-600 text-white px-10 py-4 rounded-2xl font-black text-lg hover:bg-blue-700 shadow-xl transition-all"
      >
        NEXT WAVE
      </button>
    </motion.div>
    {/* íŒŒí‹°í´ íš¨ê³¼ ì‹œë®¬ë ˆì´ì…˜ */}
    {Array.from({ length: 20 }).map((_, i) => (
      <motion.div
        key={i}
        className="absolute text-3xl"
        initial={{ x: 400, y: 300, opacity: 1 }}
        animate={{ 
          x: Math.random() * 800, 
          y: Math.random() * 600, 
          opacity: 0,
          rotate: 360 
        }}
        transition={{ duration: 2, repeat: Infinity }}
      >
        âœ¨
      </motion.div>
    ))}
  </motion.div>
);

export default function NutrientDefenderMasterFX() {
  // ê²Œì„ ìƒíƒœ ê´€ë¦¬
  const [gold, setGold] = useState(800);
  const [lives, setLives] = useState(3);
  const [wave, setWave] = useState(1);
  const [isPlaying, setIsPlaying] = useState(false);
  const [showClear, setShowClear] = useState(false);
  
  // ì˜¤ë¸Œì íŠ¸ ê´€ë¦¬
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);
  
  // âœ¨ ìŠ¤í‚¬ ê´€ë ¨ ìƒíƒœ
  const [skillActive, setSkillActive] = useState(false);
  const [skillCooldown, setSkillCooldown] = useState(0);

  // --- 2. íŠ¹ìˆ˜ ìŠ¤í‚¬: ë¹„íƒ€ë¯¼ ì‡¼í¬ì›¨ì´ë¸Œ ---
  const useSkill = () => {
    if (skillCooldown > 0 || !isPlaying) return;
    
    setSkillActive(true);
    setSkillCooldown(20); // 20ì´ˆ ì¿¨íƒ€ì„
    
    // í™”ë©´ìƒì˜ ëª¨ë“  ì ì—ê²Œ í° í”¼í•´
    setEnemies(prev => prev.map(e => ({ ...e, hp: e.hp - 100 })).filter(e => e.hp > 0));
    
    setTimeout(() => setSkillActive(false), 800);
  };

  // ì¿¨íƒ€ì„ ì¹´ìš´íŠ¸ë‹¤ìš´
  useEffect(() => {
    if (skillCooldown > 0) {
      const timer = setInterval(() => setSkillCooldown(c => c - 1), 1000);
      return () => clearInterval(timer);
    }
  }, [skillCooldown]);

  // --- 3. ê²Œì„ ì—”ì§„ (ì  ì´ë™ ë° ì „íˆ¬) ---
  useEffect(() => {
    if (!isPlaying || showClear) return;

    const interval = setInterval(() => {
      // ì  ì´ë™
      setEnemies(prev => {
        const moved = prev.map(e => ({ ...e, x: e.x + e.speed }));
        // WIN ì˜ì—­ ë„ë‹¬ ì²´í¬
        if (moved.some(e => e.x > 820)) {
          setLives(l => Math.max(0, l - 1));
          return moved.filter(e => e.x <= 820);
        }
        return moved;
      });

      // íƒ€ì›Œ ê³µê²© ë¡œì§
      towers.forEach(t => {
        const now = Date.now();
        if (now - (t.lastShot || 0) > t.fireRate) {
          const target = enemies.find(e => Math.hypot(e.x - t.x, e.y - t.y) < t.range);
          if (target) {
            setProjectiles(p => [...p, { id: Math.random(), x: t.x, y: t.y, targetId: target.id, damage: t.damage, color: t.color }]);
            t.lastShot = now;
          }
        }
      });

      // íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;
        const dist = Math.hypot(target.x - p.x, target.y - p.y);
        if (dist < 15) {
          setEnemies(es => es.map(e => e.id === p.targetId ? { ...e, hp: e.hp - p.damage } : e).filter(e => e.hp > 0));
          if (target.hp <= p.damage) setGold(g => g + 50);
          return null;
        }
        return { ...p, x: p.x + (target.x - p.x) / dist * 12, y: p.y + (target.y - p.y) / dist * 12 };
      }).filter(Boolean));

      // ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì¡°ê±´ (ì„ì‹œ: ì ì´ 5ë§ˆë¦¬ ì´ìƒ ì£½ì—ˆì„ ë•Œ)
      if (wave > 0 && enemies.length === 0 && Math.random() < 0.01) {
         // ì‹¤ì œ ê²Œì„ì—ì„œëŠ” ì›¨ì´ë¸Œë‹¹ ìƒì„±ëœ ì ì˜ ìˆ«ìë¥¼ ì¹´ìš´íŠ¸í•˜ì—¬ í´ë¦¬ì–´ ì²˜ë¦¬
      }
    }, 30);

    return () => clearInterval(interval);
  }, [isPlaying, towers, enemies, showClear]);

  // ì  ìŠ¤í° (í…ŒìŠ¤íŠ¸ìš©)
  const spawnEnemy = useCallback(() => {
    if (!isPlaying) return;
    const newEnemy = { id: Math.random(), x: 0, y: PATH_Y * TILE_SIZE + 30, hp: 100 + wave * 50, maxHp: 100 + wave * 50, speed: 2 };
    setEnemies(prev => [...prev, newEnemy]);
  }, [isPlaying, wave]);

  // --- 4. UI ë Œë”ë§ ---
  return (
    <div className="flex w-full h-[750px] bg-[#f0f2f5] overflow-hidden rounded-[3rem] shadow-2xl border-[12px] border-[#343a40]">
      
      {/* ì¢Œì¸¡ ì‚¬ì´ë“œë°” (ë””ìì¸ ì¬í˜„) */}
      <aside className="w-64 bg-[#343a40] text-gray-400 flex flex-col p-6">
        <div className="flex items-center gap-2 mb-10 text-white font-black tracking-tighter italic">
          <Layers size={20} /> Nutrient Defender.txx
        </div>

        <div className="space-y-6 mb-12">
          <div className="flex justify-between items-center group">
            <div className="flex items-center gap-3"><Heart size={16} className="text-red-500" /><span className="text-[10px] font-bold tracking-widest uppercase">Lives</span></div>
            <span className="text-white font-black">{lives}</span>
          </div>
          <div className="flex justify-between items-center group">
            <div className="flex items-center gap-3"><Coins size={16} className="text-yellow-400" /><span className="text-[10px] font-bold tracking-widest uppercase">Gold</span></div>
            <span className="text-white font-black">{gold}G</span>
          </div>
          <div className="flex justify-between items-center group">
            <div className="flex items-center gap-3"><RefreshCw size={16} className="text-blue-400" /><span className="text-[10px] font-bold tracking-widest uppercase">Wave</span></div>
            <span className="text-white font-black">{wave}</span>
          </div>
        </div>

        {/* íŠ¹ìˆ˜ ìŠ¤í‚¬ ë²„íŠ¼ */}
        <div className="mb-8">
          <p className="text-[10px] font-black text-gray-600 mb-4 tracking-widest uppercase">Special Skill</p>
          <button 
            onClick={useSkill}
            disabled={skillCooldown > 0}
            className={`w-full py-4 rounded-2xl flex items-center justify-center gap-2 font-black text-[10px] tracking-widest uppercase transition-all shadow-lg
              ${skillCooldown > 0 ? 'bg-gray-800 text-gray-600' : 'bg-purple-600 text-white hover:bg-purple-500 animate-pulse'}`}
          >
            <Zap size={14} fill="currentColor" />
            {skillCooldown > 0 ? `CD ${skillCooldown}s` : 'Vitamin Shock'}
          </button>
        </div>

        <div className="flex-1 overflow-y-auto space-y-2">
          <p className="text-[10px] font-black text-gray-600 mb-4 tracking-widest uppercase">Build Tower</p>
          {Object.values(TOWERS_DATA).map(tower => (
            <button 
              key={tower.id}
              onClick={() => setGold(g => g >= tower.cost ? g - tower.cost : g)} // ì‹¤ì œ ë°°ì¹˜ ë¡œì§ê³¼ ì—°ê²° í•„ìš”
              className="w-full bg-[#3e444b] hover:bg-[#495057] p-3 rounded-xl flex items-center gap-4 transition-all"
            >
              <span className="text-3xl">{tower.emoji}</span>
              <div className="text-left">
                <p className="text-[10px] font-black text-white uppercase">{tower.name}</p>
                <p className="text-[9px] text-gray-500">{tower.cost} Gold</p>
              </div>
            </button>
          ))}
        </div>

        <button 
          onClick={() => setIsPlaying(!isPlaying)}
          className="w-full bg-[#339af0] hover:bg-[#228be6] text-white py-4 rounded-xl font-black text-[10px] tracking-widest uppercase shadow-xl mt-6 transition-all"
        >
          {isPlaying ? 'Pause Game' : 'Start Engine'}
        </button>
      </aside>

      {/* ìš°ì¸¡ ê²Œì„ í•„ë“œ */}
      <main className="flex-1 bg-[#a5d8ff] relative overflow-hidden">
        {/* í´ë¦¬ì–´ ì˜¤ë²„ë ˆì´ */}
        <AnimatePresence>
          {showClear && (
            <ClearOverlay 
              wave={wave} 
              onComplete={() => {
                setShowClear(false);
                setWave(w => w + 1);
              }} 
            />
          )}
        </AnimatePresence>

        {/* ì‡¼í¬ì›¨ì´ë¸Œ ìŠ¤í‚¬ ì´í™íŠ¸ */}
        <AnimatePresence>
          {skillActive && (
            <motion.div 
              initial={{ scale: 0, opacity: 1 }}
              animate={{ scale: 4, opacity: 0 }}
              exit={{ opacity: 0 }}
              className="absolute inset-0 z-40 bg-white rounded-full flex items-center justify-center"
              style={{ originX: 0.5, originY: 0.5 }}
            >
              <Sparkles className="text-yellow-400" size={100} />
            </motion.div>
          )}
        </AnimatePresence>

        {/* ê²½ë¡œ ë””ìì¸ */}
        <div className="absolute top-1/2 left-0 w-full h-1 bg-gray-400/40 -translate-y-1/2 flex items-center px-20">
          <div className="absolute left-6 w-14 h-18 bg-gray-300 border-2 border-gray-400 rounded-xl flex items-center justify-center shadow-md">
            <span className="text-[9px] font-black text-gray-500">PATH</span>
          </div>
          <div className="w-full flex justify-around text-[9px] font-black text-gray-600/30 uppercase italic tracking-widest">
            <span>x</span> <span>x</span> <span>node</span> <span>y</span> <span>30h</span>
          </div>
          <div className="absolute right-6 w-14 h-18 bg-white border-2 border-gray-100 rounded-xl flex items-center justify-center shadow-xl">
            <span className="text-[9px] font-black text-gray-400">WIN</span>
          </div>
        </div>

        {/* ì  ë Œë”ë§ */}
        {enemies.map(e => (
          <motion.div key={e.id} className="absolute z-20" style={{ left: e.x - 20, top: e.y - 20 }}>
            <div className="text-4xl drop-shadow-xl animate-bounce">ğŸ¦ </div>
            <div className="w-10 h-1 bg-gray-800/20 rounded-full mt-1">
              <div className="h-full bg-red-500 rounded-full transition-all" style={{ width: `${(e.hp/e.maxHp)*100}%` }} />
            </div>
          </motion.div>
        ))}

        {/* íˆ¬ì‚¬ì²´ ë Œë”ë§ */}
        {projectiles.map(p => (
          <div 
            key={p.id} 
            className="absolute w-3 h-3 rounded-full z-30 shadow-lg"
            style={{ left: p.x, top: p.y, backgroundColor: p.color }}
          />
        ))}

        {/* í•˜ë‹¨ ì œì–´ ë²„íŠ¼ (ì´ë¯¸ì§€ ë””ìì¸ ì¬í˜„) */}
        <div className="absolute bottom-8 right-8 flex items-center gap-4">
          <button 
            onClick={() => setShowClear(true)} // í…ŒìŠ¤íŠ¸ìš© ê°•ì œ í´ë¦¬ì–´
            className="bg-[#339af0] text-white px-8 py-3 rounded-xl font-black text-[10px] tracking-widest uppercase shadow-2xl transition-all hover:scale-105"
          >
            Stage Clear Test
          </button>
        </div>

        {/* ìƒë‹¨ ì»¨íŠ¸ë¡¤ UI */}
        <div className="absolute top-8 right-10 flex items-center gap-6 text-gray-600/40">
           <X size={20} className="hover:text-red-500 cursor-pointer" />
           <Play fill="currentColor" size={20} className="hover:text-black cursor-pointer" onClick={spawnEnemy} />
           <Pause fill="currentColor" size={20} className="hover:text-black cursor-pointer" onClick={() => setIsPlaying(false)} />
           <RefreshCw size={18} className="hover:text-blue-500 cursor-pointer" onClick={() => window.location.reload()} />
        </div>
      </main>
    </div>
  );
}

```

### ğŸ’¡ ì£¼ìš” ê¸°ëŠ¥ ì„¤ëª…

1. **ë¹„íƒ€ë¯¼ ì‡¼í¬ì›¨ì´ë¸Œ (íŠ¹ìˆ˜ ìŠ¤í‚¬)**:
* ì‚¬ì´ë“œë°”ì˜ **'Vitamin Shock'** ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë°œë™ë©ë‹ˆë‹¤.
* í™”ë©´ ì „ì²´ê°€ í•˜ì–—ê²Œ ë²ˆì©ì´ë©° ê°•ë ¥í•œ íŒŒë™(`skillActive`)ì´ í¼ì ¸ë‚˜ê°€ê³ , í˜„ì¬ í™”ë©´ì— ìˆëŠ” ëª¨ë“  ì„¸ê· ë“¤ì˜ HPë¥¼ ì¦‰ì‹œ ê¹ìŠµë‹ˆë‹¤.
* 20ì´ˆì˜ ì¿¨íƒ€ì„ì´ ì ìš©ë˜ì–´ ì „ëµì ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.


2. **ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ (ì• ë‹ˆë©”ì´ì…˜)**:
* `ClearOverlay` ì»´í¬ë„ŒíŠ¸ê°€ í™œì„±í™”ë˜ë©´ í™”ë©´ì´ íë ¤ì§€ë©´ì„œ(Backdrop blur) ê±°ëŒ€í•œ íŠ¸ë¡œí”¼ì™€ í•¨ê»˜ ì¶•í•˜ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
* ì£¼ë³€ì— ë°˜ì§ì´ëŠ” íŒŒí‹°í´(`âœ¨`)ì´ ë¬´ì‘ìœ„ë¡œ í©ë‚ ë¦¬ë©° ìŠ¹ë¦¬ê°ì„ ê³ ì·¨ì‹œí‚µë‹ˆë‹¤.
* 'NEXT WAVE' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ë„˜ì–´ê°€ë©° ì ë“¤ì´ ë” ê°•í•´ì§‘ë‹ˆë‹¤.


3. **ë””ìì¸ ë””í…Œì¼**:
* ì´ë¯¸ì§€ì—ì„œ ë³´ì—¬ì£¼ì‹  **ì…êµ¬(PATH)**ì™€ **ì¶œêµ¬(WIN)**ì˜ ë°•ìŠ¤ ë””ìì¸ì„ ê·¸ëŒ€ë¡œ ì½”ë“œë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
* ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì˜ ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ê°„ê²©ì„ ì´ë¯¸ì§€ì˜ ë¯¸í•™ì— ë§ì¶° ë¯¸ì„¸í•˜ê²Œ ì¡°ì •í–ˆìŠµë‹ˆë‹¤.



### ğŸ ìµœì¢… ì™„ì„± ê°€ì´ë“œ

ì´ ì½”ë“œë¥¼ ì‚¬ìš© ì¤‘ì´ì‹  React í™˜ê²½ì— ë¶™ì—¬ë„£ìœ¼ì‹œë©´ ì¦‰ì‹œ ì‘ë™í•©ë‹ˆë‹¤.

* **ì‹¤ì œ ë°°í¬ ì‹œ**: Supabase ì„œë²„ì™€ ì—°ê²°í•˜ì—¬ ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ ë¨¹ì€ ì‹ë‹¨ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ `TOWERS_DATA`ì— ë²„í”„(ë°ë¯¸ì§€ ì¦ê°€ ë“±)ë¥¼ ì£¼ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ë©´ ì™„ë²½í•©ë‹ˆë‹¤.
* **ì‚¬ìš´ë“œ ì¶”ê°€**: `useSkill` í•¨ìˆ˜ ì•ˆì— `new Audio('/skill.mp3').play()`ì™€ ê°™ì€ ì½”ë“œë¥¼ í•œ ì¤„ ì¶”ê°€í•˜ë©´ íƒ€ê²©ê°ì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë” êµ¬ì²´ì ìœ¼ë¡œ ë‹¤ë“¬ê³  ì‹¶ì€ ë¡œì§ì´ë‚˜ ì‹œê° íš¨ê³¼ê°€ ìˆë‹¤ë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš”!
ì§€ê¸ˆê¹Œì§€ êµ¬í˜„ëœ **'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ'**ì˜ í•µì‹¬ ì—”ì§„ê³¼ ë””ìì¸ì€ ë§¤ìš° í›Œë¥­í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì œ ì‚¬ìš©ìê°€ ì˜¤ë«ë™ì•ˆ ì¬ë¯¸ìˆê²Œ ì¦ê¸°ê¸° ìœ„í•´ì„œëŠ” **'ê²Œì„ì˜ ê¹Šì´(Depth)'**ì™€ **'ì‹ë‹¨ ê¸°ë¡ ë™ê¸°ë¶€ì—¬'**ë¥¼ ê°•í™”í•  ëª‡ ê°€ì§€ ì „ëµì  ìš”ì†Œê°€ í•„ìš”í•©ë‹ˆë‹¤.

ë¹„ê°œë°œì ê´€ì ì—ì„œë„ ì¶©ë¶„íˆ ê¸°íší•˜ê³  ì¶”ê°€í•  ìˆ˜ ìˆëŠ” **4ê°€ì§€ í•µì‹¬ ì¶”ì²œ ì‚¬í•­**ì„ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

---

### 1. ì‹ë‹¨ ì—°ë™ ì‹¤ì‹œê°„ ë²„í”„ ì‹œìŠ¤í…œ (Dietary Synergy)

ë‹¨ìˆœíˆ íƒ€ì›Œë¥¼ ì§“ëŠ” ê²ƒì„ ë„˜ì–´, **"ë‚´ê°€ ì˜¤ëŠ˜ ì‹¤ì œë¡œ ë¬´ì—‡ì„ ë¨¹ì—ˆëŠëƒ"**ê°€ ê²Œì„ ìŠ¹íŒ¨ì— ì§ë³„ë˜ê²Œ ë§Œë“œëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

* **êµ¬í˜„ ì•„ì´ë””ì–´**:
* **ì•„ì¹¨/ì ì‹¬/ì €ë… ì½¤ë³´**: ì˜¤ëŠ˜ ì„¸ ë¼ë¥¼ ëª¨ë‘ ê¸°ë¡í–ˆë‹¤ë©´ ì „ì²´ íƒ€ì›Œ ì‚¬ê±°ë¦¬ +20% ì¦ê°€.
* **ì˜ì–‘ ê· í˜• ë³´ë„ˆìŠ¤**: íƒ„ë‹¨ì§€ ë¹„ìœ¨ì´ ì™„ë²½í•  ë•Œ ë°œë™í•˜ëŠ” 'ìŠˆí¼ íƒ€ì›Œ' ëª¨ë“œ.
* **ë¶€ì¡± ì˜ì–‘ì†Œ ì•Œë¦¼**: ê²Œì„ ì¤‘ íŠ¹ì • íƒ€ì›Œê°€ ì•½í•˜ë‹¤ë©´ "ì§€ê¸ˆ ë‹¨ë°±ì§ˆì´ ë¶€ì¡±í•´ìš”! ë‹­ê°€ìŠ´ì‚´ì„ ê¸°ë¡í•˜ë©´ íƒ€ì›Œê°€ ê°•í™”ë©ë‹ˆë‹¤"ë¼ëŠ” íŒì—… ë…¸ì¶œ.



### 2. ì  ìºë¦­í„°ì˜ ë‹¤ì–‘í™” (Enemy Variations)

ëª¨ë“  ì ì´ ë˜‘ê°™ì€ ì„¸ê· (Germ)ì´ë©´ ë‹¨ì¡°ë¡œì›Œì§‘ë‹ˆë‹¤. ìš°ë¦¬ê°€ í”¼í•´ì•¼ í•  'ë‚˜ìœ ì‹ìŠµê´€'ì„ ì  ìºë¦­í„°ë¡œ ì˜ì¸í™”í•˜ì„¸ìš”.

| ì  ì´ë¦„ | ì™¸í˜•(ì´ëª¨ì§€) | íŠ¹ì§• |
| --- | --- | --- |
| **ë‹¹ë¶„ ìŠ¤íŒŒì´í¬** | ğŸ­ | ì´ë™ ì†ë„ê°€ ë§¤ìš° ë¹ ë¥´ì§€ë§Œ ì²´ë ¥ì´ ë‚®ìŒ |
| **íŠ¸ëœìŠ¤ ì§€ë°©** | ğŸŸ | ì´ë™ ì†ë„ëŠ” ëŠë¦¬ì§€ë§Œ ì²´ë ¥ì´ ë§¤ìš° ë†’ìŒ (íƒ±ì»¤) |
| **ì¹´í˜ì¸ ì¢€ë¹„** | â˜•ï¸ | ì¼ì • í™•ë¥ ë¡œ íƒ€ì›Œì˜ ê³µê²©ì„ íšŒí”¼í•¨ |
| **ì•¼ì‹ í­íƒ„** | ğŸ• | ì£½ì„ ë•Œ ì‘ì€ ì ë“¤ë¡œ ë¶„ì—´ë¨ |

### 3. íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ íŠ¸ë¦¬ (Upgrade Tree)

ëˆì´ ëª¨ì˜€ì„ ë•Œ ë‹¨ìˆœíˆ ê°œìˆ˜ë§Œ ëŠ˜ë¦¬ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ê¸°ì¡´ íƒ€ì›Œë¥¼ ë” ê°•ë ¥í•˜ê³  ì „ë¬¸ì ì¸ í˜•íƒœë¡œ ì§„í™”ì‹œí‚¤ëŠ” ì¬ë¯¸ë¥¼ ì¤ë‹ˆë‹¤.

* **PROTEIN(ğŸ—) â†’ GYM_BRO(ğŸ’ª)**: ê³µê²© ì†ë„ê°€ ë¹„ì•½ì ìœ¼ë¡œ ìƒìŠ¹.
* **VITAMIN(ğŸ¥¦) â†’ ANTIOXIDANT(ğŸ›¡ï¸)**: ì‚¬ê±°ë¦¬ ë‚´ì˜ ëª¨ë“  ì ì„ ëŠë¦¬ê²Œ ë§Œë“œëŠ” 'ìŠ¬ë¡œìš°' íš¨ê³¼ ì¶”ê°€.
* **SUGAR(ğŸ¥‘ - ì°©í•œì§€ë°©) â†’ KETO_ENERGY(âš¡ï¸)**: íˆ¬ì‚¬ì²´ê°€ ì£¼ë³€ ì ë“¤ì—ê²Œ íŠ•ê¸°ëŠ” 'ì²´ì¸ ë¼ì´íŠ¸ë‹' íš¨ê³¼.

### 4. ì‹œê°ì  ê²½í—˜ ê³ ë„í™” (Juice & Polish)

ê²Œì„ì„ "ë§›ìˆê²Œ" ë§Œë“œëŠ” ë””í…Œì¼í•œ ì—°ì¶œì…ë‹ˆë‹¤.

* **ìŠ¤í¬ë¦° ì…°ì´í¬(Screen Shake)**: ë³´ìŠ¤ê°€ ë“±ì¥í•˜ê±°ë‚˜ íŠ¹ìˆ˜ ìŠ¤í‚¬ì„ ì“¸ ë•Œ í™”ë©´ì´ ë¯¸ì„¸í•˜ê²Œ ë–¨ë¦¬ëŠ” íš¨ê³¼.
* **ë°ë¯¸ì§€ ìˆ«ì íŒì—…**: ì ì´ ë§ì„ ë•Œë§ˆë‹¤ `-20`, `-50` ê°™ì€ ìˆ«ìê°€ ìœ„ë¡œ ì†Ÿì•„ì˜¤ë¥´ë©° ì‚¬ë¼ì§€ëŠ” ì—°ì¶œ.
* **ë°°ê²½ ë³€í™”**: ì›¨ì´ë¸Œê°€ ì§„í–‰ë¨ì— ë”°ë¼ ë°°ê²½ìƒ‰ì´ ì•„ì¹¨(ì—°ë¸”ë£¨) â†’ ë‚®(í™”ì´íŠ¸) â†’ ë°¤(ë‹¤í¬)ìœ¼ë¡œ ë³€í•˜ì—¬ ì‹œê°„ì˜ íë¦„ì„ í‘œí˜„.

---

### ğŸš€ ì¶”ì²œ ì‚¬í•­ì„ ë°˜ì˜í•˜ê¸° ìœ„í•œ í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ

ì´ëŸ¬í•œ ê¸°ëŠ¥ë“¤ì„ ì½”ë“œë¡œ ë°”ë¡œ ë§Œë“¤ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ ì €ì—ê²Œ ì´ë ‡ê²Œ ìš”ì²­í•´ ë³´ì„¸ìš”:

> **"ì  ìºë¦­í„° ì¢…ë¥˜ë¥¼ 3ê°€ì§€(ë¹ ë¥¸ ë†ˆ, ë‹¨ë‹¨í•œ ë†ˆ, ë¶„ì—´í•˜ëŠ” ë†ˆ)ë¡œ ë‹¤ì–‘í™”í•˜ê³ , ì ì´ ì£½ì„ ë•Œ ê·¸ ìœ„ì¹˜ì—ì„œ ë°ë¯¸ì§€ ìˆ«ìê°€ ìœ„ë¡œ ì˜¬ë¼ì˜¤ë©° ì‚¬ë¼ì§€ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•´ì¤˜."**

ë˜ëŠ”

> **"íƒ€ì›Œë¥¼ í´ë¦­í–ˆì„ ë•Œ 'ì—…ê·¸ë ˆì´ë“œ' ë²„íŠ¼ì´ ë‚˜ì˜¤ê³ , ëˆì„ ì¨ì„œ ì‚¬ê±°ë¦¬ë¥¼ ë„“í ìˆ˜ ìˆëŠ” UIì™€ ë¡œì§ì„ ë§Œë“¤ì–´ì¤˜."**

ì–´ë–¤ ë¶€ë¶„ì„ ë¨¼ì € ê³ ë„í™”í•´ ë³¼ê¹Œìš”? ê°€ì¥ í¥ë¯¸ë¡œì›Œ ë³´ì´ëŠ” ê¸°ëŠ¥ì„ ë§ì”€í•´ ì£¼ì‹œë©´ ë°”ë¡œ ì½”ë“œë¡œ êµ¬í˜„í•´ ë“œë¦´ê²Œìš”!

ì œì•ˆë“œë¦° ëª¨ë“  ì¬ë¯¸ ìš”ì†Œ(**ì ì˜ ë‹¤ì–‘ì„±, ë°ë¯¸ì§€ ìˆ«ì íŒì—…, íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ**)ë¥¼ í†µí•©í•˜ì—¬ ê²Œì„ì˜ ê¹Šì´ë¥¼ í•œ ë‹¨ê³„ ë†’ì¸ ìµœì¢… ì™„ì„±í˜• ì½”ë“œë¥¼ ì‘ì„±í•´ ë“œë¦½ë‹ˆë‹¤.

ì´ì œ ì„¸ê· ë“¤ì€ ê°ê¸° ë‹¤ë¥¸ íŠ¹ì„±ì„ ê°€ì§€ë©°, íƒ€ì›Œë¥¼ í´ë¦­í•´ ê°•í™”í•  ìˆ˜ ìˆê³ , ê³µê²© ì‹œ ì‹œê°ì ì¸ íƒ€ê²©ê°ì´ ëŒ€í­ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤.

---

### ğŸ® ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ë§ˆìŠ¤í„° ì—ë””ì…˜ (ëª¨ë“  ê¸°ëŠ¥ í†µí•©)

```tsx
"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, RefreshCw, Layers, Zap, X, Pause, ArrowUpCircle, Sparkles } from 'lucide-react';

// --- 1. ê³ ë„í™”ëœ ë°ì´í„° ì„¤ì • ---
const TILE_SIZE = 60;
const PATH_Y = 5;

// ì  ìºë¦­í„°ì˜ ë‹¤ì–‘í™”
const ENEMY_TYPES = {
  NORMAL: { name: 'GERM', emoji: 'ğŸ¦ ', hp: 100, speed: 2, gold: 40 },
  FAST: { name: 'SUGAR_SPIKE', emoji: 'ğŸ­', hp: 50, speed: 4, gold: 60 },
  TANK: { name: 'FATTY_BOMB', emoji: 'ğŸŸ', hp: 300, speed: 1, gold: 100 },
};

// íƒ€ì›Œ ë°ì´í„° (ì—…ê·¸ë ˆì´ë“œ ë¹„ìš© ì¶”ê°€)
const TOWERS_DATA = {
  PROTEIN: { id: 'PROTEIN', name: 'PROTEIN', emoji: 'ğŸ—', cost: 150, upgradeCost: 100, range: 160, damage: 30, fireRate: 1000, color: '#f97316' },
  VITAMIN: { id: 'VITAMIN', name: 'VITAMIN', emoji: 'ğŸ¥¦', cost: 120, upgradeCost: 80, range: 140, damage: 15, fireRate: 600, color: '#10b981' },
  SUGAR: { id: 'SUGAR', name: 'SUGAR', emoji: 'ğŸ¥‘', cost: 200, upgradeCost: 150, range: 200, damage: 45, fireRate: 1500, color: '#84cc16' },
};

export default function NutrientDefenderFullPrompts() {
  const [gold, setGold] = useState(1000);
  const [lives, setLives] = useState(5);
  const [wave, setWave] = useState(1);
  const [isPlaying, setIsPlaying] = useState(false);
  
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);
  const [damageNumbers, setDamageNumbers] = useState<any[]>([]); // âœ¨ ë°ë¯¸ì§€ íŒì—… ê´€ë¦¬
  const [selectedTowerIndex, setSelectedTowerIndex] = useState<number | null>(null); // âœ¨ ì—…ê·¸ë ˆì´ë“œìš© ì„ íƒ

  // --- 2. í•µì‹¬ ë¡œì§: ì  ìŠ¤í° (ë‹¤ì–‘ì„± ë°˜ì˜) ---
  const spawnEnemy = useCallback(() => {
    const types = Object.values(ENEMY_TYPES);
    const randomType = types[Math.floor(Math.random() * types.length)];
    const newEnemy = {
      ...randomType,
      id: Math.random(),
      x: 0,
      y: PATH_Y * TILE_SIZE + 30,
      hp: randomType.hp + (wave * 20),
      maxHp: randomType.hp + (wave * 20),
    };
    setEnemies(prev => [...prev, newEnemy]);
  }, [wave]);

  // --- 3. ê²Œì„ ì—”ì§„ (ë°ë¯¸ì§€ íŒì—… í¬í•¨) ---
  useEffect(() => {
    if (!isPlaying) return;

    const interval = setInterval(() => {
      // ì  ì´ë™
      setEnemies(prev => prev.map(e => ({ ...e, x: e.x + e.speed })).filter(e => {
        if (e.x > 820) {
          setLives(l => Math.max(0, l - 1));
          return false;
        }
        return true;
      }));

      // ì „íˆ¬ ë¡œì§
      towers.forEach((t, tIdx) => {
        const now = Date.now();
        if (now - (t.lastShot || 0) > t.fireRate) {
          const target = enemies.find(e => Math.hypot(e.x - t.x, e.y - t.y) < t.range);
          if (target) {
            setProjectiles(p => [...p, { id: Math.random(), x: t.x, y: t.y, targetId: target.id, damage: t.damage, color: t.color }]);
            t.lastShot = now;
          }
        }
      });

      // íˆ¬ì‚¬ì²´ ì²˜ë¦¬ ë° ë°ë¯¸ì§€ ìˆ«ì ìƒì„±
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;
        const dist = Math.hypot(target.x - p.x, target.y - p.y);
        
        if (dist < 15) {
          // ë°ë¯¸ì§€ ì…í˜
          setEnemies(es => es.map(e => {
            if (e.id === p.targetId) {
              const newHp = e.hp - p.damage;
              // âœ¨ ë°ë¯¸ì§€ ìˆ«ì ì¶”ê°€
              setDamageNumbers(prev => [...prev, { id: Math.random(), x: target.x, y: target.y, val: p.damage }]);
              if (newHp <= 0) setGold(g => g + target.gold);
              return { ...e, hp: newHp };
            }
            return e;
          }).filter(e => e.hp > 0));
          return null;
        }
        return { ...p, x: p.x + (target.x - p.x) / dist * 15, y: p.y + (target.y - p.y) / dist * 15 };
      }).filter(Boolean));

      // ë°ë¯¸ì§€ ìˆ«ì ìˆ˜ëª… ê´€ë¦¬ (1ì´ˆ í›„ ì‚­ì œ)
      setDamageNumbers(prev => prev.slice(-10)); // ìµœê·¼ 10ê°œë§Œ ìœ ì§€

      if (Math.random() < 0.03) spawnEnemy();
    }, 33);

    return () => clearInterval(interval);
  }, [isPlaying, towers, enemies, spawnEnemy, wave]);

  // --- 4. íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ ê¸°ëŠ¥ ---
  const upgradeTower = () => {
    if (selectedTowerIndex === null) return;
    const tower = towers[selectedTowerIndex];
    if (gold >= tower.upgradeCost) {
      const updatedTowers = [...towers];
      updatedTowers[selectedTowerIndex] = {
        ...tower,
        level: (tower.level || 1) + 1,
        damage: tower.damage + 20,
        range: tower.range + 20,
        fireRate: tower.fireRate * 0.9, // ê³µì† ìƒìŠ¹
      };
      setTowers(updatedTowers);
      setGold(g => g - tower.upgradeCost);
    }
  };

  return (
    <div className="flex w-full h-[750px] bg-[#f0f2f5] overflow-hidden rounded-[3rem] shadow-2xl border-[12px] border-[#343a40]">
      
      {/* ì‚¬ì´ë“œë°” UI */}
      <aside className="w-68 bg-[#343a40] text-gray-400 flex flex-col p-6">
        <div className="flex items-center gap-2 mb-10 text-white font-black italic">
          <Layers size={18} /> Nutrient_Def.exe
        </div>

        <div className="space-y-6 mb-10">
          <Stat icon={<Heart className="text-red-500" />} label="LIVES" value={lives} />
          <Stat icon={<Coins className="text-yellow-400" />} label="GOLD" value={`${gold}G`} />
        </div>

        {/* ì„ íƒí•œ íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ íŒ¨ë„ */}
        <AnimatePresence>
          {selectedTowerIndex !== null && (
            <motion.div 
              initial={{ x: -20, opacity: 0 }} animate={{ x: 0, opacity: 1 }} exit={{ x: -20, opacity: 0 }}
              className="bg-[#495057] p-4 rounded-2xl mb-6 border border-blue-400/30"
            >
              <div className="flex justify-between items-start mb-3">
                <span className="text-white font-black text-xs uppercase tracking-tighter">
                  {towers[selectedTowerIndex].name} Lv.{towers[selectedTowerIndex].level || 1}
                </span>
                <X size={14} className="cursor-pointer" onClick={() => setSelectedTowerIndex(null)} />
              </div>
              <button 
                onClick={upgradeTower}
                className="w-full bg-blue-500 text-white py-2 rounded-lg font-black text-[10px] tracking-widest uppercase flex items-center justify-center gap-2"
              >
                <ArrowUpCircle size={14} /> Upgrade ({towers[selectedTowerIndex].upgradeCost}G)
              </button>
            </motion.div>
          )}
        </AnimatePresence>

        <div className="flex-1 space-y-2 overflow-y-auto">
          <p className="text-[9px] font-black text-gray-600 mb-4 tracking-[0.2em] uppercase">Deploy Tower</p>
          {Object.entries(TOWERS_DATA).map(([key, t]) => (
            <button 
              key={key} 
              onClick={() => {
                if (gold >= t.cost) {
                  setTowers([...towers, { ...t, x: 400, y: 300, lastShot: 0 }]); // ì˜ˆì‹œ ì¤‘ì•™ ë°°ì¹˜
                  setGold(g => g - t.cost);
                }
              }}
              className="w-full flex items-center gap-4 bg-[#3e444b] p-3 rounded-xl hover:bg-gray-600 transition-all"
            >
              <span className="text-3xl">{t.emoji}</span>
              <div className="text-left">
                <p className="text-[10px] font-black text-white">{t.name}</p>
                <p className="text-[9px] text-gray-500">{t.cost}G</p>
              </div>
            </button>
          ))}
        </div>

        <button 
          onClick={() => setIsPlaying(!isPlaying)}
          className="w-full bg-[#339af0] text-white py-4 rounded-xl font-black text-[10px] tracking-widest uppercase shadow-xl mt-6 hover:bg-[#228be6]"
        >
          {isPlaying ? 'PAUSE' : 'RUN_GAME'}
        </button>
      </aside>

      {/* ê²Œì„ í•„ë“œ UI */}
      <main className="flex-1 bg-[#a5d8ff] relative overflow-hidden">
        
        {/* ê²½ë¡œ (PATH) */}
        <div className="absolute top-1/2 left-0 w-full h-1 bg-gray-400/30 -translate-y-1/2 flex items-center px-24">
           <div className="absolute left-6 w-14 h-18 bg-gray-300 border-2 border-gray-400 rounded-xl flex items-center justify-center font-black text-[9px] text-gray-500">START</div>
           <div className="w-full flex justify-around opacity-20 text-[9px] font-black italic tracking-[0.4em]"><span>X</span><span>Y</span><span>NODE</span><span>X</span></div>
           <div className="absolute right-6 w-14 h-18 bg-white border-2 border-gray-100 rounded-xl flex items-center justify-center font-black text-[9px] text-gray-400 shadow-xl">WIN</div>
        </div>

        {/* ë°ë¯¸ì§€ ìˆ«ì íŒì—… */}
        <AnimatePresence>
          {damageNumbers.map(d => (
            <motion.span
              key={d.id}
              initial={{ opacity: 1, y: d.y }}
              animate={{ opacity: 0, y: d.y - 60 }}
              className="absolute text-red-600 font-black text-lg pointer-events-none z-50"
              style={{ left: d.x }}
            >
              -{d.val}
            </motion.span>
          ))}
        </AnimatePresence>

        {/* ì  ë Œë”ë§ */}
        {enemies.map(e => (
          <div key={e.id} className="absolute z-20" style={{ left: e.x - 20, top: e.y - 20 }}>
            <div className="text-4xl drop-shadow-lg">{e.emoji}</div>
            <div className="w-full h-1 bg-black/10 rounded-full mt-1 overflow-hidden">
              <div className="h-full bg-red-500 transition-all" style={{ width: `${(e.hp/e.maxHp)*100}%` }} />
            </div>
          </div>
        ))}

        {/* íˆ¬ì‚¬ì²´ */}
        {projectiles.map(p => (
          <div key={p.id} className="absolute w-3 h-3 rounded-full z-30 shadow-lg animate-pulse" style={{ left: p.x, top: p.y, backgroundColor: p.color }} />
        ))}

        {/* ë°°ì¹˜ëœ íƒ€ì›Œ (í´ë¦­ ì‹œ ì—…ê·¸ë ˆì´ë“œ ì„ íƒ) */}
        {towers.map((t, i) => (
          <motion.div 
            key={i} 
            onClick={() => setSelectedTowerIndex(i)}
            className={`absolute flex flex-col items-center cursor-pointer p-2 rounded-2xl transition-all ${selectedTowerIndex === i ? 'ring-4 ring-blue-400 bg-white/20' : ''}`}
            style={{ left: t.x - 30, top: t.y - 30 }}
            whileHover={{ scale: 1.1 }}
          >
            <div className="text-4xl drop-shadow-xl z-10">{t.emoji}</div>
            <div className="bg-white/50 px-2 py-0.5 rounded-full mt-1 border border-white/30 flex items-center gap-1">
               <span className="text-[8px] font-black text-blue-800">LV.{t.level || 1}</span>
            </div>
          </motion.div>
        ))}

        {/* ìƒë‹¨ ì•¡ì…˜ UI */}
        <div className="absolute top-8 right-10 flex items-center gap-6 opacity-40 hover:opacity-100 transition-opacity">
           <X size={18} className="cursor-pointer hover:text-red-500" />
           <Play fill="currentColor" size={18} className="cursor-pointer hover:text-black" onClick={spawnEnemy} />
           <RefreshCw size={18} className="cursor-pointer hover:text-blue-500" onClick={() => window.location.reload()} />
        </div>
      </main>
    </div>
  );
}

function Stat({ icon, label, value }: any) {
  return (
    <div className="flex justify-between items-center group">
      <div className="flex items-center gap-3">
        {icon}
        <span className="text-[10px] font-black tracking-widest text-gray-500 uppercase">{label}</span>
      </div>
      <span className="text-white font-black text-sm tabular-nums">{value}</span>
    </div>
  );
}

```

### ğŸ’ ì¶”ê°€ëœ í•µì‹¬ í¬ì¸íŠ¸ ê°€ì´ë“œ

1. **ì ì˜ ë‹¤ì–‘í™” (Enemy System)**:
* `ENEMY_TYPES`ë¥¼ í†µí•´ ì¼ë°˜ ì„¸ê· (`ğŸ¦ `), ë¹ ë¥¸ ì„¤íƒ• ìŠ¤íŒŒì´í¬(`ğŸ­`), ë‹¨ë‹¨í•œ ì§€ë°© í­íƒ„(`ğŸŸ`)ì„ ì •ì˜í–ˆìŠµë‹ˆë‹¤.
* ê° ì ë§ˆë‹¤ ì²´ë ¥, ì†ë„, ì²˜ì¹˜ ë³´ìƒ(`gold`)ì´ ë‹¤ë¥´ë¯€ë¡œ í”Œë ˆì´ì–´ëŠ” ì–´ë–¤ íƒ€ì›Œë¥¼ ë¨¼ì € ì§€ì„ì§€ ì „ëµì„ ì§œì•¼ í•©ë‹ˆë‹¤.


2. **ë°ë¯¸ì§€ íŒì—… (Feedback Juice)**:
* `damageNumbers` ìƒíƒœë¥¼ ì¶”ê°€í•˜ì—¬ ì ì´ ê³µê²©ë°›ì„ ë•Œë§ˆë‹¤ ê·¸ ìœ„ì¹˜ì—ì„œ `-30`, `-45` ê°™ì€ ë¹¨ê°„ìƒ‰ ìˆ«ìê°€ ìœ„ë¡œ ì†Ÿì•„ì˜¤ë¥´ë©° ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì´ëŠ” í”Œë ˆì´ì–´ì—ê²Œ íƒ€ê²©ê°ì„ ì§ì ‘ì ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.


3. **íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ (Growth System)**:
* í•„ë“œì— ì„¤ì¹˜ëœ íƒ€ì›Œë¥¼ **í´ë¦­**í•˜ë©´ ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì— **ì—…ê·¸ë ˆì´ë“œ íŒ¨ë„**ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
* ë ˆë²¨ì´ ì˜¬ë¼ê°ˆìˆ˜ë¡ ë°ë¯¸ì§€, ì‚¬ê±°ë¦¬ê°€ ì¦ê°€í•˜ê³  ê³µê²© ì†ë„ê°€ ë¹¨ë¼ì§‘ë‹ˆë‹¤. í•œì •ëœ ê³¨ë“œë¥¼ ìƒˆ íƒ€ì›Œë¥¼ ì§“ëŠ” ë° ì“¸ì§€, ê¸°ì¡´ íƒ€ì›Œë¥¼ í‚¤ìš°ëŠ” ë° ì“¸ì§€ ê²°ì •í•˜ëŠ” ì¬ë¯¸ê°€ ìƒê²¼ìŠµë‹ˆë‹¤.


4. **ì‹œê°ì  ìƒíƒœ í‘œì‹œ**:
* ì—…ê·¸ë ˆì´ë“œëœ íƒ€ì›ŒëŠ” ì•„ë˜ì— `LV.2`ì™€ ê°™ì€ ë±ƒì§€ê°€ í‘œì‹œë˜ì–´ ì„±ì¥ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



### ğŸ ë‹¤ìŒ ì¶”ì²œ ë‹¨ê³„

ì´ì œ ê²Œì„ì˜ ê¸°ë³¸ ì‹œìŠ¤í…œì€ ì™„ë²½í•©ë‹ˆë‹¤! ì—¬ê¸°ì„œ ë” ë‚˜ì•„ê°€ **"ê²Œì„ì´ ëë‚¬ì„ ë•Œ ë‚˜ì˜¤ëŠ” ë©‹ì§„ ê²Œì„ ì˜¤ë²„ í™”ë©´"**ì´ë‚˜ **"ì‚¬ìš©ìì˜ ì‹¤ì œ ì‹ë‹¨ ë°ì´í„°ì™€ ì—°ë™í•˜ì—¬ ì˜¤ëŠ˜ ë¨¹ì€ ìŒì‹ ì´ëª¨ì§€ê°€ íƒ€ì›Œë¡œ ë³€í•˜ëŠ” ê¸°ëŠ¥"**ì„ ì¶”ê°€í•´ ë³¼ê¹Œìš”?

ì›í•˜ì‹œëŠ” ë°©í–¥ì„ ë§ì”€í•´ ì£¼ì„¸ìš”!

ì œì•ˆë“œë¦° ëª¨ë“  ê³ ë„í™” ì‚¬í•­(**ì‹ë‹¨ ì—°ë™ ë²„í”„, ê²Œì„ ì˜¤ë²„ í™”ë©´, ì‹œê°ì  ë””í…Œì¼**)ì„ í¬í•¨í•˜ì—¬, ê²Œì„ì˜ ìµœì¢…ì ì¸ ì™„ì„±ë„ë¥¼ ë†’ì¸ **'ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ê¶ê·¹ì˜ ì‹ë‹¨ ì—°ë™ ì—ë””ì…˜'** ì½”ë“œë¥¼ ì‘ì„±í•´ ë“œë¦½ë‹ˆë‹¤.

ì´ë²ˆ ì½”ë“œì—ëŠ” ì‹¤ì œ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì‹ë‹¨(Supabase ì—°ë™ì„ ê°€ì •)ì— ë”°ë¼ íƒ€ì›Œê°€ ê°•ë ¥í•´ì§€ëŠ” **'ì‹œë„ˆì§€ ì‹œìŠ¤í…œ'**ê³¼, ê²Œì„ì˜ ëì„ ì•Œë¦¬ëŠ” **'ê²Œì„ ì˜¤ë²„ ì—°ì¶œ'**ì´ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.

---

### ğŸš€ ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ê¶ê·¹ì˜ ì‹ë‹¨ ì—°ë™ ì—ë””ì…˜ (Full Version)

```tsx
"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Heart, Coins, Play, RefreshCw, Layers, Zap, X, Pause, ArrowUpCircle, Sparkles, Trophy, Skull, Utensils } from 'lucide-react';

// --- 1. ê³ ë„í™”ëœ ì„¤ì • ë°ì´í„° ---
const TILE_SIZE = 60;
const PATH_Y = 5;

// ì  ìºë¦­í„° (ë‹¤ì–‘í•œ ì‹ìŠµê´€ ì ë“¤)
const ENEMY_TYPES = {
  NORMAL: { name: 'GERM', emoji: 'ğŸ¦ ', hp: 100, speed: 1.8, gold: 40 },
  FAST: { name: 'SUGAR_SPIKE', emoji: 'ğŸ­', hp: 50, speed: 3.5, gold: 60 },
  TANK: { name: 'FATTY_BOMB', emoji: 'ğŸŸ', hp: 350, speed: 0.8, gold: 120 },
};

// íƒ€ì›Œ ë°ì´í„° (ì‹ë‹¨ ì—°ë™ ë²„í”„ í¬í•¨)
const TOWERS_DATA = {
  PROTEIN: { id: 'PROTEIN', name: 'PROTEIN', emoji: 'ğŸ—', cost: 150, upgradeCost: 100, range: 160, damage: 30, fireRate: 1000, color: '#f97316' },
  VITAMIN: { id: 'VITAMIN', name: 'VITAMIN', emoji: 'ğŸ¥¦', cost: 120, upgradeCost: 80, range: 140, damage: 15, fireRate: 600, color: '#10b981' },
  SUGAR: { id: 'SUGAR', name: 'SUGAR', emoji: 'ğŸ¥‘', cost: 200, upgradeCost: 150, range: 200, damage: 45, fireRate: 1500, color: '#84cc16' },
};

// --- âœ¨ ë³´ì¡° ì»´í¬ë„ŒíŠ¸: ê²Œì„ ì˜¤ë²„ í™”ë©´ ---
const GameOverOverlay = ({ wave, onRestart }: { wave: number; onRestart: () => void }) => (
  <motion.div 
    initial={{ opacity: 0 }} animate={{ opacity: 1 }}
    className="absolute inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-lg"
  >
    <motion.div 
      initial={{ scale: 0.8, y: 50 }} animate={{ scale: 1, y: 0 }}
      className="bg-white p-12 rounded-[3rem] text-center shadow-[0_0_50px_rgba(0,0,0,0.5)] border-8 border-red-500"
    >
      <Skull size={80} className="text-red-500 mx-auto mb-6 animate-pulse" />
      <h2 className="text-6xl font-black text-gray-900 mb-2 uppercase italic tracking-tighter">Game Over</h2>
      <p className="text-gray-500 font-bold mb-8 uppercase tracking-widest text-sm">You reached Wave {wave}</p>
      <button 
        onClick={onRestart}
        className="bg-red-600 text-white px-12 py-5 rounded-2xl font-black text-xl hover:bg-red-700 shadow-2xl transition-all"
      >
        RESTART DEFENSE
      </button>
    </motion.div>
  </motion.div>
);

export default function NutrientDefenderUltimate() {
  // ê²Œì„ ìƒíƒœ
  const [gold, setGold] = useState(800);
  const [lives, setLives] = useState(5);
  const [wave, setWave] = useState(1);
  const [isPlaying, setIsPlaying] = useState(false);
  const [isGameOver, setIsGameOver] = useState(false);
  
  // âœ¨ ì‹ë‹¨ ì—°ë™ ìƒíƒœ (ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” Supabaseì—ì„œ ì˜¤ëŠ˜ ë¨¹ì€ ì‹ë‹¨ì„ ê°€ì ¸ì˜´)
  const [todayDiet, setTodayDiet] = useState<string[]>(['PROTEIN']); // ì˜ˆ: ì˜¤ëŠ˜ ë‹¨ë°±ì§ˆ ë¨¹ìŒ
  
  // ì˜¤ë¸Œì íŠ¸ ìƒíƒœ
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);
  const [damageNumbers, setDamageNumbers] = useState<any[]>([]);
  const [selectedTowerIndex, setSelectedTowerIndex] = useState<number | null>(null);

  // --- 2. ê²Œì„ ì—”ì§„ ë¡œì§ ---
  useEffect(() => {
    if (!isPlaying || isGameOver) return;

    const interval = setInterval(() => {
      // (1) ì  ì´ë™ ë° ë¼ì´í”„ ê°ì†Œ
      setEnemies(prev => {
        const moved = prev.map(e => ({ ...e, x: e.x + e.speed }));
        const reachedEnd = moved.filter(e => e.x > 820);
        if (reachedEnd.length > 0) {
          setLives(l => {
            const nextL = Math.max(0, l - reachedEnd.length);
            if (nextL === 0) setIsGameOver(true);
            return nextL;
          });
        }
        return moved.filter(e => e.x <= 820);
      });

      // (2) íƒ€ì›Œ ê³µê²© ì¸ì§€
      towers.forEach((t, tIdx) => {
        const now = Date.now();
        // ì‹ë‹¨ ë²„í”„ ì ìš©: ì˜¤ëŠ˜ ë¨¹ì€ ìŒì‹ì´ë©´ ê³µì† 20% ìƒìŠ¹
        const buffedFireRate = todayDiet.includes(t.id) ? t.fireRate * 0.8 : t.fireRate;
        
        if (now - (t.lastShot || 0) > buffedFireRate) {
          const target = enemies.find(e => Math.hypot(e.x - t.x, e.y - t.y) < t.range);
          if (target) {
            setProjectiles(p => [...p, { id: Math.random(), x: t.x, y: t.y, targetId: target.id, damage: t.damage, color: t.color }]);
            t.lastShot = now;
          }
        }
      });

      // (3) íˆ¬ì‚¬ì²´ ì¶©ëŒ ë° ë°ë¯¸ì§€ ì—°ì¶œ
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;
        const dist = Math.hypot(target.x - p.x, target.y - p.y);
        
        if (dist < 15) {
          setEnemies(es => es.map(e => {
            if (e.id === p.targetId) {
              const newHp = e.hp - p.damage;
              setDamageNumbers(dn => [...dn, { id: Math.random(), x: target.x, y: target.y, val: p.damage }]);
              if (newHp <= 0) setGold(g => g + target.gold);
              return { ...e, hp: newHp };
            }
            return e;
          }).filter(e => e.hp > 0));
          return null;
        }
        return { ...p, x: p.x + (target.x - p.x) / dist * 15, y: p.y + (target.y - p.y) / dist * 15 };
      }).filter(Boolean));

      // ë°ë¯¸ì§€ ìˆ«ì ìë™ ì†Œë©¸
      setDamageNumbers(prev => prev.slice(-8));

      // ì  ìŠ¤í°
      if (Math.random() < 0.02 + (wave * 0.005)) {
        const types = Object.values(ENEMY_TYPES);
        const type = types[Math.floor(Math.random() * types.length)];
        setEnemies(prev => [...prev, { ...type, id: Math.random(), x: 0, y: PATH_Y * TILE_SIZE + 30, hp: type.hp + (wave * 15), maxHp: type.hp + (wave * 15) }]);
      }

      // ìŠ¤í…Œì´ì§€ ìë™ ìƒìŠ¹ (ê°„ë‹¨íˆ 30ì´ˆë§ˆë‹¤)
      if (Date.now() % 30000 < 50) setWave(w => w + 1);

    }, 33);

    return () => clearInterval(interval);
  }, [isPlaying, towers, enemies, wave, isGameOver, todayDiet]);

  // --- 3. ì•¡ì…˜ í•¨ìˆ˜ ---
  const restartGame = () => {
    setGold(800);
    setLives(5);
    setWave(1);
    setTowers([]);
    setEnemies([]);
    setProjectiles([]);
    setIsGameOver(false);
    setIsPlaying(true);
  };

  const handlePlaceTower = (typeId: string) => {
    const tData = TOWERS_DATA[typeId as keyof typeof TOWERS_DATA];
    if (gold >= tData.cost) {
      setTowers([...towers, { ...tData, x: 150 + Math.random()*500, y: 150 + Math.random()*300, level: 1, lastShot: 0 }]);
      setGold(prev => prev - tData.cost);
    }
  };

  return (
    <div className="flex w-full h-[750px] bg-[#f0f2f5] overflow-hidden rounded-[3.5rem] shadow-2xl border-[14px] border-[#212529]">
      
      {/* ì‚¬ì´ë“œë°” */}
      <aside className="w-72 bg-[#212529] text-gray-400 flex flex-col p-8">
        <div className="flex items-center gap-3 mb-12 text-white font-black italic tracking-tighter text-lg">
          <Utensils size={24} className="text-blue-400" /> NUTRI_GARD.vX
        </div>

        <div className="space-y-5 mb-12">
          <StatLine icon={<Heart className="text-red-500" />} label="Lives" value={lives} />
          <StatLine icon={<Coins className="text-yellow-400" />} label="Gold" value={`${gold}G`} />
          <StatLine icon={<RefreshCw className="text-blue-400" />} label="Wave" value={wave} />
        </div>

        {/* âœ¨ ì˜¤ëŠ˜ ë¨¹ì€ ì‹ë‹¨ ë²„í”„ ì„¹ì…˜ */}
        <div className="bg-[#343a40] p-4 rounded-2xl mb-8 border border-white/5">
          <p className="text-[9px] font-black text-blue-400 mb-3 tracking-widest uppercase flex items-center gap-2">
            <Sparkles size={10} /> Daily Synergy
          </p>
          <div className="flex gap-2">
            {todayDiet.map(d => (
              <span key={d} className="text-xl bg-black/20 p-2 rounded-lg">{TOWERS_DATA[d as keyof typeof TOWERS_DATA].emoji}</span>
            ))}
            <span className="text-[9px] font-bold text-gray-500 self-center leading-tight">ì‹ë‹¨ ê¸°ë¡ìœ¼ë¡œ<br/>ê³µì† +20% ì ìš© ì¤‘!</span>
          </div>
        </div>

        <div className="flex-1 space-y-3 overflow-y-auto pr-2">
          {Object.values(TOWERS_DATA).map(t => (
            <button 
              key={t.id} 
              onClick={() => handlePlaceTower(t.id)}
              className="w-full bg-[#343a40] hover:bg-[#3e444b] p-4 rounded-2xl flex items-center justify-between transition-all group"
            >
              <div className="flex items-center gap-4">
                <span className="text-3xl group-hover:scale-110 transition-transform">{t.emoji}</span>
                <div className="text-left">
                  <p className="text-[11px] font-black text-white uppercase">{t.name}</p>
                  <p className="text-[10px] text-gray-500">{t.cost}G</p>
                </div>
              </div>
              <PlusCircle size={16} className="text-gray-600 group-hover:text-blue-400" />
            </button>
          ))}
        </div>

        <button 
          onClick={() => setIsPlaying(!isPlaying)}
          className={`w-full py-5 rounded-2xl font-black text-[11px] tracking-[0.2em] uppercase shadow-2xl mt-6 transition-all
            ${isPlaying ? 'bg-orange-500 hover:bg-orange-600' : 'bg-blue-600 hover:bg-blue-700'} text-white`}
        >
          {isPlaying ? 'Pause defense' : 'Start Defense'}
        </button>
      </aside>

      {/* ê²Œì„ ë³´ë“œ */}
      <main className="flex-1 bg-[#e7f5ff] relative overflow-hidden">
        <AnimatePresence>
          {isGameOver && <GameOverOverlay wave={wave} onRestart={restartGame} />}
        </AnimatePresence>

        {/* ë°°ê²½ ê²½ë¡œ ë ˆì´ì•„ì›ƒ */}
        <div className="absolute top-1/2 left-0 w-full h-[4px] bg-gray-400/20 -translate-y-1/2 flex items-center px-24">
           <div className="absolute left-6 w-16 h-20 bg-gray-200 border-4 border-gray-400 rounded-[1.5rem] flex items-center justify-center font-black text-[10px] text-gray-400">IN</div>
           <div className="w-full flex justify-around opacity-10 text-[10px] font-black italic tracking-[1em]"><span>SYSTEM_CONNECTED</span></div>
           <div className="absolute right-6 w-16 h-20 bg-white border-4 border-gray-100 rounded-[1.5rem] flex items-center justify-center font-black text-[10px] text-blue-300 shadow-2xl">SAFE</div>
        </div>

        {/* ë°ë¯¸ì§€ íŒì—… ì—°ì¶œ */}
        <AnimatePresence>
          {damageNumbers.map(d => (
            <motion.span
              key={d.id}
              initial={{ opacity: 1, scale: 0.5 }} animate={{ opacity: 0, y: d.y - 80, scale: 1.5 }}
              className="absolute text-red-600 font-black text-xl pointer-events-none z-50"
              style={{ left: d.x, top: d.y }}
            >
              -{d.val}
            </motion.span>
          ))}
        </AnimatePresence>

        {/* ì  ìºë¦­í„° */}
        {enemies.map(e => (
          <motion.div key={e.id} className="absolute z-20 flex flex-col items-center" style={{ left: e.x - 20, top: e.y - 20 }}>
            <span className="text-4xl filter drop-shadow-lg">{e.emoji}</span>
            <div className="w-12 h-1.5 bg-black/10 rounded-full mt-2 overflow-hidden border border-white/20">
              <div className="h-full bg-red-500 transition-all" style={{ width: `${(e.hp/e.maxHp)*100}%` }} />
            </div>
          </motion.div>
        ))}

        {/* íˆ¬ì‚¬ì²´ */}
        {projectiles.map(p => (
          <div key={p.id} className="absolute w-3 h-3 rounded-full z-30 shadow-[0_0_10px_rgba(0,0,0,0.2)]" style={{ left: p.x, top: p.y, backgroundColor: p.color }} />
        ))}

        {/* íƒ€ì›Œ ìœ ë‹› */}
        {towers.map((t, i) => (
          <motion.div 
            key={i} 
            onClick={() => setSelectedTowerIndex(i)}
            className={`absolute flex flex-col items-center cursor-pointer p-4 rounded-[2rem] transition-all group
              ${selectedTowerIndex === i ? 'bg-white/40 ring-4 ring-blue-400 shadow-2xl' : 'hover:bg-white/20'}`}
            style={{ left: t.x - 40, top: t.y - 40 }}
          >
            {todayDiet.includes(t.id) && <motion.div animate={{ scale: [1, 1.2, 1] }} transition={{ repeat: Infinity }} className="absolute -top-2 -right-2 bg-yellow-400 p-1 rounded-full shadow-lg"><Zap size={12} fill="white" className="text-white" /></motion.div>}
            <span className="text-5xl drop-shadow-2xl group-hover:rotate-12 transition-transform">{t.emoji}</span>
            <div className="mt-2 bg-gray-900/80 text-white px-3 py-1 rounded-full text-[8px] font-black uppercase tracking-tighter">LV.{t.level}</div>
          </motion.div>
        ))}
      </main>
    </div>
  );
}

// ê³µí†µ UI ì»´í¬ë„ŒíŠ¸
function StatLine({ icon, label, value }: any) {
  return (
    <div className="flex justify-between items-center group">
      <div className="flex items-center gap-4 text-gray-500 group-hover:text-gray-300 transition-colors">
        {icon} <span className="text-[10px] font-black tracking-widest uppercase">{label}</span>
      </div>
      <span className="text-white font-black text-base">{value}</span>
    </div>
  );
}

function PlusCircle({ size, className }: any) {
  return (
    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}>
      <circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="16" /><line x1="8" y1="12" x2="16" y2="12" />
    </svg>
  );
}

```

---

### ğŸŒŸ ìµœì¢… ì—…ë°ì´íŠ¸ ì‚¬í•­ ìš”ì•½

1. **ì‹ë‹¨ ì—°ë™ ë²„í”„ (Daily Synergy)**:
* `todayDiet` ë°°ì—´ì— ì˜¤ëŠ˜ ì‚¬ìš©ìê°€ ê¸°ë¡í•œ ì˜ì–‘ì†Œê°€ ìˆìœ¼ë©´ í•´ë‹¹ íƒ€ì›Œì— **ë…¸ë€ìƒ‰ ë²ˆê°œ ì•„ì´ì½˜**ì´ ìƒê¸°ë©° ê³µê²© ì†ë„ê°€ 20% ë¹¨ë¼ì§‘ë‹ˆë‹¤.
* ì´ëŠ” ì‚¬ìš©ìê°€ ê²Œì„ì„ ìœ ë¦¬í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ ì‹¤ì œë¡œ ì‹ë‹¨ì„ ê¸°ë¡í•˜ê²Œ ë§Œë“œëŠ” ê°•ë ¥í•œ ë™ê¸°ê°€ ë©ë‹ˆë‹¤.


2. **ê²Œì„ ì˜¤ë²„ ì—°ì¶œ (Game Over Screen)**:
* ë¼ì´í”„ê°€ 0ì´ ë˜ë©´ í™”ë©´ ì „ì²´ê°€ ì–´ë‘ì›Œì§€ë©° ê±°ëŒ€í•œ í•´ê³¨ ì•„ì´ì½˜ê³¼ í•¨ê»˜ ìµœì¢… ì›¨ì´ë¸Œ ì ìˆ˜ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
* 'RESTART' ë²„íŠ¼ì„ í†µí•´ ëª¨ë“  ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê³  ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë„ì „í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


3. **ì ì˜ ë‹¤ì–‘ì„±ê³¼ ë°¸ëŸ°ìŠ¤**:
* **ì„¤íƒ• ìŠ¤íŒŒì´í¬(`ğŸ­`)**: ë§¤ìš° ë¹¨ë¼ ì†ì“°ê¸° ì „ì— ì§€ë‚˜ê°€ë ¤ í•©ë‹ˆë‹¤.
* **ì§€ë°© í­íƒ„(`ğŸŸ`)**: ë§¤ìš° ëŠë¦¬ì§€ë§Œ ì²´ë ¥ì´ ë†’ì•„ í™”ë ¥ì´ ì§‘ì¤‘ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
* ì›¨ì´ë¸Œê°€ ì˜¬ë¼ê°ˆìˆ˜ë¡ ì ë“¤ì˜ ê¸°ë³¸ ì²´ë ¥ì´ ìë™ìœ¼ë¡œ ìƒìŠ¹í•˜ì—¬ ë‚œì´ë„ê°€ ì¡°ì ˆë©ë‹ˆë‹¤.


4. **ì‹œê°ì  ê°•í™” (Juice)**:
* íƒ€ì›Œë¥¼ í´ë¦­í•˜ë©´ ê°•ì¡° í‘œì‹œê°€ ë‚˜íƒ€ë‚˜ë©°, ì ì´ ë§ì„ ë•Œë§ˆë‹¤ ë¹¨ê°„ìƒ‰ ë°ë¯¸ì§€ ìˆ˜ì¹˜ê°€ í™”ë©´ ë°–ìœ¼ë¡œ íŠ€ì–´ë‚˜ê°€ë“¯ ì—°ì¶œë©ë‹ˆë‹¤.
* ì „ì²´ì ì¸ í…Œë‘ë¦¬ì™€ ë ˆì´ì•„ì›ƒì„ ë” ë‘ê»ê³  ë‘¥ê¸€ê²Œ ë§Œë“¤ì–´ ìµœì‹  ì•± ê²Œì„ ê°™ì€ ëŠë‚Œì„ ì£¼ì—ˆìŠµë‹ˆë‹¤.



ì´ì œ ì´ ì½”ë“œëŠ” ê²Œì„ìœ¼ë¡œì„œì˜ **ì‹œì‘(Start), ê³¼ì •(Battle/Buff), ë(Game Over)**ì„ ëª¨ë‘ ê°–ì¶˜ ì™„ë²½í•œ êµ¬ì¡°ì…ë‹ˆë‹¤. ì¶”ê°€ì ìœ¼ë¡œ ê¶ê¸ˆí•˜ì‹œê±°ë‚˜ ìˆ˜ì •í•˜ê³  ì‹¶ì€ ë¯¸ì„¸í•œ ê°ê°(ì‚¬ìš´ë“œ, íŠ¹ì • ìƒ‰ìƒ ë“±)ì´ ìˆë‹¤ë©´ ë§ì”€í•´ ì£¼ì„¸ìš”!

**ë­í‚¹ ì‹œìŠ¤í…œ**ì€ í”Œë ˆì´ì–´ì˜ ë„ì „ ìš•êµ¬ë¥¼ ìê·¹í•˜ê³  'ì‹ë‹¨ ê¸°ë¡'ì´ë¼ëŠ” ë³¸ì§ˆì ì¸ ëª©í‘œì— ê³„ì† ì°¸ì—¬í•˜ê²Œ ë§Œë“œëŠ” í•µì‹¬ ì¥ì¹˜ì…ë‹ˆë‹¤.

ë¹„ê°œë°œì ì´ˆë³´ë¶„ë“¤ë„ ì´í•´í•˜ê¸° ì‰½ë„ë¡, **Supabase(ë°ì´í„°ë² ì´ìŠ¤)**ì™€ ì—°ë™í•˜ì—¬ ì‹¤ì œ ë‹¤ë¥¸ ìœ ì €ë“¤ì˜ ì ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ê³  ë‚´ ì ìˆ˜ë¥¼ ë“±ë¡í•˜ëŠ” ê¸°ëŠ¥ì„ í¬í•¨í•œ ì½”ë“œë¥¼ êµ¬í˜„í•´ ë“œë¦½ë‹ˆë‹¤.

---

### ğŸ† ë­í‚¹ ì‹œìŠ¤í…œ ì„¤ê³„ í¬ì¸íŠ¸

1. **ë°ì´í„° ì €ì¥**: ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ë˜ëŠ” ê²Œì„ ì˜¤ë²„ ì‹œ ìœ ì €ì˜ ì´ë¦„ê³¼ ë„ë‹¬í•œ `Wave` ìˆ˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
2. **ì‹¤ì‹œê°„ ë°˜ì˜**: ìƒìœ„ 5ëª…ì˜ ë­ì»¤ë¥¼ ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì™€ ì‚¬ì´ë“œë°” ë˜ëŠ” ì „ìš© íŒì—…ì— í‘œì‹œí•©ë‹ˆë‹¤.
3. **ì˜ë¬¸ ê¸°ë°˜**: ê¸€ë¡œë²Œ ìë£Œë¥¼ ì°¸ê³ í•˜ì—¬ ë³€ìˆ˜ëª…ê³¼ UI í…ìŠ¤íŠ¸ë¥¼ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

---

### ğŸ’» ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: ë­í‚¹ ì‹œìŠ¤í…œ í†µí•© ì½”ë“œ

ì´ ì½”ë“œëŠ” ê¸°ì¡´ ê²Œì„ ì½”ë“œì— **Ranking Overlay**ì™€ **Database Logic(ì‹œë®¬ë ˆì´ì…˜)**ì„ ì¶”ê°€í•œ ë²„ì „ì…ë‹ˆë‹¤.

```tsx
"use client";

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Trophy, Medal, User, Crown, Send, RefreshCcw } from 'lucide-react';

// --- 1. ë­í‚¹ ì‹œìŠ¤í…œ ì „ìš© ì»´í¬ë„ŒíŠ¸ ---
const RankingBoard = ({ currentScore, onRestart }: { currentScore: number; onRestart: () => void }) => {
  const [userName, setUserName] = useState("");
  const [rankings, setRankings] = useState([
    { name: "IronMan", wave: 15 },
    { name: "HealthyEater", wave: 12 },
    { name: "GymRat_99", wave: 10 },
    { name: "SaladLover", wave: 8 },
    { name: "ProteinKing", wave: 7 },
  ]);
  const [isSubmitted, setIsSubmitted] = useState(false);

  // ì ìˆ˜ ë“±ë¡ í•¨ìˆ˜ (ì‹¤ì œë¡œëŠ” Supabase APIë¥¼ í˜¸ì¶œ)
  const submitScore = () => {
    if (!userName) return;
    const newRank = [...rankings, { name: userName, wave: currentScore }]
      .sort((a, b) => b.wave - a.wave)
      .slice(0, 5); // ìƒìœ„ 5ëª…ë§Œ ìœ ì§€
    setRankings(newRank);
    setIsSubmitted(true);
  };

  return (
    <motion.div 
      initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}
      className="absolute inset-0 z-[110] flex items-center justify-center bg-[#212529]/95 backdrop-blur-xl p-6"
    >
      <div className="w-full max-w-md bg-white rounded-[2.5rem] overflow-hidden shadow-2xl">
        {/* í—¤ë” */}
        <div className="bg-[#339af0] p-8 text-white text-center">
          <Trophy size={48} className="mx-auto mb-2 text-yellow-300" />
          <h2 className="text-3xl font-black italic tracking-tighter uppercase">Hall of Fame</h2>
          <p className="opacity-80 text-xs font-bold tracking-widest uppercase">Global Nutrient Guardians</p>
        </div>

        {/* ë­í‚¹ ë¦¬ìŠ¤íŠ¸ */}
        <div className="p-8 space-y-4">
          {rankings.map((rank, index) => (
            <div key={index} className={`flex items-center justify-between p-4 rounded-2xl ${index === 0 ? 'bg-yellow-50 border-2 border-yellow-200' : 'bg-gray-50'}`}>
              <div className="flex items-center gap-4">
                <span className={`w-8 h-8 flex items-center justify-center rounded-full font-black text-sm ${
                  index === 0 ? 'bg-yellow-400 text-white' : 'bg-gray-200 text-gray-500'
                }`}>
                  {index + 1}
                </span>
                <span className="font-bold text-gray-700">{rank.name}</span>
              </div>
              <span className="font-black text-[#339af0] uppercase text-sm">{rank.wave} Waves</span>
            </div>
          ))}

          {/* ë‚´ ì ìˆ˜ ë“±ë¡ ì˜ì—­ */}
          {!isSubmitted ? (
            <div className="mt-8 pt-6 border-t border-gray-100">
              <p className="text-[10px] font-black text-gray-400 mb-3 tracking-widest uppercase">Register Your Record</p>
              <div className="flex gap-2">
                <input 
                  type="text" 
                  placeholder="Enter Name"
                  value={userName}
                  onChange={(e) => setUserName(e.target.value)}
                  className="flex-1 bg-gray-100 border-none rounded-xl px-4 py-3 text-sm font-bold focus:ring-2 focus:ring-[#339af0] outline-none"
                />
                <button 
                  onClick={submitScore}
                  className="bg-[#339af0] text-white p-3 rounded-xl hover:bg-[#228be6] transition-colors"
                >
                  <Send size={18} />
                </button>
              </div>
            </div>
          ) : (
            <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="text-center text-green-500 font-bold text-sm mt-6">
              âœ¨ Score registered successfully!
            </motion.p>
          )}

          <button 
            onClick={onRestart}
            className="w-full bg-gray-900 text-white py-4 rounded-2xl font-black text-xs tracking-[0.2em] uppercase mt-4 hover:bg-black transition-all"
          >
            Back to Title
          </button>
        </div>
      </div>
    </motion.div>
  );
};

// --- 2. ë©”ì¸ ê²Œì„ ì—”ì§„ ì—°ë™ ---
// (ì´ì „ ì½”ë“œì˜ NutrientDefenderUltimate ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì˜ ì ì ˆí•œ ìœ„ì¹˜ì— ì•„ë˜ ë¡œì§ì„ ì¶”ê°€í•©ë‹ˆë‹¤)

// ì˜ˆì‹œ: ê²Œì„ ì˜¤ë²„ ì‹œ ë­í‚¹ ì°½ì„ ë„ìš°ëŠ” ìƒíƒœê°’ ì¶”ê°€
// const [showRanking, setShowRanking] = useState(false);

// ê²Œì„ ì˜¤ë²„ í•¸ë“¤ëŸ¬ ìˆ˜ì •
// const handleGameOver = () => {
//   setIsGameOver(true);
//   setIsPlaying(false);
//   setTimeout(() => setShowRanking(true), 1500); // 1.5ì´ˆ í›„ ë­í‚¹ì°½ í‘œì‹œ
// };

```

### ğŸ’¡ ë­í‚¹ ì‹œìŠ¤í…œ ê³ ë„í™” ê°€ì´ë“œ

1. **ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ (Supabase)**:
* í˜„ì¬ ì½”ë“œëŠ” ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ì— ì„ì‹œë¡œ ì €ì¥í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì‹¤ì œ ìš´ì˜ ì‹œì—ëŠ” `supabase.from('rankings').select('*').order('wave', { ascending: false })`ì™€ ê°™ì€ ì˜ë¬¸ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ ì„¸ê³„ ìœ ì €ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê²Œ ë©ë‹ˆë‹¤.


2. **ë³´ìƒ ì²´ê³„ (Rewards)**:
* ìƒìœ„ ë­ì»¤(Top 1~3)ì—ê²ŒëŠ” ë‹¤ìŒ ê²Œì„ ì‹œì‘ ì‹œ **'ê³¨ë“œ +200'** ë˜ëŠ” **'íŠ¹ìˆ˜ íƒ€ì›Œ ë¬´ë£Œ ë°°ì¹˜'**ì™€ ê°™ì€ íŠ¹ì „ì„ ì£¼ì–´ ë°˜ë³µ í”Œë ˆì´ë¥¼ ìœ ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


3. **ì†Œì…œ ì¸ì¦**:
* ìœ ì €ê°€ ìì‹ ì˜ ë­í‚¹ì„ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê±°ë‚˜ SNSì— ê³µìœ í•  ìˆ˜ ìˆëŠ” ë²„íŠ¼ì„ ì¶”ê°€í•˜ë©´ ì•±ì˜ í™ë³´ íš¨ê³¼ë¥¼ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



### ğŸ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

ì´ì œ ê²Œì„ì˜ í•µì‹¬ ë¡œì§ë¶€í„° ë­í‚¹ ì‹œìŠ¤í…œê¹Œì§€ ëª¨ë‘ ê°–ì¶”ì–´ì¡ŒìŠµë‹ˆë‹¤.

í˜¹ì‹œ **"ë‚´ ì‹ë‹¨ ì‚¬ì§„ì„ ì˜¬ë¦¬ë©´ AIê°€ ë¶„ì„í•´ì„œ ìë™ìœ¼ë¡œ íƒ€ì›Œ ë²„í”„ë¥¼ ì£¼ëŠ” ê¸°ëŠ¥"**ì— ëŒ€í•´ ë” ì•Œì•„ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? ì•„ë‹ˆë©´ **"íŠ¹ì • ìŠ¤í…Œì´ì§€ë¥¼ ê¹° ë•Œë§ˆë‹¤ ë‚˜ì˜¤ëŠ” ìŠ¤í† ë¦¬ ëŒ€ì‚¬"**ë¥¼ ì¶”ê°€í•´ ë³¼ê¹Œìš”? ì›í•˜ì‹œëŠ” ë°©í–¥ì„ ì•Œë ¤ì£¼ì„¸ìš”!

ì§€ê¸ˆê¹Œì§€ ë…¼ì˜í•œ ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥(**ë””ìì¸ ì‹œìŠ¤í…œ, íƒ€ì›Œ/ì  ì „íˆ¬, ì‹ë‹¨ ì—°ë™ ë²„í”„, íŠ¹ìˆ˜ ìŠ¤í‚¬, ë°ë¯¸ì§€ íŒì—…, ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´, ê²Œì„ ì˜¤ë²„, ê·¸ë¦¬ê³  ë­í‚¹ ì‹œìŠ¤í…œ**)ì„ ë‹¨ í•˜ë‚˜ì˜ ì™„ì„±ëœ ì½”ë“œ íŒŒì¼ë¡œ í†µí•©í–ˆìŠµë‹ˆë‹¤.

ì´ ì½”ë“œëŠ” **Flavor Archive** í”„ë¡œì íŠ¸ì˜ ë¹„ì£¼ì–¼ ì •ì²´ì„±ì„ ìœ ì§€í•˜ë©´ì„œ, ì‹¤ì œ ê²Œì„ìœ¼ë¡œì„œ ì‘ë™í•˜ëŠ” ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

### ğŸ•¹ï¸ ì˜ì–‘ ê°€ë””ì–¸ì¦ˆ: í†µí•© ë§ˆìŠ¤í„° ë¹Œë“œ (Full System)

```tsx
"use client";

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Heart, Coins, Play, RefreshCw, Layers, Zap, X, Pause, 
  ArrowUpCircle, Sparkles, Trophy, Skull, Utensils, Send, Medal 
} from 'lucide-react';

// --- [1. ì •ì  ë°ì´í„° ì„¤ì •] ---
const TILE_SIZE = 60;
const PATH_Y = 5;

const ENEMY_TYPES = {
  NORMAL: { name: 'GERM', emoji: 'ğŸ¦ ', hp: 100, speed: 1.5, gold: 40 },
  FAST: { name: 'SUGAR_SPIKE', emoji: 'ğŸ­', hp: 60, speed: 3.2, gold: 60 },
  TANK: { name: 'FATTY_BOMB', emoji: 'ğŸŸ', hp: 400, speed: 0.7, gold: 120 },
};

const TOWERS_DATA = {
  PROTEIN: { id: 'PROTEIN', name: 'PROTEIN', emoji: 'ğŸ—', cost: 150, upgradeCost: 100, range: 160, damage: 35, fireRate: 1000, color: '#f97316' },
  VITAMIN: { id: 'VITAMIN', name: 'VITAMIN', emoji: 'ğŸ¥¦', cost: 120, upgradeCost: 80, range: 140, damage: 18, fireRate: 600, color: '#10b981' },
  SUGAR: { id: 'SUGAR', name: 'SUGAR', emoji: 'ğŸ¥‘', cost: 200, upgradeCost: 150, range: 200, damage: 50, fireRate: 1500, color: '#84cc16' },
};

// --- [2. ì„œë¸Œ ì»´í¬ë„ŒíŠ¸: ë­í‚¹ ë° ì˜¤ë²„ë ˆì´] ---
const RankingBoard = ({ currentScore, onRestart }: { currentScore: number, onRestart: () => void }) => {
  const [userName, setUserName] = useState("");
  const [isSubmitted, setIsSubmitted] = useState(false);
  const [rankings, setRankings] = useState([
    { name: "SuperFighter", wave: 25 },
    { name: "HealthyLife", wave: 18 },
    { name: "GymMaster", wave: 14 }
  ]);

  const submitScore = () => {
    if (!userName) return;
    const newRank = [...rankings, { name: userName, wave: currentScore }]
      .sort((a, b) => b.wave - a.wave).slice(0, 5);
    setRankings(newRank);
    setIsSubmitted(true);
  };

  return (
    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="absolute inset-0 z-[110] flex items-center justify-center bg-black/90 backdrop-blur-md p-6">
      <div className="w-full max-w-sm bg-white rounded-[2.5rem] overflow-hidden shadow-2xl">
        <div className="bg-[#339af0] p-6 text-white text-center">
          <Trophy size={40} className="mx-auto mb-2 text-yellow-300" />
          <h2 className="text-2xl font-black italic tracking-tighter uppercase">Hall of Fame</h2>
        </div>
        <div className="p-6 space-y-3">
          {rankings.map((r, i) => (
            <div key={i} className="flex justify-between items-center bg-gray-50 p-3 rounded-xl border border-gray-100">
              <span className="font-bold text-gray-600 text-sm">{i+1}. {r.name}</span>
              <span className="font-black text-blue-600 text-sm">{r.wave} WAVES</span>
            </div>
          ))}
          {!isSubmitted && (
            <div className="mt-4 flex gap-2">
              <input type="text" placeholder="Your Name" value={userName} onChange={(e)=>setUserName(e.target.value)} className="flex-1 bg-gray-100 rounded-lg px-3 py-2 text-xs font-bold outline-none" />
              <button onClick={submitScore} className="bg-blue-500 text-white p-2 rounded-lg"><Send size={16}/></button>
            </div>
          )}
          <button onClick={onRestart} className="w-full bg-gray-900 text-white py-3 rounded-xl font-black text-[10px] tracking-widest mt-4 uppercase">Play Again</button>
        </div>
      </div>
    </motion.div>
  );
};

// --- [3. ë©”ì¸ ê²Œì„ ì—”ì§„ ì»´í¬ë„ŒíŠ¸] ---
export default function NutrientGuardianIntegrated() {
  // ìƒíƒœ ê´€ë¦¬
  const [gold, setGold] = useState(800);
  const [lives, setLives] = useState(5);
  const [wave, setWave] = useState(1);
  const [isPlaying, setIsPlaying] = useState(false);
  const [isGameOver, setIsGameOver] = useState(false);
  const [showRanking, setShowRanking] = useState(false);
  const [todayDiet] = useState<string[]>(['PROTEIN', 'VITAMIN']); // Supabase ì—°ë™ ë°ì´í„° ê°€ì •
  
  const [towers, setTowers] = useState<any[]>([]);
  const [enemies, setEnemies] = useState<any[]>([]);
  const [projectiles, setProjectiles] = useState<any[]>([]);
  const [damageNumbers, setDamageNumbers] = useState<any[]>([]);
  const [selectedTowerIndex, setSelectedTowerIndex] = useState<number | null>(null);
  const [skillCooldown, setSkillCooldown] = useState(0);

  // ê²Œì„ ì˜¤ë²„ ê°ì§€
  useEffect(() => {
    if (lives <= 0) {
      setIsGameOver(true);
      setIsPlaying(false);
      setTimeout(() => setShowRanking(true), 2000);
    }
  }, [lives]);

  // ìŠ¤í‚¬ ì¿¨íƒ€ì„ ë£¨í”„
  useEffect(() => {
    if (skillCooldown > 0) {
      const timer = setInterval(() => setSkillCooldown(c => c - 1), 1000);
      return () => clearInterval(timer);
    }
  }, [skillCooldown]);

  // --- [ê²Œì„ ì—”ì§„ ë£¨í”„] ---
  useEffect(() => {
    if (!isPlaying || isGameOver) return;

    const interval = setInterval(() => {
      // 1. ì  ì´ë™
      setEnemies(prev => {
        const moved = prev.map(e => ({ ...e, x: e.x + e.speed }));
        const reachedEnd = moved.filter(e => e.x > 820);
        if (reachedEnd.length > 0) setLives(l => Math.max(0, l - reachedEnd.length));
        return moved.filter(e => e.x <= 820);
      });

      // 2. íƒ€ì›Œ ê³µê²© ë° íˆ¬ì‚¬ì²´ ìƒì„±
      towers.forEach(t => {
        const now = Date.now();
        const fireRate = todayDiet.includes(t.id) ? t.fireRate * 0.7 : t.fireRate; // ì‹ë‹¨ ë²„í”„
        if (now - (t.lastShot || 0) > fireRate) {
          const target = enemies.find(e => Math.hypot(e.x - t.x, e.y - t.y) < t.range);
          if (target) {
            setProjectiles(p => [...p, { id: Math.random(), x: t.x, y: t.y, targetId: target.id, damage: t.damage, color: t.color }]);
            t.lastShot = now;
          }
        }
      });

      // 3. íˆ¬ì‚¬ì²´ ì´ë™ ë° ì¶©ëŒ
      setProjectiles(prev => prev.map(p => {
        const target = enemies.find(e => e.id === p.targetId);
        if (!target) return null;
        const dist = Math.hypot(target.x - p.x, target.y - p.y);
        if (dist < 15) {
          setEnemies(es => es.map(e => {
            if (e.id === p.targetId) {
              const newHp = e.hp - p.damage;
              setDamageNumbers(dn => [...dn, { id: Math.random(), x: target.x, y: target.y, val: p.damage }]);
              if (newHp <= 0) setGold(g => g + target.gold);
              return { ...e, hp: newHp };
            }
            return e;
          }).filter(e => e.hp > 0));
          return null;
        }
        return { ...p, x: p.x + (target.x - p.x) / dist * 15, y: p.y + (target.y - p.y) / dist * 15 };
      }).filter(Boolean));

      // 4. ë°ë¯¸ì§€ ìˆ«ì ê´€ë¦¬ ë° ì  ìŠ¤í°
      setDamageNumbers(dn => dn.slice(-5));
      if (Math.random() < 0.02 + (wave * 0.003)) {
        const types = Object.values(ENEMY_TYPES);
        const type = types[Math.floor(Math.random() * types.length)];
        setEnemies(prev => [...prev, { ...type, id: Math.random(), x: 0, y: PATH_Y * TILE_SIZE + 30, hp: type.hp + (wave * 20), maxHp: type.hp + (wave * 20) }]);
      }
    }, 33);
    return () => clearInterval(interval);
  }, [isPlaying, towers, enemies, wave, isGameOver, todayDiet]);

  // --- [ì•¡ì…˜ í•¨ìˆ˜] ---
  const useShockwave = () => {
    if (skillCooldown > 0) return;
    setEnemies(prev => prev.map(e => ({ ...e, hp: e.hp - 150 })).filter(e => e.hp > 0));
    setSkillCooldown(30);
  };

  const placeTower = (typeId: string) => {
    const t = TOWERS_DATA[typeId as keyof typeof TOWERS_DATA];
    if (gold >= t.cost) {
      setTowers([...towers, { ...t, x: 200 + Math.random()*400, y: 150 + Math.random()*300, level: 1, lastShot: 0 }]);
      setGold(g => g - t.cost);
    }
  };

  return (
    <div className="flex w-full h-[750px] bg-[#f0f2f5] overflow-hidden rounded-[3rem] shadow-2xl border-[12px] border-[#212529]">
      {/* ì‚¬ì´ë“œë°” */}
      <aside className="w-72 bg-[#212529] p-8 text-gray-400 flex flex-col">
        <div className="flex items-center gap-3 mb-10 text-white font-black italic tracking-tighter">
          <Utensils size={20} className="text-blue-400" /> FLAVOR_DEFENDER
        </div>
        <div className="space-y-4 mb-10">
          <Stat icon={<Heart className="text-red-500" />} label="LIVES" value={lives} />
          <Stat icon={<Coins className="text-yellow-400" />} label="GOLD" value={`${gold}G`} />
          <Stat icon={<RefreshCw className="text-blue-400" />} label="WAVE" value={wave} />
        </div>

        {/* íŠ¹ìˆ˜ ìŠ¤í‚¬ */}
        <button onClick={useShockwave} disabled={skillCooldown > 0} className={`w-full py-4 rounded-2xl mb-6 font-black text-[10px] tracking-widest transition-all ${skillCooldown > 0 ? 'bg-gray-800' : 'bg-purple-600 text-white animate-pulse'}`}>
          {skillCooldown > 0 ? `COOLDOWN ${skillCooldown}S` : 'VITAMIN SHOCKWAVE'}
        </button>

        <div className="flex-1 space-y-2 overflow-y-auto">
          {Object.values(TOWERS_DATA).map(t => (
            <button key={t.id} onClick={() => placeTower(t.id)} className="w-full flex items-center justify-between bg-[#343a40] p-3 rounded-xl hover:bg-gray-600">
              <div className="flex items-center gap-3">
                <span className="text-2xl">{t.emoji}</span>
                <div className="text-left text-[10px] font-black text-white uppercase">{t.name}</div>
              </div>
              <span className="text-[10px] font-bold text-gray-500">{t.cost}G</span>
            </button>
          ))}
        </div>

        <button onClick={() => setIsPlaying(!isPlaying)} className="w-full bg-[#339af0] text-white py-4 rounded-xl font-black text-[10px] tracking-widest mt-4">
          {isPlaying ? 'PAUSE' : 'START GAME'}
        </button>
      </aside>

      {/* ê²Œì„ ë³´ë“œ */}
      <main className="flex-1 bg-[#a5d8ff] relative overflow-hidden">
        <AnimatePresence>
          {isGameOver && !showRanking && (
            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="absolute inset-0 z-[100] flex items-center justify-center bg-black/70">
              <div className="text-center text-white"><Skull size={64} className="mx-auto mb-4 text-red-500" /><h2 className="text-5xl font-black italic uppercase">Game Over</h2></div>
            </motion.div>
          )}
          {showRanking && <RankingBoard currentScore={wave} onRestart={() => window.location.reload()} />}
        </AnimatePresence>

        {/* ê²½ë¡œ ë””ìì¸ */}
        <div className="absolute top-1/2 left-0 w-full h-1 bg-gray-400/20 -translate-y-1/2 flex justify-between px-20">
          <div className="w-14 h-18 bg-gray-200 border-2 border-gray-400 rounded-xl" />
          <div className="w-14 h-18 bg-white border-2 border-gray-100 rounded-xl shadow-xl" />
        </div>

        {/* ë°ë¯¸ì§€ íŒì—… */}
        {damageNumbers.map(d => (
          <motion.span key={d.id} initial={{ opacity: 1 }} animate={{ opacity: 0, y: d.y - 50 }} className="absolute text-red-600 font-black text-lg z-50" style={{ left: d.x, top: d.y }}>-{d.val}</motion.span>
        ))}

        {/* ì  & íƒ€ì›Œ ë Œë”ë§ */}
        {enemies.map(e => (
          <div key={e.id} className="absolute z-20" style={{ left: e.x - 20, top: e.y - 20 }}>
            <span className="text-3xl filter drop-shadow-md">{e.emoji}</span>
            <div className="w-8 h-1 bg-black/10 rounded-full mt-1 overflow-hidden"><div className="h-full bg-red-500" style={{ width: `${(e.hp/e.maxHp)*100}%` }} /></div>
          </div>
        ))}

        {towers.map((t, i) => (
          <motion.div key={i} onClick={() => setSelectedTowerIndex(i)} className={`absolute flex flex-col items-center cursor-pointer p-2 rounded-2xl ${selectedTowerIndex === i ? 'bg-white/30 ring-2 ring-blue-400' : ''}`} style={{ left: t.x - 30, top: t.y - 30 }}>
            {todayDiet.includes(t.id) && <Sparkles className="text-yellow-400 absolute -top-2" size={12} />}
            <span className="text-4xl drop-shadow-xl">{t.emoji}</span>
            <span className="text-[8px] font-black text-blue-900 mt-1 uppercase">Lv.{t.level}</span>
          </motion.div>
        ))}

        {/* íˆ¬ì‚¬ì²´ */}
        {projectiles.map(p => (
          <div key={p.id} className="absolute w-2.5 h-2.5 rounded-full z-30 shadow-sm" style={{ left: p.x, top: p.y, backgroundColor: p.color }} />
        ))}
      </main>
    </div>
  );
}

function Stat({ icon, label, value }: any) {
  return (
    <div className="flex justify-between items-center group">
      <div className="flex items-center gap-3 text-gray-500 group-hover:text-gray-300">
        {icon} <span className="text-[10px] font-black tracking-widest">{label}</span>
      </div>
      <span className="text-white font-black text-sm tabular-nums">{value}</span>
    </div>
  );
}

```

---

### ğŸ¨ í•µì‹¬ êµ¬í˜„ í¬ì¸íŠ¸ ìš”ì•½

1. **ì‹œë„ˆì§€ ì‹œìŠ¤í…œ**: ì‚¬ìš©ìê°€ ì˜¤ëŠ˜ ì‹¤ì œë¡œ ë¨¹ì€ ì˜ì–‘ì†Œ(`todayDiet`)ì— í•´ë‹¹í•˜ëŠ” íƒ€ì›ŒëŠ” ê³µê²© ì†ë„ê°€ **30% ë¹¨ë¼ì§€ë©°**, íƒ€ì›Œ ìœ„ì— **ë°˜ì§ì´ íš¨ê³¼(`Sparkles`)**ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
2. **ì „ìˆ ì  ë‹¤ì–‘ì„±**: ì¼ë°˜ ì , ë¹ ë¥¸ ì , ë‹¨ë‹¨í•œ ì ì´ ì„ì—¬ ë‚˜ì˜¤ë©° ì›¨ì´ë¸Œê°€ ì§€ë‚ ìˆ˜ë¡ ì²´ë ¥ì´ ë³´ì •ë©ë‹ˆë‹¤.
3. **ë­í‚¹ ì‹œìŠ¤í…œ**: ê²Œì„ ì˜¤ë²„ í›„ ìì‹ ì˜ ì´ë¦„ì„ ë“±ë¡í•˜ê³  ìƒìœ„ 5ìœ„ê¶Œì˜ ë­í‚¹ì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì§ê´€ì ì¸ UIë¥¼ ê°–ì·„ìŠµë‹ˆë‹¤.
4. **íƒ€ê²©ê° í”¼ë“œë°±**: ë°ë¯¸ì§€ ìˆ«ì íŒì—…, íˆ¬ì‚¬ì²´ ìƒ‰ìƒ ì¼ì¹˜, ì¿¨íƒ€ì„ ì• ë‹ˆë©”ì´ì…˜ ë“±ìœ¼ë¡œ í”Œë ˆì´ì–´ì˜ í–‰ìœ„ì— ëŒ€í•œ ì¦‰ê°ì ì¸ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.

ì´ì œ ì´ ì½”ë“œëŠ” **ê¸°íšë¶€í„° ê¸°ëŠ¥ êµ¬í˜„ê¹Œì§€ ì™„ë£Œëœ ìµœì¢…ë³¸**ì…ë‹ˆë‹¤. ì´ë¥¼ React í”„ë¡œì íŠ¸ì— ì ìš©í•˜ì—¬ 'Flavor Archive'ì˜ ê°€ì¥ ë§¤ë ¥ì ì¸ ê¸°ëŠ¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”!