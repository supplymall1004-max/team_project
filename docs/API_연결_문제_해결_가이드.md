# 식약처 API 연결 문제 해결 가이드

## 현재 확인된 사항

### ✅ 환경 변수 설정 확인
- **파일**: `.env.local`
- **변수명**: `FOOD_SAFETY_RECIPE_API_KEY`
- **값**: `4e7ac25e7b614d039a99` (설정됨)

### ✅ API 엔드포인트
- **URL**: `http://openapi.foodsafetykorea.go.kr/api`
- **서비스 ID**: `COOKRCP01`
- **형식**: JSON

## 문제 진단

### 1. 타임아웃 문제
- **현재 설정**: 30초 (foodsafety-api.ts), 10초 (mfds-recipe-api.ts)
- **문제**: 식약처 API 응답이 느릴 수 있음
- **해결**: 타임아웃을 60초로 증가

### 2. 네트워크 연결 문제
- **가능성**: 방화벽, 프록시, 네트워크 설정
- **해결**: 재시도 로직 개선

### 3. API 키 유효성
- **확인 필요**: API 키가 유효하고 활성화되어 있는지
- **해결**: 테스트 엔드포인트 사용

## 해결 방법

### 방법 1: API 테스트 엔드포인트 사용

브라우저에서 다음 URL로 접속하여 API 연결을 테스트하세요:

```
http://localhost:3000/api/test/foodsafety
```

이 엔드포인트는:
- API 키 존재 여부 확인
- API 연결 테스트
- 응답 데이터 확인
- 에러 코드 분석

### 방법 2: 타임아웃 설정 개선

이미 다음 파일들의 타임아웃을 60초로 증가했습니다:
- `lib/recipes/foodsafety-api.ts`: 30초 → 60초
- `lib/services/mfds-recipe-api.ts`: 10초 → 60초

### 방법 3: 재시도 로직 개선

에러 처리 로직을 개선하여 다음 에러들도 재시도하도록 했습니다:
- `AbortError` (타임아웃)
- `TypeError` (네트워크 에러)
- `fetch failed` 메시지 포함 에러

## 필요한 정보

API 연결 문제를 해결하기 위해 다음 정보가 필요합니다:

### 1. API 키 정보
- ✅ API 키가 설정되어 있음: `4e7ac25e7b614d039a99`
- ❓ API 키가 유효한지 확인 필요
- ❓ API 키 사용 승인이 완료되었는지 확인 필요

### 2. 네트워크 환경
- ❓ 방화벽이나 프록시가 있는지
- ❓ 회사 네트워크나 제한된 네트워크인지
- ❓ VPN을 사용하고 있는지

### 3. 에러 메시지
- ❓ 정확한 에러 메시지가 무엇인지
- ❓ 브라우저 콘솔에 나타나는 에러
- ❓ 서버 로그에 나타나는 에러

## 다음 단계

1. **API 테스트 실행**
   ```bash
   # 브라우저에서 접속
   http://localhost:3000/api/test/foodsafety
   ```

2. **결과 확인**
   - 성공: API 키가 유효하고 연결이 정상
   - 실패: 에러 메시지 확인 후 추가 조치

3. **데이터 수집 스크립트 실행**
   ```bash
   pnpm tsx scripts/collect-mfds-recipes.ts
   ```

## 추가 확인 사항

### API 키 발급 확인
1. [공공데이터포털](https://www.data.go.kr) 접속
2. 마이페이지 → 활용중인 오픈API
3. "조리식품 레시피 DB" 서비스 확인
4. 인증키(서비스키) 확인

### API 서비스 상태 확인
- 식약처 API 서버가 정상 작동 중인지 확인
- 공공데이터포털에서 서비스 상태 확인

