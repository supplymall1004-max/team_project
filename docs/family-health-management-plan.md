# 🏥 가족 건강 관리 시스템 구축 계획서

> **작성일**: 2025-01-27  
> **버전**: V1.0  
> **목적**: 건강 관련 API를 활용한 가족 건강 관리 시스템 및 시각화 기능 구현

---

## 📋 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [건강 관련 API 조사 및 정리](#2-건강-관련-api-조사-및-정리)
3. [데이터 활용 계획 및 시각화](#3-데이터-활용-계획-및-시각화)
4. [페르소나 기반 기능 설계](#4-페르소나-기반-기능-설계)
5. [보안 및 인증 계획](#5-보안-및-인증-계획)
6. [필요한 API 키 정리](#6-필요한-api-키-정리)
7. [레이아웃 및 네비게이션 계획](#7-레이아웃-및-네비게이션-계획)
8. [구현 체크리스트](#8-구현-체크리스트)

---

## 1. 프로젝트 개요

### 1.1 목표

가족 구성원의 건강을 통합적으로 관리하고 시각화하여, 건강 상태를 한눈에 파악하고 개선할 수 있는 시스템을 구축합니다.

### 1.2 핵심 가치 제안

- **통합 건강 대시보드**: 가족 구성원의 건강 지표를 한 곳에서 모니터링
- **자동 데이터 수집**: 공공 API 및 건강 앱 연동을 통한 자동 데이터 수집
- **시각화 및 인사이트**: 건강 데이터를 직관적인 차트와 그래프로 제공
- **맞춤형 건강 관리**: 개인별 건강 상태에 맞는 관리 방안 제시

### 1.3 현재 프로젝트 상태

프로젝트에는 이미 다음 기능들이 구현되어 있습니다:

- ✅ 건강정보고속도로 API 연동 (`lib/health/health-highway-client.ts`)
- ✅ 마이데이터 API 연동 (`lib/health/mydata-client.ts`)
- ✅ KCDC 관련 기능 (감염병, 예방접종, 건강검진)
- ✅ 가족 구성원 관리 (`/health/family`)
- ✅ 건강 프로필 관리 (`/health/profile`)
- ✅ 건강 시각화 컴포넌트 일부 (`components/health/visualization/`)

---

## 2. 건강 관련 API 조사 및 정리

### 2.1 현재 연동된 API

#### 2.1.1 건강정보고속도로 API (보건복지부)
- **제공 데이터**:
  - 진료기록 (병원 방문 기록)
  - 건강검진 결과 (혈압, 혈당, 콜레스테롤 등)
  - 투약 정보 (처방전 정보)
  - 예방접종 이력
- **상태**: ✅ 이미 구현됨
- **파일 위치**: `lib/health/health-highway-client.ts`

#### 2.1.2 마이데이터 API (행정안전부)
- **제공 데이터**:
  - 건강보험 정보
  - 병원 방문 기록
  - 약물 복용 기록
  - 건강검진 기록
- **상태**: ✅ 이미 구현됨
- **파일 위치**: `lib/health/mydata-client.ts`

#### 2.1.3 질병관리청(KCDC) API
- **제공 데이터**:
  - 감염병 발생 현황
  - 예방접종 권장 일정
  - 독감 유행 단계
- **상태**: ✅ 이미 구현됨
- **파일 위치**: `lib/kcdc/`

### 2.2 추가 연동 예정 API

#### 2.2.1 영양 정보 API

**공공데이터포털 식품의약품안전처 API**
- **제공 데이터**:
  - 식품 영양 성분 정보
  - 식품 안전 정보
- **무료 티어**: ✅ 완전 무료 (공공데이터)
- **활용 방안**:
  - 식품 영양 정보 조회
  - 식품 안전 정보 제공
- **API 키 필요**: ✅ 예 (공공데이터포털)
- **문서**: https://www.data.go.kr/

**Edamam Nutrition API** (필요 시)
- **제공 데이터**:
  - 음식별 영양소 정보 (칼로리, 탄수화물, 단백질, 지방, 비타민, 미네랄)
  - 영양 분석
  - 레시피 영양 정보
- **무료 티어**: 
  - 일일 10,000회 요청
  - 월 1,000회 영양 분석
- **활용 방안**:
  - 식단 영양소 자동 계산 (공공 API 보완)
  - 영양 균형 분석
  - 부족한 영양소 알림
- **API 키 필요**: ✅ 예 (필요 시 발급)
- **문서**: https://developer.edamam.com/edamam-nutrition-api

#### 2.2.2 운동/활동량 추적 API

**수동 입력 우선** (공공 API 없음)
- **제공 데이터**:
  - 사용자가 직접 입력한 활동량 데이터
  - 걸음 수, 운동 시간, 소모 칼로리
- **무료 티어**: ✅ 완전 무료
- **활용 방안**:
  - 일일 활동량 기록
  - 운동 목표 설정 및 달성률
  - 칼로리 소모량 계산
- **API 키 필요**: ❌ 없음
- **구현 방식**: 사용자 직접 입력 폼 제공

**Google Fit API** (선택적, 필요 시)
- **제공 데이터**:
  - 걸음 수
  - 활동 시간
  - 소모 칼로리
  - 심박수 (기기 지원 시)
- **무료 티어**: ✅ 무료
- **활용 방안**:
  - 자동 활동량 동기화 (선택적)
  - 운동 목표 설정 및 달성률
- **API 키 필요**: ✅ 예 (필요 시 발급)
- **문서**: https://developers.google.com/fit

#### 2.2.3 환경 건강 API

**한국 환경부 대기질 API** (우선)
- **제공 데이터**:
  - 한국 지역별 실시간 대기질 정보
  - 미세먼지, 초미세먼지 농도
  - 대기질 지수 (AQI)
- **무료 티어**: ✅ 무료 (공공데이터)
- **활용 방안**:
  - 한국 지역별 정확한 대기질 정보
  - 실외 활동 권장 여부 판단
  - 호흡기 질환자 알림
  - 마스크 착용 권장
- **API 키 필요**: ✅ 예 (공공데이터포털)
- **문서**: https://www.data.go.kr/

**OpenWeatherMap Air Quality API** (보완용, 필요 시)
- **제공 데이터**:
  - 대기질 지수 (AQI)
  - 미세먼지 (PM2.5, PM10)
  - 오존, 이산화질소 등
- **무료 티어**: 
  - 일일 1,000회 요청
  - 월 1,000,000회 요청
- **활용 방안**:
  - 환경부 API의 보완 데이터
- **API 키 필요**: ✅ 예 (필요 시 발급)
- **문서**: https://openweathermap.org/api/air-pollution

#### 2.2.4 수면 추적 API

**수동 입력 우선** (공공 API 없음)
- **제공 데이터**:
  - 사용자가 직접 입력한 수면 데이터
  - 수면 시간, 취침/기상 시간
- **무료 티어**: ✅ 완전 무료
- **활용 방안**:
  - 수면 패턴 기록
  - 수면 시간 추적
- **API 키 필요**: ❌ 없음
- **구현 방식**: 사용자 직접 입력 폼 제공

**Fitbit API** (선택적, 필요 시)
- **제공 데이터**:
  - 수면 시간
  - 수면 단계 (깊은 수면, 얕은 수면, REM)
  - 수면 품질 점수
- **무료 티어**: 제한적
- **활용 방안**:
  - 수면 패턴 자동 동기화 (선택적)
  - 수면 품질 개선 제안
- **API 키 필요**: ✅ 예 (필요 시 발급)
- **문서**: https://dev.fitbit.com/

#### 2.2.5 공공 건강 데이터 API

**공공데이터포털 건강 관련 API**
- **제공 데이터**:
  - 질병 통계
  - 병원 정보
  - 의약품 정보
  - 건강 검진 통계
- **무료 티어**: ✅ 무료
- **활용 방안**:
  - 지역별 질병 발생률
  - 병원 찾기
  - 의약품 정보 조회
- **API 키 필요**: ✅ 예 (공공데이터포털)
- **문서**: https://www.data.go.kr/

### 2.3 API 데이터 요약표

| API 이름 | 데이터 유형 | 무료 티어 | API 키 필요 | 우선순위 | 상태 |
|---------|-----------|---------|------------|---------|------|
| 건강정보고속도로 | 진료/검진/투약 | ✅ | ✅ | 높음 | ✅ 구현됨 |
| 마이데이터 | 건강보험/병원/약물 | ✅ | ✅ | 높음 | ✅ 구현됨 |
| KCDC | 감염병/예방접종 | ✅ | ✅ | 높음 | ✅ 구현됨 |
| 환경부 대기질 | 대기질 (한국) | ✅ | ✅ | 높음 | ❌ 미구현 |
| 식약처 영양 정보 | 영양 정보 | ✅ | ✅ | 높음 | ❌ 미구현 |
| 수동 입력 (활동량) | 활동량/운동 | ✅ | ❌ | 중간 | ❌ 미구현 |
| 수동 입력 (수면) | 수면 | ✅ | ❌ | 중간 | ❌ 미구현 |
| Edamam Nutrition | 영양 정보 (보완) | ✅ (제한적) | ✅ | 낮음 | ❌ 미구현 (필요 시) |
| Google Fit | 활동량 (자동) | ✅ | ✅ | 낮음 | ❌ 미구현 (선택적) |
| OpenWeatherMap AQ | 대기질 (보완) | ✅ (제한적) | ✅ | 낮음 | ❌ 미구현 (필요 시) |
| Fitbit | 수면 (자동) | 제한적 | ✅ | 낮음 | ❌ 미구현 (선택적) |

---

## 3. 데이터 활용 계획 및 시각화

### 3.1 건강 데이터 통합 대시보드

#### 3.1.1 가족 건강 개요 대시보드
**위치**: `/health/dashboard` (신규 페이지)

**표시 내용**:
- 가족 구성원별 건강 상태 요약 카드
  - 최근 건강검진 결과 요약
  - 현재 복용 중인 약물
  - 예방접종 상태
  - 건강 점수 (0-100)
- 가족 전체 건강 트렌드
  - 체중 변화 추이 (라인 차트)
  - 혈압/혈당 추이 (라인 차트)
  - 활동량 추이 (바 차트)
- 건강 알림 및 권장사항
  - 예방접종 예정일
  - 건강검진 권장일
  - 약물 복용 알림

**시각화 컴포넌트**:
- `components/health/dashboard/family-health-overview.tsx` (신규)
- `components/health/dashboard/health-trends-chart.tsx` (신규)
- `components/health/dashboard/health-alerts-card.tsx` (신규)

#### 3.1.2 개인 건강 상세 대시보드
**위치**: `/health/dashboard/[memberId]` (신규 페이지)

**표시 내용**:
- 건강 지표 카드
  - 체중, 키, BMI
  - 혈압, 혈당, 콜레스테롤
  - 최근 건강검진 결과
- 활동량 및 운동
  - 일일 걸음 수
  - 주간 운동 시간
  - 소모 칼로리
- 영양 섭취 분석
  - 일일 칼로리 섭취량
  - 3대 영양소 비율 (파이 차트)
  - 부족/과다 영양소 알림
- 수면 패턴 (연동 시)
  - 평균 수면 시간
  - 수면 품질 점수
  - 수면 패턴 그래프

**시각화 컴포넌트**:
- `components/health/dashboard/health-metrics-card.tsx` (신규)
- `components/health/dashboard/activity-chart.tsx` (신규)
- `components/health/dashboard/nutrition-chart.tsx` (신규)
- `components/health/dashboard/sleep-chart.tsx` (신규)

### 3.2 건강 지표 시각화

#### 3.2.1 체중/체지방 추이
- **차트 유형**: 라인 차트
- **기간 선택**: 1주, 1개월, 3개월, 6개월, 1년
- **표시 데이터**: 체중, 체지방률, BMI
- **컴포넌트**: `components/health/visualization/weight-trend-chart.tsx` (신규)

#### 3.2.2 혈압/혈당 모니터링
- **차트 유형**: 라인 차트 + 영역 표시 (정상 범위)
- **기간 선택**: 1주, 1개월, 3개월
- **표시 데이터**: 수축기/이완기 혈압, 공복 혈당, 식후 혈당
- **컴포넌트**: `components/health/visualization/blood-pressure-chart.tsx` (신규)

#### 3.2.3 활동량 및 운동
- **차트 유형**: 바 차트 + 도넛 차트
- **기간 선택**: 일, 주, 월
- **표시 데이터**: 걸음 수, 운동 시간, 소모 칼로리, 운동 유형별 분포
- **컴포넌트**: `components/health/visualization/activity-chart.tsx` (신규)

#### 3.2.4 영양소 균형
- **차트 유형**: 파이 차트 + 바 차트
- **기간 선택**: 일, 주
- **표시 데이터**: 
  - 3대 영양소 비율 (탄수화물, 단백질, 지방)
  - 비타민/미네랄 섭취량 vs 권장량
- **컴포넌트**: `components/health/visualization/nutrition-balance-chart.tsx` (기존 확장)

#### 3.2.5 수면 패턴
- **차트 유형**: 스택 바 차트 + 라인 차트
- **기간 선택**: 주, 월
- **표시 데이터**: 
  - 수면 시간 (깊은 수면, 얕은 수면, REM)
  - 수면 품질 점수
  - 취침/기상 시간
- **컴포넌트**: `components/health/visualization/sleep-pattern-chart.tsx` (신규)

#### 3.2.6 건강 점수 종합
- **차트 유형**: 게이지 차트 + 레이더 차트
- **표시 데이터**:
  - 종합 건강 점수 (0-100)
  - 영역별 점수 (운동, 영양, 수면, 검진, 약물 복용)
- **컴포넌트**: `components/health/visualization/health-score-gauge.tsx` (신규)

### 3.3 건강 개선 제안 시스템

#### 3.3.1 AI 기반 건강 인사이트
- **기능**: 건강 데이터 분석을 통한 개인 맞춤 건강 개선 제안
- **제안 유형**:
  - 운동 부족 시 운동 계획 제안
  - 영양소 불균형 시 식단 조정 제안
  - 수면 부족 시 수면 개선 팁
  - 건강검진 결과 이상 시 의사 상담 권장
- **컴포넌트**: `components/health/insights/health-insights-card.tsx` (기존 확장)

#### 3.3.2 목표 설정 및 추적
- **기능**: 개인별 건강 목표 설정 및 달성률 추적
- **목표 유형**:
  - 체중 감량/증량
  - 일일 걸음 수
  - 주간 운동 시간
  - 영양소 섭취 목표
- **컴포넌트**: `components/health/goals/health-goals-card.tsx` (신규)

---

## 4. 페르소나 기반 기능 설계

### 4.1 페르소나 정의

#### 페르소나 1: 가정주부 (30-50대)
**특징**:
- 가족 전체의 건강을 관리하는 역할
- 부모님, 자녀, 본인의 건강을 함께 관리
- 일상적인 건강 관심이 높음
- 스마트폰 사용 능숙

**필요한 기능**:
1. 가족 전체 건강 상태 한눈에 보기
2. 가족 구성원별 건강 알림 관리
3. 가족 맞춤 식단 계획
4. 예방접종/건강검진 일정 관리
5. 건강 정보 및 팁 제공

**대시보드 구성**:
- 가족 건강 개요 대시보드
- 구성원별 건강 상태 카드
- 가족 전체 건강 트렌드
- 예방접종/건강검진 일정 캘린더
- 가족 맞춤 식단 추천

#### 페르소나 2: 시니어 (60대 이상)
**특징**:
- 만성 질환 관리 필요 (당뇨, 고혈압 등)
- 정기적인 약물 복용
- 건강검진 정기 수검
- 스마트폰 사용 능력 다양 (초보자~능숙자)

**필요한 기능**:
1. 약물 복용 알림 (간단하고 명확)
2. 건강검진 결과 요약
3. 혈압/혈당 모니터링
4. 건강 정보 제공 (쉽게 읽을 수 있는 큰 글씨)
5. 가족이 대신 확인할 수 있는 기능

**대시보드 구성**:
- 약물 복용 알림 카드 (큰 글씨, 명확한 시간)
- 혈압/혈당 모니터링 차트
- 건강검진 결과 요약
- 건강 정보 카드 (큰 글씨, 간단한 설명)
- 가족이 확인할 수 있는 공유 기능

#### 페르소나 3: 건강한 가족 구성원 (전 연령대)
**특징**:
- 건강한 가족이 있는 누구나
- 건강 관심도가 높은 사용자
- 본인 및 가족의 건강을 지속적으로 관리하고 싶은 사용자
- 연령대 다양 (청소년~중장년)

**필요한 기능**:
1. 개인 건강 상태 모니터링
2. 활동량 추적 (걸음 수, 운동)
3. 영양 섭취 모니터링
4. 건강 목표 설정 및 달성 추적
5. 건강 개선 제안

**대시보드 구성**:
- 개인 건강 대시보드
- 활동량 차트 (걸음 수, 운동 시간)
- 영양 섭취 차트
- 건강 목표 및 달성률
- 건강 점수 및 개선 제안

### 4.2 페르소나별 기능 우선순위

| 기능 | 가정주부 | 시니어 | 건강한 가족 구성원 |
|------|---------|--------|-----------------|
| 건강 대시보드 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 가족 건강 관리 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| 활동량 추적 | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ |
| 영양 분석 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| 약물 복용 알림 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| 건강검진 관리 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 예방접종 관리 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 건강 개선 제안 | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |

### 4.3 페르소나별 질문 및 답변

**Q1: 가정주부에게 가장 중요한 기능은 무엇인가요?**
- **A**: 가족 전체의 건강 상태를 한 화면에서 볼 수 있는 통합 대시보드가 가장 중요합니다. 각 구성원의 건강 알림, 예방접종/건강검진 일정을 캘린더로 관리하고, 가족 맞춤 식단을 추천하는 기능이 핵심입니다.

**Q2: 시니어에게 약물 복용 알림을 어떻게 명확하게 제공할까요?**
- **A**: 큰 글씨, 명확한 색상, 간단한 메시지로 약물 이름, 복용 시간, 복용량을 표시합니다. 또한 가족이 대신 확인하고 관리할 수 있는 공유 기능을 제공하여 접근성을 높입니다.

**Q3: 건강한 가족 구성원에게 건강 관리를 어떻게 지속적으로 유도할까요?**
- **A**: 건강 목표 설정 및 달성 추적 기능을 제공하고, 건강 점수를 통해 시각적으로 건강 상태를 확인할 수 있도록 합니다. 건강 개선 제안을 통해 지속적인 동기부여를 제공합니다.

---

## 5. 보안 및 인증 계획

### 5.1 Clerk 인증 활용

#### 5.1.1 사용자 인증
- **현재 상태**: ✅ Clerk 인증 이미 구현됨
- **파일 위치**: `middleware.ts`, `app/layout.tsx`
- **추가 작업**: 없음 (기존 구조 활용)

#### 5.1.2 가족 구성원 접근 제어
- **구현 방안**: 
  - 가족 구성원은 본인과 가족 관리자만 접근 가능
  - `family_members` 테이블의 `user_id`로 접근 권한 제어
- **RLS 정책**: Supabase RLS로 데이터 접근 제어
- **구현 위치**: `supabase/migrations/` (마이그레이션 파일)

### 5.2 개인정보 보호

#### 5.2.1 수집 최소화 원칙
- **수집하는 정보**:
  - 건강 지표 (체중, 혈압, 혈당 등)
  - 활동량 데이터
  - 영양 섭취 정보
  - 건강검진 결과
- **수집하지 않는 정보**:
  - 주소, 전화번호 등 개인 식별 정보 (Clerk에만 저장)
  - 민감한 의료 기록 상세 내용 (요약만 저장)

#### 5.2.2 데이터 암호화
- **저장 시 암호화**: Supabase의 기본 암호화 활용
- **전송 시 암호화**: HTTPS 필수
- **민감 데이터**: 건강검진 결과, 질병 기록은 추가 암호화 고려 (향후)

#### 5.2.3 데이터 공유 설정
- **가족 내 공유**: 사용자가 명시적으로 설정한 경우에만 가족 구성원과 공유
- **기본 설정**: 개인 건강 데이터는 본인만 접근 가능
- **공유 설정 UI**: `components/health/settings/privacy-settings.tsx` (신규)

### 5.3 API 키 보안

#### 5.3.1 환경 변수 관리
- **저장 위치**: `.env.local` (로컬), Vercel 환경 변수 (프로덕션)
- **접근 제어**: 서버 사이드에서만 접근 가능
- **키 로테이션**: 정기적인 키 갱신 계획

#### 5.3.2 API 호출 제한
- **Rate Limiting**: 각 API의 무료 티어 제한 내에서 사용
- **에러 처리**: API 호출 실패 시 적절한 에러 메시지 및 재시도 로직

---

## 6. 필요한 API 키 정리

### 6.1 필수 API 키 (우선순위 높음) - 공공 API 위주

#### 6.1.1 공공데이터포털 API 키 (환경부 대기질)
- **용도**: 한국 지역별 실시간 대기질 정보 조회
- **무료 티어**: ✅ 완전 무료 (공공데이터)
- **API 키 발급**: https://www.data.go.kr/
  - 회원가입 → 원하는 API 서비스 신청 → 인증키 발급
- **환경 변수명**: `KOREA_AIR_QUALITY_API_KEY`
- **비용**: 무료

#### 6.1.2 공공데이터포털 API 키 (식품의약품안전처 영양 정보)
- **용도**: 식품 영양 성분 정보 조회
- **무료 티어**: ✅ 완전 무료 (공공데이터)
- **API 키 발급**: https://www.data.go.kr/
  - 식품의약품안전처 API 서비스 신청
- **환경 변수명**: `MFDS_NUTRITION_API_KEY`
- **비용**: 무료

### 6.2 선택적 API 키 (필요 시 발급)

#### 6.2.1 Edamam Nutrition API (공공 API 보완용)
- **용도**: 영양 정보 조회 및 분석 (공공 API 보완)
- **무료 티어**: 일일 10,000회 요청, 월 1,000회 영양 분석
- **API 키 발급**: https://developer.edamam.com/
- **환경 변수명**: `EDAMAM_APP_ID`, `EDAMAM_APP_KEY`
- **비용**: 무료 티어 사용 시 무료
- **발급 시점**: 공공 API로 부족한 경우에만 발급

#### 6.2.2 Google Fit API (자동 동기화용, 선택적)
- **용도**: 활동량 자동 동기화 (선택적 기능)
- **무료 티어**: 무료
- **API 키 발급**: https://console.cloud.google.com/
- **환경 변수명**: `GOOGLE_FIT_CLIENT_ID`, `GOOGLE_FIT_CLIENT_SECRET`
- **비용**: 무료
- **발급 시점**: 사용자가 자동 동기화를 원할 때 발급

### 6.3 API 키 요청 체크리스트 (공공 API 우선)

#### 필수 (공공 API)
- [ ] 공공데이터포털 회원가입
  - [ ] https://www.data.go.kr/ 에서 회원가입
- [ ] 환경부 대기질 API 키 발급
  - [ ] 공공데이터포털에서 "환경부 대기질" API 서비스 신청
  - [ ] 인증키 발급 및 확인
- [ ] 식품의약품안전처 영양 정보 API 키 발급
  - [ ] 공공데이터포털에서 "식약처 영양 정보" API 서비스 신청
  - [ ] 인증키 발급 및 확인

#### 선택적 (필요 시)
- [ ] Edamam Nutrition API 키 발급 (공공 API 보완용)
  - [ ] https://developer.edamam.com/ 에서 계정 생성
  - [ ] Nutrition API 애플리케이션 생성
  - [ ] App ID와 App Key 확인
- [ ] Google Fit API 키 발급 (자동 동기화용)
  - [ ] Google Cloud Console에서 프로젝트 생성
  - [ ] Google Fit API 활성화
  - [ ] OAuth 2.0 클라이언트 ID 생성
  - [ ] Client ID와 Client Secret 확인

### 6.4 환경 변수 설정 파일

`.env.local`에 추가할 환경 변수:

```bash
# 공공데이터포털 API (필수)
KOREA_AIR_QUALITY_API_KEY=your_api_key_here
MFDS_NUTRITION_API_KEY=your_api_key_here

# 선택적 API (필요 시 발급)
# Edamam Nutrition API (공공 API 보완용)
EDAMAM_APP_ID=your_app_id_here
EDAMAM_APP_KEY=your_app_key_here

# Google Fit API (자동 동기화용)
GOOGLE_FIT_CLIENT_ID=your_client_id_here
GOOGLE_FIT_CLIENT_SECRET=your_client_secret_here
```

---

## 7. 레이아웃 및 네비게이션 계획

### 7.1 네비게이션 구조

#### 7.1.1 메인 네비게이션
현재 프로젝트의 네비게이션 구조를 확장하여 건강 관리 섹션을 추가합니다.

**기존 구조**:
```
홈 (/)
레시피 (/recipes)
식단 (/diet)
건강 (/health) ← 기존
설정 (/settings)
```

**확장 구조**:
```
홈 (/)
레시피 (/recipes)
식단 (/diet)
건강 (/health) ← 확장
  ├─ 대시보드 (/health/dashboard) ← 신규
  │   ├─ 가족 건강 개요
  │   └─ 개인 건강 상세 (/health/dashboard/[memberId])
  ├─ 프로필 (/health/profile) ← 기존
  ├─ 가족 관리 (/health/family) ← 기존
  ├─ 건강 기록 (/health/records) ← 신규
  │   ├─ 건강검진 기록
  │   ├─ 약물 복용 기록
  │   └─ 활동량 기록
  ├─ 프리미엄 (/health/premium) ← 기존
  └─ 설정 (/health/settings) ← 신규
```

#### 7.1.2 건강 대시보드 레이아웃

**가족 건강 개요 페이지** (`/health/dashboard`):
```
┌─────────────────────────────────────────┐
│  헤더: "가족 건강 대시보드"              │
├─────────────────────────────────────────┤
│  [가족 구성원 카드 그리드]               │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐        │
│  │ 나  │ │ 아빠│ │ 엄마│ │ 할머니│      │
│  └─────┘ └─────┘ └─────┘ └─────┘        │
├─────────────────────────────────────────┤
│  [가족 전체 건강 트렌드]                 │
│  ┌───────────────────────────────────┐ │
│  │  체중 변화 추이 (라인 차트)        │ │
│  └───────────────────────────────────┘ │
│  ┌───────────────────────────────────┐ │
│  │  활동량 추이 (바 차트)             │ │
│  └───────────────────────────────────┘ │
├─────────────────────────────────────────┤
│  [건강 알림 및 권장사항]                 │
│  - 예방접종 예정일                       │
│  - 건강검진 권장일                       │
│  - 약물 복용 알림                        │
└─────────────────────────────────────────┘
```

**개인 건강 상세 페이지** (`/health/dashboard/[memberId]`):
```
┌─────────────────────────────────────────┐
│  헤더: "[이름]의 건강 대시보드"          │
├─────────────────────────────────────────┤
│  [건강 지표 카드]                        │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐        │
│  │ 체중│ │ 혈압│ │ 혈당│ │ BMI │        │
│  └─────┘ └─────┘ └─────┘ └─────┘        │
├─────────────────────────────────────────┤
│  [활동량 및 운동]                        │
│  ┌───────────────────────────────────┐ │
│  │  일일 걸음 수, 운동 시간          │ │
│  └───────────────────────────────────┘ │
├─────────────────────────────────────────┤
│  [영양 섭취 분석]                        │
│  ┌───────────────────────────────────┐ │
│  │  3대 영양소 비율 (파이 차트)      │ │
│  └───────────────────────────────────┘ │
├─────────────────────────────────────────┤
│  [수면 패턴] (연동 시)                  │
│  ┌───────────────────────────────────┐ │
│  │  수면 시간 및 품질 그래프         │ │
│  └───────────────────────────────────┘ │
├─────────────────────────────────────────┤
│  [건강 개선 제안]                        │
│  - 운동 부족 시 운동 계획 제안          │
│  - 영양소 불균형 시 식단 조정 제안      │
└─────────────────────────────────────────┘
```

### 7.2 컴포넌트 구조

#### 7.2.1 신규 컴포넌트 디렉토리 구조
```
components/health/
├── dashboard/ (신규)
│   ├── family-health-overview.tsx
│   ├── family-member-card.tsx
│   ├── health-trends-chart.tsx
│   ├── health-alerts-card.tsx
│   ├── health-metrics-card.tsx
│   ├── activity-chart.tsx
│   ├── nutrition-chart.tsx
│   └── sleep-chart.tsx
├── visualization/ (기존 확장)
│   ├── weight-trend-chart.tsx (신규)
│   ├── blood-pressure-chart.tsx (신규)
│   ├── activity-chart.tsx (신규)
│   ├── nutrition-balance-chart.tsx (기존 확장)
│   ├── sleep-pattern-chart.tsx (신규)
│   └── health-score-gauge.tsx (신규)
├── insights/ (신규)
│   ├── health-insights-card.tsx (기존 확장)
│   └── health-goals-card.tsx (신규)
├── records/ (신규)
│   ├── health-record-list.tsx
│   ├── medication-reminder-card.tsx
│   └── activity-log-card.tsx
└── settings/ (신규)
    └── privacy-settings.tsx
```

#### 7.2.2 API 라우트 구조
```
app/api/health/
├── dashboard/ (신규)
│   ├── route.ts (가족 건강 개요 데이터)
│   └── [memberId]/route.ts (개인 건강 상세 데이터)
├── activities/ (신규)
│   ├── route.ts (활동량 데이터 조회/저장)
│   └── sync/route.ts (Google Fit 동기화)
├── nutrition/ (신규)
│   ├── analyze/route.ts (영양 분석)
│   └── goals/route.ts (영양 목표 설정)
├── sleep/ (신규)
│   ├── route.ts (수면 데이터 조회/저장)
│   └── sync/route.ts (Fitbit 동기화)
├── air-quality/ (신규)
│   └── route.ts (대기질 정보 조회)
└── goals/ (신규)
    ├── route.ts (건강 목표 조회/설정)
    └── [goalId]/route.ts (목표 상세)
```

### 7.3 반응형 디자인

#### 7.3.1 모바일 우선 설계
- **모바일 (320px~768px)**: 
  - 카드 그리드 1열
  - 차트는 스크롤 가능한 가로 스크롤
  - 간단한 요약 정보 우선 표시
- **태블릿 (768px~1024px)**:
  - 카드 그리드 2열
  - 차트는 반응형 크기 조정
- **데스크톱 (1024px~)**:
  - 카드 그리드 3-4열
  - 전체 차트 표시

#### 7.3.2 접근성 고려
- **큰 글씨 옵션**: 설정에서 글씨 크기 조정 가능
- **색상 대비**: WCAG AA 기준 준수
- **키보드 네비게이션**: 모든 기능 키보드로 접근 가능

---

## 8. 구현 체크리스트

### 8.1 Phase 1: API 연동 및 데이터 수집 (우선순위 높음)

#### 8.1.1 Edamam Nutrition API 연동
- [ ] Edamam API 키 발급 및 환경 변수 설정
- [ ] `lib/health/nutrition/edamam-client.ts` 파일 생성
- [ ] 영양 정보 조회 함수 구현
- [ ] 영양 분석 함수 구현
- [ ] 에러 처리 및 재시도 로직 추가
- [ ] API 호출 제한 관리 (Rate Limiting)

#### 8.1.2 Google Fit API 연동
- [ ] Google Cloud Console 프로젝트 생성
- [ ] Google Fit API 활성화
- [ ] OAuth 2.0 클라이언트 설정
- [ ] `lib/health/activities/google-fit-client.ts` 파일 생성
- [ ] 활동량 데이터 조회 함수 구현
- [ ] 걸음 수, 운동 시간, 소모 칼로리 수집
- [ ] 토큰 갱신 로직 구현
- [ ] 사용자 인증 플로우 구현

#### 8.1.3 OpenWeatherMap Air Quality API 연동
- [ ] OpenWeatherMap API 키 발급 및 환경 변수 설정
- [ ] `lib/health/environment/air-quality-client.ts` 파일 생성
- [ ] 대기질 정보 조회 함수 구현
- [ ] 위치 기반 대기질 조회 (사용자 위치 또는 설정된 지역)
- [ ] 대기질 알림 로직 구현 (나쁨 시 알림)

#### 8.1.4 공공데이터포털 API 연동
- [ ] 공공데이터포털 API 키 발급
- [ ] 환경부 대기질 API 연동
- [ ] `lib/health/environment/korea-air-quality-client.ts` 파일 생성
- [ ] 한국 지역별 대기질 조회 함수 구현

### 8.2 Phase 2: 데이터베이스 스키마 설계

#### 8.2.1 활동량 데이터 테이블
- [ ] `health_activities` 테이블 생성 마이그레이션
  - `id`, `user_id`, `family_member_id`, `date`, `steps`, `exercise_minutes`, `calories_burned`, `activity_type`, `source` (google_fit, manual 등)
- [ ] RLS 정책 설정 (개발 중 비활성화)
- [ ] 인덱스 추가 (user_id, date, family_member_id)

#### 8.2.2 영양 섭취 데이터 테이블
- [ ] `nutrition_logs` 테이블 생성 마이그레이션
  - `id`, `user_id`, `family_member_id`, `date`, `meal_type`, `calories`, `carbohydrates`, `protein`, `fat`, `sodium`, `source`
- [ ] RLS 정책 설정
- [ ] 인덱스 추가

#### 8.2.3 수면 데이터 테이블
- [ ] `sleep_logs` 테이블 생성 마이그레이션
  - `id`, `user_id`, `family_member_id`, `date`, `sleep_duration_minutes`, `sleep_quality_score`, `deep_sleep_minutes`, `light_sleep_minutes`, `rem_sleep_minutes`, `bedtime`, `wake_time`, `source`
- [ ] RLS 정책 설정
- [ ] 인덱스 추가

#### 8.2.4 건강 목표 테이블
- [ ] `health_goals` 테이블 생성 마이그레이션
  - `id`, `user_id`, `family_member_id`, `goal_type` (weight, steps, exercise, nutrition 등), `target_value`, `current_value`, `start_date`, `end_date`, `status`
- [ ] RLS 정책 설정
- [ ] 인덱스 추가

#### 8.2.5 대기질 기록 테이블
- [ ] `air_quality_logs` 테이블 생성 마이그레이션
  - `id`, `user_id`, `location`, `date`, `aqi`, `pm25`, `pm10`, `o3`, `no2`, `source`
- [ ] RLS 정책 설정
- [ ] 인덱스 추가

### 8.3 Phase 3: 대시보드 페이지 구현

#### 8.3.1 가족 건강 개요 페이지
- [ ] `app/(dashboard)/health/dashboard/page.tsx` 파일 생성
- [ ] 가족 구성원 목록 조회 API 구현 (`app/api/health/dashboard/route.ts`)
- [ ] `FamilyHealthOverview` 컴포넌트 구현
- [ ] `FamilyMemberCard` 컴포넌트 구현
- [ ] 가족 전체 건강 트렌드 차트 구현
- [ ] 건강 알림 카드 구현
- [ ] 반응형 레이아웃 적용

#### 8.3.2 개인 건강 상세 페이지
- [ ] `app/(dashboard)/health/dashboard/[memberId]/page.tsx` 파일 생성
- [ ] 개인 건강 데이터 조회 API 구현 (`app/api/health/dashboard/[memberId]/route.ts`)
- [ ] 건강 지표 카드 컴포넌트 구현
- [ ] 활동량 차트 컴포넌트 구현
- [ ] 영양 섭취 차트 컴포넌트 구현
- [ ] 수면 패턴 차트 컴포넌트 구현 (연동 시)
- [ ] 건강 개선 제안 카드 구현

### 8.4 Phase 4: 시각화 컴포넌트 구현

#### 8.4.1 체중/체지방 추이 차트
- [ ] `components/health/visualization/weight-trend-chart.tsx` 파일 생성
- [ ] 라인 차트 구현 (Recharts 또는 Chart.js 사용)
- [ ] 기간 선택 기능 (1주, 1개월, 3개월, 6개월, 1년)
- [ ] 체중, 체지방률, BMI 동시 표시 옵션
- [ ] 반응형 디자인 적용

#### 8.4.2 혈압/혈당 모니터링 차트
- [ ] `components/health/visualization/blood-pressure-chart.tsx` 파일 생성
- [ ] 라인 차트 구현
- [ ] 정상 범위 영역 표시
- [ ] 수축기/이완기 혈압, 공복/식후 혈당 표시
- [ ] 이상 수치 알림 표시

#### 8.4.3 활동량 차트
- [ ] `components/health/visualization/activity-chart.tsx` 파일 생성
- [ ] 바 차트 구현 (일일 활동량)
- [ ] 도넛 차트 구현 (운동 유형별 분포)
- [ ] 걸음 수, 운동 시간, 소모 칼로리 표시
- [ ] 목표 달성률 표시

#### 8.4.4 영양소 균형 차트
- [ ] `components/health/visualization/nutrition-balance-chart.tsx` 파일 확장
- [ ] 파이 차트 구현 (3대 영양소 비율)
- [ ] 바 차트 구현 (비타민/미네랄 섭취량 vs 권장량)
- [ ] 부족/과다 영양소 하이라이트

#### 8.4.5 수면 패턴 차트
- [ ] `components/health/visualization/sleep-pattern-chart.tsx` 파일 생성
- [ ] 스택 바 차트 구현 (수면 단계별 시간)
- [ ] 라인 차트 구현 (수면 품질 점수)
- [ ] 취침/기상 시간 표시
- [ ] 평균 수면 시간 계산 및 표시

#### 8.4.6 건강 점수 게이지
- [ ] `components/health/visualization/health-score-gauge.tsx` 파일 생성
- [ ] 게이지 차트 구현 (종합 건강 점수)
- [ ] 레이더 차트 구현 (영역별 점수)
- [ ] 건강 점수 계산 로직 구현
- [ ] 점수 개선 제안 표시

### 8.5 Phase 5: 건강 기록 관리 기능

#### 8.5.1 활동량 기록
- [ ] `app/(dashboard)/health/records/activities/page.tsx` 파일 생성
- [ ] 활동량 기록 목록 조회 API 구현
- [ ] 활동량 수동 입력 폼 구현
- [ ] Google Fit 동기화 버튼 및 기능 구현
- [ ] 활동량 기록 수정/삭제 기능

#### 8.5.2 영양 섭취 기록
- [ ] `app/(dashboard)/health/records/nutrition/page.tsx` 파일 생성
- [ ] 영양 섭취 기록 목록 조회 API 구현
- [ ] 식사 기록 입력 폼 구현 (Edamam API 연동)
- [ ] 영양 분석 결과 표시
- [ ] 영양 목표 대비 달성률 표시

#### 8.5.3 수면 기록
- [ ] `app/(dashboard)/health/records/sleep/page.tsx` 파일 생성
- [ ] 수면 기록 목록 조회 API 구현
- [ ] 수면 기록 수동 입력 폼 구현
- [ ] Fitbit 동기화 버튼 및 기능 구현 (연동 시)
- [ ] 수면 패턴 분석 및 개선 제안

### 8.6 Phase 6: 건강 목표 및 개선 제안

#### 8.6.1 건강 목표 설정
- [ ] `app/(dashboard)/health/goals/page.tsx` 파일 생성
- [ ] 건강 목표 조회/설정 API 구현
- [ ] 목표 설정 폼 구현 (목표 유형, 목표값, 기간)
- [ ] 목표 달성률 표시
- [ ] 목표 수정/삭제 기능

#### 8.6.2 건강 개선 제안 시스템
- [ ] `components/health/insights/health-insights-card.tsx` 파일 확장
- [ ] 건강 데이터 분석 로직 구현
- [ ] 개인 맞춤 건강 개선 제안 생성
- [ ] 제안 카테고리별 분류 (운동, 영양, 수면, 검진)
- [ ] 제안 상세 페이지 구현

### 8.7 Phase 7: 알림 및 권장사항

#### 8.7.1 약물 복용 알림
- [ ] 약물 복용 알림 컴포넌트 구현 (`components/health/records/medication-reminder-card.tsx`)
- [ ] 알림 시간 설정 기능
- [ ] 알림 발송 로직 구현 (이메일, 푸시 알림)
- [ ] 복용 확인 기능

#### 8.7.2 건강검진/예방접종 알림
- [ ] 기존 KCDC 알림 기능 확장
- [ ] 건강검진 권장일 계산 로직
- [ ] 예방접종 예정일 알림
- [ ] 알림 설정 페이지 구현

#### 8.7.3 대기질 알림
- [ ] 대기질 모니터링 로직 구현
- [ ] 나쁨 수준 시 알림 발송
- [ ] 실외 활동 권장 여부 표시
- [ ] 호흡기 질환자 특별 알림

### 8.8 Phase 8: 설정 및 개인정보 관리

#### 8.8.1 건강 데이터 공유 설정
- [ ] `app/(dashboard)/health/settings/page.tsx` 파일 생성
- [ ] 가족 구성원별 데이터 공유 설정 UI
- [ ] 공유 설정 저장 API 구현
- [ ] 공유 권한 확인 로직

#### 8.8.2 API 연동 설정
- [ ] Google Fit 연동 설정 페이지
- [ ] Fitbit 연동 설정 페이지 (연동 시)
- [ ] 연동 해제 기능
- [ ] 동기화 주기 설정

#### 8.8.3 알림 설정
- [ ] 알림 설정 페이지 구현
- [ ] 알림 유형별 On/Off 설정
- [ ] 알림 시간 설정
- [ ] 알림 방식 선택 (이메일, 푸시)

### 8.9 Phase 9: 테스트 및 최적화

#### 8.9.1 기능 테스트
- [ ] API 연동 테스트
- [ ] 데이터 수집 및 저장 테스트
- [ ] 대시보드 표시 테스트
- [ ] 차트 렌더링 테스트
- [ ] 알림 발송 테스트

#### 8.9.2 성능 최적화
- [ ] API 호출 최적화 (캐싱)
- [ ] 데이터베이스 쿼리 최적화
- [ ] 차트 렌더링 성능 최적화
- [ ] 이미지 최적화

#### 8.9.3 접근성 개선
- [ ] 키보드 네비게이션 테스트
- [ ] 스크린 리더 호환성 테스트
- [ ] 색상 대비 검증
- [ ] 반응형 디자인 테스트

### 8.10 Phase 10: 문서화 및 배포

#### 8.10.1 문서화
- [ ] API 사용 가이드 작성
- [ ] 컴포넌트 사용 가이드 작성
- [ ] 데이터베이스 스키마 문서화
- [ ] 환경 변수 설정 가이드 작성

#### 8.10.2 배포 준비
- [ ] 프로덕션 환경 변수 설정
- [ ] 데이터베이스 마이그레이션 실행
- [ ] API 키 프로덕션 설정
- [ ] 배포 전 최종 테스트

---

## 9. 추가 고려사항

### 9.1 데이터베이스 정리

모든 기능 구현이 완료된 후, 데이터베이스 스키마를 정리하고 최적화하는 작업이 필요합니다. 이는 사용자와 상의하여 진행하겠습니다.

### 9.2 향후 확장 가능성

- **AI 건강 코치**: GPT API를 활용한 개인 맞춤 건강 코칭
- **커뮤니티 기능**: 가족 간 건강 정보 공유 및 경쟁
- **의료진 연동**: 병원 시스템과의 연동 (향후)
- **웨어러블 기기 확장**: Apple Watch, Galaxy Watch 등 추가 기기 지원

### 9.3 법적 고려사항

- **의료법 준수**: 의료 진단 기능은 제공하지 않음
- **개인정보보호법 준수**: 건강 정보는 암호화 저장 및 전송
- **의료기기법**: 건강 앱으로 분류되어 의료기기법 적용 여부 확인 필요

---

## 10. 질문 및 답변

### Q1: 현재 프로젝트에 이미 구현된 건강 기능과 어떻게 통합하나요?

**A**: 기존 건강 기능(`/health/profile`, `/health/family`, `/health/premium`)은 그대로 유지하고, 새로운 대시보드와 시각화 기능을 추가합니다. 기존 데이터를 활용하여 통합 대시보드를 구성합니다.

### Q2: 모든 API를 한 번에 연동해야 하나요?

**A**: 아닙니다. 우선순위에 따라 단계적으로 연동합니다. Phase 1에서는 Edamam Nutrition API와 Google Fit API를 먼저 연동하고, 나머지는 Phase별로 진행합니다.

### Q3: 무료 API 티어로 충분한가요?

**A**: 초기 단계에서는 무료 티어로 충분합니다. 사용자가 늘어나면 유료 플랜으로 전환하거나, API 사용량을 최적화하여 무료 티어 내에서 운영할 수 있습니다.

### Q4: 가족 구성원의 건강 데이터를 어떻게 보호하나요?

**A**: 
- 기본적으로 개인 건강 데이터는 본인만 접근 가능합니다.
- 가족 구성원과 공유하려면 사용자가 명시적으로 설정해야 합니다.
- RLS 정책으로 데이터베이스 레벨에서 접근을 제어합니다.
- 민감한 정보는 암호화하여 저장합니다.

### Q5: 건강 점수는 어떻게 계산하나요?

**A**: 여러 지표를 종합하여 계산합니다:
- 운동량 (30%)
- 영양 균형 (25%)
- 수면 품질 (20%)
- 건강검진 결과 (15%)
- 약물 복용 준수도 (10%)

각 지표는 0-100점으로 정규화하여 가중 평균을 계산합니다.

---

## 11. 다음 단계

1. **API 키 발급**: 필요한 API 키를 발급받아 환경 변수에 설정
2. **데이터베이스 스키마 설계**: Phase 2의 테이블 설계를 구체화
3. **Phase 1 시작**: Edamam Nutrition API와 Google Fit API 연동부터 시작
4. **단계별 구현**: 체크리스트를 따라 단계적으로 기능 구현

---

**문서 작성 완료일**: 2025-01-27  
**다음 검토일**: API 키 발급 후

