# 데이터베이스 마이그레이션 가이드

## 마이그레이션이란?

마이그레이션은 데이터베이스 구조를 변경하는 SQL 스크립트 파일입니다. 예를 들어:
- 테이블에 새 컬럼 추가
- 새 테이블 생성
- 샘플 데이터 삽입

## 필요한 마이그레이션

AI 맞춤 식단 기능을 작동시키기 위해 다음 마이그레이션을 적용해야 합니다:

### 1. 레시피 영양소 컬럼 추가
**파일**: `supabase/migrations/20250130000000_add_recipe_nutrition_columns.sql`

이 마이그레이션은 `recipes` 테이블에 다음 컬럼을 추가합니다:
- `calories` - 칼로리
- `carbohydrates` - 탄수화물 (g)
- `protein` - 단백질 (g)
- `fat` - 지방 (g)
- `sodium` - 나트륨 (mg)

### 2. 샘플 레시피 데이터 추가
**파일**: `supabase/migrations/20250130000001_seed_sample_recipes.sql`

이 마이그레이션은 20개의 샘플 레시피를 데이터베이스에 추가합니다:
- 밥류: 흰쌀밥, 현미밥, 잡곡밥
- 반찬류: 시금치나물, 콩나물무침, 고구마줄기볶음 등
- 국/탕류: 된장국, 미역국, 콩나물국 등
- 찌개류: 김치찌개, 된장찌개, 순두부찌개

## 마이그레이션 적용 방법

### 방법 1: Supabase Dashboard 사용 (권장)

1. Supabase Dashboard에 로그인
2. **SQL Editor** 메뉴로 이동
3. **New query** 클릭
4. 마이그레이션 파일 내용을 복사하여 붙여넣기
5. **Run** 클릭하여 실행
6. 성공 메시지 확인

**주의**: 두 마이그레이션을 순서대로 실행해야 합니다:
1. 먼저 `20250130000000_add_recipe_nutrition_columns.sql` 실행
2. 그 다음 `20250130000001_seed_sample_recipes.sql` 실행

### 방법 2: Supabase CLI 사용 (로컬 개발)

```bash
# Supabase CLI가 설치되어 있어야 합니다
supabase db push
```

## 마이그레이션 적용 확인

마이그레이션이 제대로 적용되었는지 확인하려면:

1. Supabase Dashboard → **Table Editor** → `recipes` 테이블
2. 다음 컬럼들이 있는지 확인:
   - `calories`
   - `carbohydrates`
   - `protein`
   - `fat`
   - `sodium`
3. `recipes` 테이블에 데이터가 있는지 확인 (최소 20개 이상)

## 문제 해결

### 마이그레이션 실행 시 오류 발생

- **"column already exists"**: 이미 컬럼이 존재한다는 의미입니다. 이 경우 해당 마이그레이션은 건너뛰어도 됩니다.
- **"duplicate key value"**: 이미 데이터가 존재한다는 의미입니다. 이 경우 해당 마이그레이션은 건너뛰어도 됩니다.

### 마이그레이션 적용 후에도 식단이 생성되지 않는 경우

1. 브라우저 콘솔을 확인하여 구체적인 에러 메시지 확인
2. 건강 정보가 제대로 입력되어 있는지 확인 (`/health/profile`)
3. `recipes` 테이블에 데이터가 있는지 확인

## 폴백 시스템

마이그레이션을 적용하지 않아도 폴백 레시피 시스템이 작동합니다. 하지만 데이터베이스에 레시피가 있으면 더 다양한 식단을 제공할 수 있습니다.

